<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxNaija | Nigeria's Smart Tax Platform</title>
    <meta name="description" content="Professional tax intelligence platform for Nigerian individuals and businesses">
    <meta name="theme-color" content="#006400">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #006400;
            --primary-dark: #004d00;
            --primary-light: #4caf50;
            --secondary: #1a237e;
            --accent: #ff9800;
            --accent-dark: #e68900;
            --text: #333333;
            --text-light: #666666;
            --background: #f8f9fa;
            --white: #ffffff;
            --gray-light: #e9ecef;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 8px;
            --transition: all 0.3s ease;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: var(--white);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-text p {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem 1.5rem;
            color: var(--white);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--accent);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-badge {
            background: var(--accent);
            color: var(--white);
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 0.7rem;
            margin-left: auto;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .top-bar {
            background: var(--white);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--background);
            border-radius: var(--radius);
            padding: 0.5rem 1rem;
            width: 300px;
        }

        .search-bar input {
            border: none;
            background: transparent;
            width: 100%;
            padding: 0.5rem;
            outline: none;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent);
            color: var(--white);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-header {
            margin-bottom: 2rem;
        }

        .tab-header h2 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .tab-header p {
            color: var(--text-light);
        }

        /* Dashboard Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .trend-up {
            color: var(--primary-light);
        }

        .trend-down {
            color: #f44336;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .dashboard-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .deadline-list, .activity-list {
            list-style: none;
        }

        .deadline-item, .activity-item {
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deadline-item:last-child, .activity-item:last-child {
            border-bottom: none;
        }

        .deadline-icon, .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
        }

        .deadline-info, .activity-info {
            flex: 1;
        }

        .deadline-title, .activity-title {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .deadline-date, .activity-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .deadline-status {
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .status-upcoming {
            background: #fff3cd;
            color: #856404;
        }

        .status-due {
            background: #f8d7da;
            color: #721c24;
        }

        /* Calculator Styles */
        .calculator-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .calculator-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 2rem;
            text-align: center;
        }

        .calculator-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .calculator-header p {
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: var(--gray-light);
            width: 100%;
            margin-top: 1.5rem;
        }

        .progress {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: var(--transition);
        }

        .calculator-body {
            padding: 2rem;
        }

        .calculator-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .calculator-step.active {
            display: block;
        }

        .step-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .step-description {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--text-light);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-card {
            background: var(--white);
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .option-card:hover {
            border-color: var(--primary-light);
            transform: translateY(-5px);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: rgba(0, 100, 0, 0.05);
        }

        .option-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .option-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .option-description {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .input-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 100, 0, 0.1);
        }

        .input-hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .amount-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .amount-option {
            background: var(--white);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .amount-option:hover {
            border-color: var(--primary);
            background: rgba(0, 100, 0, 0.05);
        }

        .amount-option.selected {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .amount-in-words {
            margin-top: 0.5rem;
            padding: 0.8rem;
            background: rgba(0, 100, 0, 0.05);
            border-radius: var(--radius);
            border-left: 3px solid var(--primary);
            font-style: italic;
            min-height: 50px;
        }

        .official-docs-link {
            margin-top: 1rem;
            text-align: center;
        }

        .official-docs-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .official-docs-link a:hover {
            text-decoration: underline;
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #856404;
        }

        .disclaimer h4 {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .calculator-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-light);
        }

        .btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: var(--gray-light);
            color: var(--text-light);
            cursor: not-allowed;
            transform: none;
        }

        .btn-accent {
            background: var(--accent);
        }

        .btn-accent:hover {
            background: var(--accent-dark);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: rgba(0, 100, 0, 0.05);
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gray-light);
            transition: var(--transition);
        }

        .step-dot.active {
            background: var(--primary);
        }

        /* Results Section */
        .results-container {
            max-width: 800px;
            margin: 2rem auto;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: none;
        }

        .results-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 2rem;
            text-align: center;
        }

        .results-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .results-body {
            padding: 2rem;
        }

        .tax-summary {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(0, 100, 0, 0.05);
            border-radius: var(--radius);
        }

        .tax-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 1rem 0;
        }

        .tax-breakdown {
            margin: 1.5rem 0;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .tax-tip {
            background: #e8f5e9;
            border-left: 4px solid var(--primary-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-top: 1.5rem;
        }

        .tax-tip h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        /* History Styles */
        .history-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            background: var(--white);
        }

        .history-table {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            background: var(--primary);
            color: var(--white);
            padding: 1rem;
            font-weight: 600;
        }

        .table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .table-row:hover {
            background: rgba(0, 100, 0, 0.03);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-paid {
            background: #e8f5e9;
            color: var(--primary);
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-overdue {
            background: #f8d7da;
            color: #721c24;
        }

        /* Resources Styles */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .resource-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .resource-card:hover {
            transform: translateY(-5px);
        }

        .resource-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .resource-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .resource-description {
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .resource-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 1rem;
        }

        .resource-tag {
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Settings Styles */
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .settings-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .settings-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
        }

        .settings-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .settings-form {
            display: grid;
            gap: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Mobile Styles */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast i {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-bar {
                width: 200px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .calculator-body, .results-body {
                padding: 1.5rem;
            }

            .actions {
                flex-direction: column;
            }

            .table-header, .table-row {
                grid-template-columns: 1fr 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .resources-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">ðŸ’°</div>
                <div class="logo-text">
                    <h1>TaxNaija</h1>
                    <p>Nigeria's Smart Tax Platform</p>
                </div>
            </div>
            <div class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-tab="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#calculator" class="nav-item" data-tab="calculator">
                    <i class="fas fa-calculator"></i>
                    <span>Tax Calculator</span>
                    <span class="nav-badge">NEW</span>
                </a>
                <a href="#history" class="nav-item" data-tab="history">
                    <i class="fas fa-history"></i>
                    <span>Tax History</span>
                </a>
                <a href="#resources" class="nav-item" data-tab="resources">
                    <i class="fas fa-book"></i>
                    <span>Resources</span>
                </a>
                <a href="#settings" class="nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search tax resources...">
                </div>
                <div class="user-actions">
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-profile">
                        <div class="user-avatar">JD</div>
                        <div>
                            <div>John Doe</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">Individual Taxpayer</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Content -->
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="tab-header">
                    <h2>Tax Dashboard</h2>
                    <p>Welcome back, John! Here's your tax overview.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-tax-paid">â‚¦0</div>
                            <div class="stat-label">Total Tax Paid (YTD)</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Start using the platform</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--accent);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="upcoming-deadlines">0</div>
                            <div class="stat-label">Upcoming Deadlines</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-check-circle"></i>
                                <span>All caught up</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--secondary);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="estimated-savings">â‚¦0</div>
                            <div class="stat-label">Estimated Savings</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Use calculator to optimize</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Upcoming Deadlines</div>
                            <a href="#" style="color: var(--primary); font-size: 0.9rem;">View All</a>
                        </div>
                        <ul class="deadline-list" id="deadline-list">
                            <!-- Dynamic content will be populated by JavaScript -->
                        </ul>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Recent Activity</div>
                            <a href="#" style="color: var(--primary); font-size: 0.9rem;">View All</a>
                        </div>
                        <ul class="activity-list" id="activity-list">
                            <!-- Dynamic content will be populated by JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Calculator Tab -->
            <div class="tab-content" id="calculator">
                <div class="tab-header">
                    <h2>Tax Calculator</h2>
                    <p>Calculate your tax obligations in Nigeria with our intelligent calculator</p>
                </div>

                <!-- Onboarding Container -->
                <div class="calculator-container" id="calculator-container">
                    <div class="calculator-header">
                        <h2>Let's Calculate Your Tax</h2>
                        <p>Answer a few simple questions to get your personalized tax estimate</p>
                        <div class="progress-bar">
                            <div class="progress" id="progress-bar"></div>
                        </div>
                    </div>

                    <div class="calculator-body">
                        <!-- Step 1: Welcome -->
                        <div class="calculator-step active" id="step-1">
                            <h3 class="step-title">Welcome to TaxNaija</h3>
                            <p class="step-description">We'll help you understand your tax obligations in Nigeria with simple, easy-to-understand questions.</p>
                            
                            <div class="options-grid">
                                <div class="option-card" data-value="individual">
                                    <div class="option-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="option-title">I'm an Individual</div>
                                    <div class="option-description">Calculate personal income tax</div>
                                </div>
                                <div class="option-card" data-value="business">
                                    <div class="option-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div class="option-title">I have a Business</div>
                                    <div class="option-description">Calculate company tax</div>
                                </div>
                            </div>

                            <div class="disclaimer">
                                <h4><i class="fas fa-info-circle"></i> Important Disclaimer</h4>
                                <p>This tool provides estimates for informational purposes only. Tax laws change frequently and your actual tax liability may vary. Always consult with a qualified tax professional for personalized advice.</p>
                            </div>

                            <div class="calculator-footer">
                                <div></div> <!-- Empty div for spacing -->
                                <button class="btn btn-accent" id="step-1-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 2: Income Type -->
                        <div class="calculator-step" id="step-2">
                            <h3 class="step-title">How Do You Earn Money?</h3>
                            <p class="step-description">Select the main way you earn income</p>
                            
                            <div class="options-grid" id="income-type-options">
                                <!-- Options will be populated by JavaScript based on previous selection -->
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-2-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-2-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 3: Turnover/Income -->
                        <div class="calculator-step" id="step-3">
                            <h3 class="step-title" id="step-3-title">What Is Your Annual Income?</h3>
                            <p class="step-description" id="step-3-description">Enter your total income for the year</p>
                            
                            <div class="input-group">
                                <label for="income-amount" id="income-label">Annual Income (â‚¦)</label>
                                <input type="number" id="income-amount" class="input-control" placeholder="Enter amount">
                                
                                <div class="amount-options" id="income-amount-options">
                                    <!-- Amount options will be populated by JavaScript -->
                                </div>
                                
                                <div class="amount-in-words" id="income-amount-words">
                                    Amount in words will appear here
                                </div>
                                
                                <div class="input-hint" id="income-hint">This helps us calculate your tax accurately</div>
                            </div>

                            <div class="official-docs-link">
                                <a href="https://www.firs.gov.ng" target="_blank">
                                    <i class="fas fa-external-link-alt"></i> View Official FIRS Tax Guidelines
                                </a>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-3-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-3-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 4: Additional Details -->
                        <div class="calculator-step" id="step-4">
                            <h3 class="step-title" id="step-4-title">Any Allowances or Deductions?</h3>
                            <p class="step-description" id="step-4-description">These can reduce the amount of tax you pay</p>
                            
                            <div class="input-group">
                                <label for="allowances" id="allowances-label">Annual Allowances & Deductions (â‚¦)</label>
                                <input type="number" id="allowances" class="input-control" placeholder="Enter amount (optional)">
                                
                                <div class="amount-options" id="allowances-amount-options">
                                    <!-- Amount options will be populated by JavaScript -->
                                </div>
                                
                                <div class="amount-in-words" id="allowances-amount-words">
                                    Amount in words will appear here
                                </div>
                                
                                <div class="input-hint" id="allowances-hint">Examples: Pension contributions, NHF, dependents</div>
                            </div>

                            <div class="official-docs-link">
                                <a href="https://www.firs.gov.ng/individuals/allowable-deductions" target="_blank">
                                    <i class="fas fa-external-link-alt"></i> View Official Allowable Deductions
                                </a>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-4-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-4-next">
                                    Calculate Tax <i class="fas fa-calculator"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 5: Processing -->
                        <div class="calculator-step" id="step-5">
                            <h3 class="step-title">Calculating Your Tax</h3>
                            <p class="step-description">Our smart system is analyzing your information...</p>
                            
                            <div style="text-align: center; margin: 2rem 0;">
                                <i class="fas fa-cog fa-spin" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                                <p>Please wait while we calculate your tax obligations</p>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-5-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-5-next" disabled>
                                    Processing <i class="fas fa-spinner fa-spin"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Container -->
                <div class="results-container" id="results-container">
                    <div class="results-header">
                        <h2>Your Tax Analysis</h2>
                        <p>Here's your personalized tax estimate</p>
                    </div>

                    <div class="results-body">
                        <div class="tax-summary">
                            <p>Based on your information, your estimated tax is:</p>
                            <div class="tax-amount" id="calculated-tax">â‚¦0</div>
                            <p>per year</p>
                        </div>

                        <div class="tax-breakdown">
                            <div class="breakdown-item">
                                <span>Taxable Income:</span>
                                <span id="taxable-income">â‚¦0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Tax Rate:</span>
                                <span id="tax-rate">0%</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Allowances & Deductions:</span>
                                <span id="total-allowances">â‚¦0</span>
                            </div>
                            <div class="breakdown-item">
                                <span><strong>Net Tax Payable:</strong></span>
                                <span><strong id="net-tax">â‚¦0</strong></span>
                            </div>
                        </div>

                        <div class="tax-tip">
                            <h4><i class="fas fa-lightbulb"></i> Smart Tax Tip</h4>
                            <p id="optimization-tip">Based on your profile, we recommend maximizing your pension contributions to reduce taxable income.</p>
                        </div>

                        <div class="disclaimer">
                            <h4><i class="fas fa-info-circle"></i> Important Disclaimer</h4>
                            <p>This calculation is an estimate based on the information provided. Actual tax liability may vary based on specific circumstances, recent tax law changes, and additional factors not considered in this calculation. Always consult with a qualified tax professional for personalized advice.</p>
                        </div>

                        <div class="official-docs-link" style="text-align: center; margin-top: 1rem;">
                            <a href="https://www.firs.gov.ng" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Verify with Official FIRS Guidelines
                            </a>
                        </div>

                        <div class="actions">
                            <button class="btn btn-outline" id="restart-btn">
                                <i class="fas fa-redo"></i> Start Over
                            </button>
                            <button class="btn" id="save-result">
                                <i class="fas fa-download"></i> Save Result
                            </button>
                            <button class="btn btn-accent" id="payment-btn">
                                <i class="fas fa-credit-card"></i> Make Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history">
                <div class="tab-header">
                    <h2>Tax History</h2>
                    <p>View your tax calculation history and payment records</p>
                </div>

                <div class="history-filters">
                    <select class="filter-select" id="history-type-filter">
                        <option value="all">All Types</option>
                        <option value="individual">Personal Income Tax</option>
                        <option value="business">Company Income Tax</option>
                        <option value="vat">Value Added Tax</option>
                    </select>
                    <select class="filter-select" id="history-status-filter">
                        <option value="all">All Status</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                    </select>
                    <select class="filter-select" id="history-date-filter">
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 3 Months</option>
                        <option value="180">Last 6 Months</option>
                        <option value="365">Last Year</option>
                    </select>
                </div>

                <div class="history-table">
                    <div class="table-header">
                        <div>Date</div>
                        <div>Type</div>
                        <div>Amount</div>
                        <div>Status</div>
                        <div>Actions</div>
                    </div>
                    <div id="history-table-body">
                        <!-- Dynamic content will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Resources Tab -->
            <div class="tab-content" id="resources">
                <div class="tab-header">
                    <h2>Tax Resources</h2>
                    <p>Educational materials and official tax resources</p>
                </div>

                <div class="resources-grid">
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="resource-title">Personal Income Tax Guide</div>
                        <div class="resource-description">
                            Comprehensive guide to understanding and calculating personal income tax in Nigeria.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Individuals</span>
                            <span class="resource-tag">PIT</span>
                            <span class="resource-tag">FIRS</span>
                        </div>
                        <button class="btn">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="resource-title">VAT Compliance Tutorial</div>
                        <div class="resource-description">
                            Step-by-step video tutorial on VAT registration, filing, and payment processes.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Business</span>
                            <span class="resource-tag">VAT</span>
                            <span class="resource-tag">Compliance</span>
                        </div>
                        <button class="btn">
                            <i class="fas fa-play"></i> Watch
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="resource-title">2023 Tax Calendar</div>
                        <div class="resource-description">
                            Complete tax calendar with all important deadlines for individuals and businesses.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Calendar</span>
                            <span class="resource-tag">Deadlines</span>
                            <span class="resource-tag">2023</span>
                        </div>
                        <button class="btn">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div class="resource-title">Tax Laws & Regulations</div>
                        <div class="resource-description">
                            Updated compilation of Nigerian tax laws, regulations, and official guidelines.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Legal</span>
                            <span class="resource-tag">Regulations</span>
                            <span class="resource-tag">Compliance</span>
                        </div>
                        <button class="btn">
                            <i class="fas fa-external-link-alt"></i> View Online
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="tab-header">
                    <h2>Settings</h2>
                    <p>Manage your account preferences and notification settings</p>
                </div>

                <div class="settings-container">
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="settings-title">Profile Information</div>
                        </div>
                        <div class="settings-form">
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="first-name">First Name</label>
                                    <input type="text" id="first-name" class="input-control" value="John">
                                </div>
                                <div class="input-group">
                                    <label for="last-name">Last Name</label>
                                    <input type="text" id="last-name" class="input-control" value="Doe">
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" class="input-control" value="john.doe@example.com">
                            </div>
                            <div class="input-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" class="input-control" value="+234 800 000 0000">
                            </div>
                            <button class="btn" style="align-self: flex-start;">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="settings-title">Notification Preferences</div>
                        </div>
                        <div class="settings-form">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Tax Deadline Reminders</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Get notified about upcoming tax deadlines</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Tax Law Updates</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Receive updates when tax laws change</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Promotional Offers</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Get notified about special offers and discounts</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="settings-title">Security</div>
                        </div>
                        <div class="settings-form">
                            <div class="input-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" class="input-control">
                            </div>
                            <div class="input-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" class="input-control">
                            </div>
                            <div class="input-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="input-control">
                            </div>
                            <button class="btn" style="align-self: flex-start;">
                                <i class="fas fa-key"></i> Update Password
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for menu items -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operation completed successfully</span>
    </div>

    <script>
        // Enhanced Nigerian tax calculation logic and data
        const nigerianTaxData = {
            individual: {
                // Personal Income Tax (PIT) brackets for Nigeria (2023 rates)
                taxBrackets: [
                    { min: 0, max: 300000, rate: 0.07 },
                    { min: 300001, max: 600000, rate: 0.11 },
                    { min: 600001, max: 1100000, rate: 0.15 },
                    { min: 1100001, max: 1600000, rate: 0.19 },
                    { min: 1600001, max: 3200000, rate: 0.21 },
                    { min: 3200001, max: Infinity, rate: 0.24 }
                ],
                consolidatedReliefAllowance: (income) => {
                    // CRA is the higher of 200,000 or 1% of gross income plus 20% of gross income
                    return Math.max(200000, (0.01 * income) + (0.2 * income));
                },
                standardDeductions: {
                    pension: 0.08, // Maximum 8% of salary
                    nhf: 0.025, // 2.5% of annual basic salary
                    lifeInsurance: 0.1, // Up to 10% of total income
                    dependentRelatives: 50000, // Per dependent up to 4
                    childrenEducation: 50000 // Per child up to 4
                },
                income: [500000, 1000000, 2000000, 5000000, 10000000],
                allowances: [50000, 100000, 200000, 500000, 1000000]
            },
            business: {
                // Company Income Tax (CIT) rates for Nigeria (2023)
                taxRates: {
                    small: 0.20, // For companies with turnover < â‚¦25M
                    medium: 0.25, // For companies with turnover â‚¦25M - â‚¦100M
                    large: 0.30  // For companies with turnover > â‚¦100M
                },
                turnoverThresholds: {
                    small: 25000000,
                    medium: 100000000
                },
                allowableDeductions: {
                    capitalAllowance: 0.1, // 10% on qualifying capital expenditure
                    staffCosts: 1.0, // 100% of staff costs
                    rent: 1.0, // 100% of rent expenses
                    utilities: 1.0, // 100% of utility costs
                    professionalFees: 1.0 // 100% of professional fees
                },
                income: [1000000, 5000000, 10000000, 25000000, 50000000, 100000000],
                allowances: [100000, 500000, 1000000, 2500000, 5000000]
            },
            vat: {
                rate: 0.075, // 7.5% VAT rate in Nigeria
                registrationThreshold: 25000000 // â‚¦25 million turnover
            },
            states: {
                // State-level taxes and levies
                developmentLevy: 1000, // Annual per individual
                businessPremises: {
                    rural: 10000,
                    urban: 20000,
                    metropolitan: 50000
                }
            }
        };

        // Nigerian tax deadlines (updated for 2023)
        const nigerianDeadlines = [
            { title: "VAT Returns Due", date: "2023-04-21", type: "vat", status: "upcoming" },
            { title: "Personal Income Tax (Self-Assessment)", date: "2023-03-31", type: "individual", status: "due" },
            { title: "Company Income Tax", date: "2023-06-30", type: "business", status: "upcoming" },
            { title: "Education Tax", date: "2023-09-30", type: "business", status: "upcoming" },
            { title: "State Development Levy", date: "2023-01-31", type: "individual", status: "overdue" }
        ];

        // Enhanced User data object to store responses
        const userData = {
            userType: null, // 'individual' or 'business'
            incomeType: null,
            incomeAmount: null,
            allowances: 0,
            state: "Lagos", // Default state
            hasTin: false,
            dependents: 0,
            children: 0,
            businessType: null, // For business users
            businessLocation: "urban" // For business premises levy
        };

        // Enhanced App state
        const appState = {
            taxHistory: JSON.parse(localStorage.getItem('taxHistory')) || [],
            userProfile: JSON.parse(localStorage.getItem('userProfile')) || {
                firstName: "John",
                lastName: "Doe",
                email: "john.doe@example.com",
                phone: "+234 800 000 0000",
                userType: "individual",
                state: "Lagos",
                hasTin: false,
                dependents: 0,
                children: 0
            },
            settings: JSON.parse(localStorage.getItem('settings')) || {
                notifications: true,
                taxUpdates: true,
                darkMode: false
            }
        };

        // DOM elements
        const sidebar = document.getElementById('sidebar');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const navItems = document.querySelectorAll('.nav-item');
        const tabContents = document.querySelectorAll('.tab-content');
        const calculatorContainer = document.getElementById('calculator-container');
        const resultsContainer = document.getElementById('results-container');
        const progressBar = document.getElementById('progress-bar');
        const steps = document.querySelectorAll('.calculator-step');
        const stepIndicators = document.querySelectorAll('.step-dot');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalClose = document.getElementById('modal-close');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        // Initialize the app
        function initApp() {
            updateDashboard();
            loadTaxHistory();
            setupEventListeners();
            applyUserSettings();
        }

        // Apply user settings from localStorage
        function applyUserSettings() {
            if (appState.settings.darkMode) {
                document.body.classList.add('dark-mode');
            }
        }

        // Update dashboard with user data
        function updateDashboard() {
            // Update stats
            const totalTax = appState.taxHistory.reduce((sum, record) => sum + record.taxAmount, 0);
            document.getElementById('total-tax-paid').textContent = formatCurrency(totalTax);
            
            const upcomingCount = nigerianDeadlines.filter(d => d.status === 'upcoming').length;
            document.getElementById('upcoming-deadlines').textContent = upcomingCount;
            
            // Calculate estimated savings (simplified)
            const estimatedSavings = appState.taxHistory.reduce((sum, record) => {
                return sum + (record.allowances || 0) * 0.2; // Simplified savings calculation
            }, 0);
            document.getElementById('estimated-savings').textContent = formatCurrency(estimatedSavings);
            
            // Update deadlines list
            const deadlineList = document.getElementById('deadline-list');
            deadlineList.innerHTML = '';
            
            nigerianDeadlines.forEach(deadline => {
                const deadlineItem = document.createElement('li');
                deadlineItem.className = 'deadline-item';
                
                const statusClass = `status-${deadline.status}`;
                
                deadlineItem.innerHTML = `
                    <div class="deadline-icon">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <div class="deadline-info">
                        <div class="deadline-title">${deadline.title}</div>
                        <div class="deadline-date">Due: ${formatDate(deadline.date)}</div>
                    </div>
                    <div class="deadline-status ${statusClass}">${deadline.status}</div>
                `;
                
                deadlineList.appendChild(deadlineItem);
            });
            
            // Update activity list
            const activityList = document.getElementById('activity-list');
            activityList.innerHTML = '';
            
            // Show recent tax calculations
            const recentCalculations = appState.taxHistory.slice(-3).reverse();
            
            if (recentCalculations.length === 0) {
                activityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">No calculations yet</div>
                            <div class="activity-time">Use the tax calculator to get started</div>
                        </div>
                    </li>
                `;
            } else {
                recentCalculations.forEach(calc => {
                    const activityItem = document.createElement('li');
                    activityItem.className = 'activity-item';
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">${calc.userType === 'individual' ? 'Personal' : 'Business'} Tax Calculated</div>
                            <div class="activity-time">${formatDate(calc.date)} - ${formatCurrency(calc.taxAmount)}</div>
                        </div>
                    `;
                    
                    activityList.appendChild(activityItem);
                });
            }
        }

        // Load and display tax history
        function loadTaxHistory() {
            const historyTableBody = document.getElementById('history-table-body');
            
            if (appState.taxHistory.length === 0) {
                historyTableBody.innerHTML = `
                    <div class="table-row">
                        <div colspan="5" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-history" style="font-size: 2rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                            <p>No tax history yet. Start by using the tax calculator!</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Filter history based on selected filters
            const typeFilter = document.getElementById('history-type-filter').value;
            const statusFilter = document.getElementById('history-status-filter').value;
            const dateFilter = document.getElementById('history-date-filter').value;
            
            const filteredHistory = appState.taxHistory.filter(record => {
                const typeMatch = typeFilter === 'all' || record.userType === typeFilter;
                const statusMatch = statusFilter === 'all' || record.status === statusFilter;
                
                // Date filtering (simplified)
                const recordDate = new Date(record.date);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - parseInt(dateFilter));
                
                const dateMatch = recordDate >= cutoffDate;
                
                return typeMatch && statusMatch && dateMatch;
            });
            
            // Display filtered history
            historyTableBody.innerHTML = '';
            
            filteredHistory.forEach(record => {
                const tableRow = document.createElement('div');
                tableRow.className = 'table-row';
                
                const statusClass = `status-${record.status}`;
                
                tableRow.innerHTML = `
                    <div>${formatDate(record.date)}</div>
                    <div>${record.userType === 'individual' ? 'Personal Income Tax' : 'Company Income Tax'}</div>
                    <div>${formatCurrency(record.taxAmount)}</div>
                    <div><span class="status-badge ${statusClass}">${record.status}</span></div>
                    <div>
                        <button class="btn btn-outline" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="viewCalculation('${record.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                `;
                
                historyTableBody.appendChild(tableRow);
            });
        }

        // Save tax calculation to history
        function saveTaxCalculation(calculation) {
            const calculationRecord = {
                id: generateId(),
                date: new Date().toISOString(),
                userType: userData.userType,
                incomeAmount: userData.incomeAmount,
                allowances: userData.allowances,
                taxAmount: calculation.tax,
                taxableIncome: calculation.taxableIncome,
                taxRate: calculation.taxRate,
                status: 'pending'
            };
            
            appState.taxHistory.unshift(calculationRecord);
            localStorage.setItem('taxHistory', JSON.stringify(appState.taxHistory));
            
            // Update dashboard
            updateDashboard();
            
            // Show success message
            showToast('Tax calculation saved to history');
        }

        // View a specific calculation
        function viewCalculation(calculationId) {
            const calculation = appState.taxHistory.find(record => record.id === calculationId);
            
            if (!calculation) return;
            
            openModal('Tax Calculation Details', `
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary); margin-bottom: 1rem;">Calculation Details</h4>
                    <div class="breakdown-item">
                        <span>Date:</span>
                        <span>${formatDate(calculation.date)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Type:</span>
                        <span>${calculation.userType === 'individual' ? 'Personal Income Tax' : 'Company Income Tax'}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Income:</span>
                        <span>${formatCurrency(calculation.incomeAmount)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Allowances:</span>
                        <span>${formatCurrency(calculation.allowances)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Taxable Income:</span>
                        <span>${formatCurrency(calculation.taxableIncome)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Tax Rate:</span>
                        <span>${(calculation.taxRate * 100).toFixed(1)}%</span>
                    </div>
                    <div class="breakdown-item">
                        <span><strong>Tax Amount:</strong></span>
                        <span><strong>${formatCurrency(calculation.taxAmount)}</strong></span>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn" onclick="reuseCalculation('${calculation.id}')">
                        <i class="fas fa-redo"></i> Reuse This Calculation
                    </button>
                    <button class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            `);
        }

        // Reuse a previous calculation
        function reuseCalculation(calculationId) {
            const calculation = appState.taxHistory.find(record => record.id === calculationId);
            
            if (!calculation) return;
            
            // Set user data from the calculation
            userData.userType = calculation.userType;
            userData.incomeAmount = calculation.incomeAmount;
            userData.allowances = calculation.allowances;
            
            // Navigate to calculator tab
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-tab="calculator"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('calculator').classList.add('active');
            
            // Reset calculator UI
            calculatorContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            
            // Pre-populate the calculator based on the calculation
            // This would need more complex logic to navigate through the steps
            // For now, we'll just show a message
            closeModal();
            showToast('Calculation loaded. Please use the calculator to modify values.');
        }

        // Format currency for Nigerian Naira
        function formatCurrency(amount) {
            if (isNaN(amount)) return 'â‚¦0';
            return 'â‚¦' + amount.toLocaleString('en-NG');
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-NG', options);
        }

        // Generate a unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Show toast notification
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Tab navigation
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all nav items
                    navItems.forEach(nav => nav.classList.remove('active'));
                    
                    // Add active class to clicked nav item
                    this.classList.add('active');
                    
                    // Get the tab to show
                    const tabId = this.getAttribute('data-tab');
                    
                    // Hide all tab contents
                    tabContents.forEach(tab => tab.classList.remove('active'));
                    
                    // Show the selected tab content
                    document.getElementById(tabId).classList.add('active');
                    
                    // Update specific tab content if needed
                    if (tabId === 'history') {
                        loadTaxHistory();
                    } else if (tabId === 'dashboard') {
                        updateDashboard();
                    }
                    
                    // Close mobile menu if open
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('active');
                    }
                });
            });

            // Mobile menu toggle
            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 && 
                    !sidebar.contains(e.target) && 
                    !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });

            // Modal functionality
            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });

            // History filters
            document.getElementById('history-type-filter').addEventListener('change', loadTaxHistory);
            document.getElementById('history-status-filter').addEventListener('change', loadTaxHistory);
            document.getElementById('history-date-filter').addEventListener('change', loadTaxHistory);

            // Calculator event listeners
            setupCalculatorEventListeners();
        }

        // Setup calculator-specific event listeners
        function setupCalculatorEventListeners() {
            // Step 1: User Type Selection
            document.querySelectorAll('#step-1 .option-card').forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selection from all cards
                    document.querySelectorAll('#step-1 .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select this card
                    this.classList.add('selected');
                    userData.userType = this.getAttribute('data-value');
                    
                    // Enable next button
                    document.getElementById('step-1-next').disabled = false;
                });
            });

            // Step 1 Next Button
            document.getElementById('step-1-next').addEventListener('click', function() {
                // Populate step 2 options based on user type
                const incomeTypeOptions = document.getElementById('income-type-options');
                incomeTypeOptions.innerHTML = '';
                
                if (userData.userType === 'individual') {
                    const individualOptions = [
                        { value: 'salary', icon: 'fa-money-bill', title: 'Salary Earner', description: 'I work for a company and receive a salary' },
                        { value: 'business', icon: 'fa-store', title: 'Business Owner', description: 'I run my own business' },
                        { value: 'rental', icon: 'fa-home', title: 'Rental Income', description: 'I earn from renting out property' },
                        { value: 'investment', icon: 'fa-chart-line', title: 'Investment Income', description: 'I earn from investments' }
                    ];
                    
                    individualOptions.forEach(option => {
                        const card = document.createElement('div');
                        card.className = 'option-card';
                        card.setAttribute('data-value', option.value);
                        card.innerHTML = `
                            <div class="option-icon">
                                <i class="fas ${option.icon}"></i>
                            </div>
                            <div class="option-title">${option.title}</div>
                            <div class="option-description">${option.description}</div>
                        `;
                        incomeTypeOptions.appendChild(card);
                    });
                } else {
                    const businessOptions = [
                        { value: 'small', icon: 'fa-store', title: 'Small Business', description: 'Turnover less than â‚¦25 million' },
                        { value: 'medium', icon: 'fa-building', title: 'Medium Business', description: 'Turnover â‚¦25M - â‚¦100M' },
                        { value: 'large', icon: 'fa-industry', title: 'Large Business', description: 'Turnover more than â‚¦100M' }
                    ];
                    
                    businessOptions.forEach(option => {
                        const card = document.createElement('div');
                        card.className = 'option-card';
                        card.setAttribute('data-value', option.value);
                        card.innerHTML = `
                            <div class="option-icon">
                                <i class="fas ${option.icon}"></i>
                            </div>
                            <div class="option-title">${option.title}</div>
                            <div class="option-description">${option.description}</div>
                        `;
                        incomeTypeOptions.appendChild(card);
                    });
                }
                
                // Add event listeners to new option cards
                document.querySelectorAll('#income-type-options .option-card').forEach(card => {
                    card.addEventListener('click', function() {
                        // Remove selection from all cards
                        document.querySelectorAll('#income-type-options .option-card').forEach(c => {
                            c.classList.remove('selected');
                        });
                        
                        // Select this card
                        this.classList.add('selected');
                        userData.incomeType = this.getAttribute('data-value');
                        
                        // Enable next button
                        document.getElementById('step-2-next').disabled = false;
                    });
                });
                
                goToStep(2);
            });

            // Step 2 Next Button
            document.getElementById('step-2-next').addEventListener('click', function() {
                // Update step 3 based on user type and income type
                const step3Title = document.getElementById('step-3-title');
                const step3Description = document.getElementById('step-3-description');
                const incomeLabel = document.getElementById('income-label');
                const incomeHint = document.getElementById('income-hint');
                
                if (userData.userType === 'individual') {
                    step3Title.textContent = "What Is Your Annual Income?";
                    step3Description.textContent = "Enter your total income for the year";
                    incomeLabel.textContent = "Annual Income (â‚¦)";
                    incomeHint.textContent = "This helps us calculate your tax accurately";
                    
                    // Create amount options for individual income
                    createAmountOptions(
                        'income-amount-options', 
                        nigerianTaxData.individual.income, 
                        userData.incomeAmount,
                        (amount) => {
                            userData.incomeAmount = amount;
                            document.getElementById('income-amount').value = amount;
                            updateAmountInWords(amount, 'income-amount-words');
                            document.getElementById('step-3-next').disabled = false;
                        }
                    );
                } else {
                    step3Title.textContent = "What Is Your Annual Turnover?";
                    step3Description.textContent = "Enter your business's total turnover for the year";
                    incomeLabel.textContent = "Annual Turnover (â‚¦)";
                    incomeHint.textContent = "Your turnover is the total amount of money your business makes";
                    
                    // Create amount options for business income
                    createAmountOptions(
                        'income-amount-options', 
                        nigerianTaxData.business.income, 
                        userData.incomeAmount,
                        (amount) => {
                            userData.incomeAmount = amount;
                            document.getElementById('income-amount').value = amount;
                            updateAmountInWords(amount, 'income-amount-words');
                            document.getElementById('step-3-next').disabled = false;
                        }
                    );
                }
                
                goToStep(3);
            });

            // Step 2 Back Button
            document.getElementById('step-2-back').addEventListener('click', function() {
                goToStep(1);
            });

            // Step 3: Income Amount Input
            document.getElementById('income-amount').addEventListener('input', function() {
                const value = parseFloat(this.value) || 0;
                userData.incomeAmount = value;
                
                // Update amount in words
                updateAmountInWords(value, 'income-amount-words');
                
                // Update selected amount option
                document.querySelectorAll('#income-amount-options .amount-option').forEach(option => {
                    const optionAmount = parseInt(option.textContent.replace('â‚¦', '').replace(/,/g, ''));
                    if (optionAmount === value) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
                
                // Enable next button if value is valid
                document.getElementById('step-3-next').disabled = value <= 0;
            });

            // Step 3 Next Button
            document.getElementById('step-3-next').addEventListener('click', function() {
                // Update step 4 based on user type
                const step4Title = document.getElementById('step-4-title');
                const step4Description = document.getElementById('step-4-description');
                const allowancesLabel = document.getElementById('allowances-label');
                const allowancesHint = document.getElementById('allowances-hint');
                
                if (userData.userType === 'individual') {
                    step4Title.textContent = "Any Allowances or Deductions?";
                    step4Description.textContent = "These can reduce the amount of tax you pay";
                    allowancesLabel.textContent = "Annual Allowances & Deductions (â‚¦)";
                    allowancesHint.textContent = "Examples: Pension contributions, NHF, dependents";
                    
                    // Create amount options for individual allowances
                    createAmountOptions(
                        'allowances-amount-options', 
                        nigerianTaxData.individual.allowances, 
                        userData.allowances,
                        (amount) => {
                            userData.allowances = amount;
                            document.getElementById('allowances').value = amount;
                            updateAmountInWords(amount, 'allowances-amount-words');
                        }
                    );
                } else {
                    step4Title.textContent = "Any Business Expenses or Deductions?";
                    step4Description.textContent = "These can reduce the amount of tax your business pays";
                    allowancesLabel.textContent = "Annual Business Expenses (â‚¦)";
                    allowancesHint.textContent = "Examples: Employee salaries, rent, equipment costs";
                    
                    // Create amount options for business allowances
                    createAmountOptions(
                        'allowances-amount-options', 
                        nigerianTaxData.business.allowances, 
                        userData.allowances,
                        (amount) => {
                            userData.allowances = amount;
                            document.getElementById('allowances').value = amount;
                            updateAmountInWords(amount, 'allowances-amount-words');
                        }
                    );
                }
                
                goToStep(4);
            });

            // Step 3 Back Button
            document.getElementById('step-3-back').addEventListener('click', function() {
                goToStep(2);
            });

            // Step 4: Allowances Input
            document.getElementById('allowances').addEventListener('input', function() {
                const value = parseFloat(this.value) || 0;
                userData.allowances = value;
                
                // Update amount in words
                updateAmountInWords(value, 'allowances-amount-words');
                
                // Update selected amount option
                document.querySelectorAll('#allowances-amount-options .amount-option').forEach(option => {
                    const optionAmount = parseInt(option.textContent.replace('â‚¦', '').replace(/,/g, ''));
                    if (optionAmount === value) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
            });

            // Step 4 Next Button
            document.getElementById('step-4-next').addEventListener('click', function() {
                goToStep(5);
                
                // Simulate processing delay
                setTimeout(function() {
                    const calculation = calculateTax();
                    displayResults(calculation);
                    saveTaxCalculation(calculation);
                    
                    calculatorContainer.style.display = 'none';
                    resultsContainer.style.display = 'block';
                }, 2000);
            });

            // Step 4 Back Button
            document.getElementById('step-4-back').addEventListener('click', function() {
                goToStep(3);
            });

            // Step 5 Back Button
            document.getElementById('step-5-back').addEventListener('click', function() {
                goToStep(4);
            });

            // Restart Button
            document.getElementById('restart-btn').addEventListener('click', function() {
                // Reset user data
                userData.userType = null;
                userData.incomeType = null;
                userData.incomeAmount = null;
                userData.allowances = 0;
                
                // Reset UI
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.getElementById('income-amount').value = '';
                document.getElementById('allowances').value = '';
                document.getElementById('step-1-next').disabled = true;
                document.getElementById('step-2-next').disabled = true;
                document.getElementById('step-3-next').disabled = true;
                
                // Reset amount in words
                updateAmountInWords(0, 'income-amount-words');
                updateAmountInWords(0, 'allowances-amount-words');
                
                // Show calculator, hide results
                calculatorContainer.style.display = 'block';
                resultsContainer.style.display = 'none';
                
                // Go back to step 1
                goToStep(1);
            });

            // Save Result Button
            document.getElementById('save-result').addEventListener('click', function() {
                // In a real app, this would save as PDF or to account
                showToast('Calculation saved to your history');
            });

            // Payment Button
            document.getElementById('payment-btn').addEventListener('click', function() {
                openModal('Tax Payment Methods', `
                    <p>Choose your preferred payment method:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                        <div style="border: 1px solid var(--gray-light); border-radius: var(--radius); padding: 1rem; text-align: center; cursor: pointer; transition: var(--transition);">
                            <div style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"><i class="fas fa-mobile-alt"></i></div>
                            <div style="font-weight: 500;">USSD Payment</div>
                            <div style="font-size: 0.9rem; color: var(--text-light);">Dial *565*6# to pay</div>
                        </div>
                        <div style="border: 1px solid var(--gray-light); border-radius: var(--radius); padding: 1rem; text-align: center; cursor: pointer; transition: var(--transition);">
                            <div style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"><i class="fas fa-laptop"></i></div>
                            <div style="font-weight: 500;">Online Banking</div>
                            <div style="font-size: 0.9rem; color: var(--text-light);">Pay via your bank's website</div>
                        </div>
                        <div style="border: 1px solid var(--gray-light); border-radius: var(--radius); padding: 1rem; text-align: center; cursor: pointer; transition: var(--transition);">
                            <div style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"><i class="fas fa-university"></i></div>
                            <div style="font-weight: 500;">Bank Branch</div>
                            <div style="font-size: 0.9rem; color: var(--text-light);">Visit any bank branch</div>
                        </div>
                    </div>
                    <div class="tax-tip">
                        <h4><i class="fas fa-info-circle"></i> Payment Information</h4>
                        <p>Ensure you have your Tax Identification Number (TIN) ready before making payment. Payments may take 24-48 hours to reflect in FIRS records.</p>
                    </div>
                `);
            });
        }

        // Calculator helper functions
        function goToStep(stepNumber) {
            // Hide all steps
            steps.forEach(step => step.classList.remove('active'));
            stepIndicators.forEach(indicator => indicator.classList.remove('active'));
            
            // Show current step
            document.getElementById(`step-${stepNumber}`).classList.add('active');
            stepIndicators[stepNumber - 1].classList.add('active');
            
            // Update progress bar
            const progressPercentage = ((stepNumber - 1) / (steps.length - 1)) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        // Enhanced Number to words conversion function
        function numberToWords(num) {
            if (num === 0) return "Zero Naira";
            
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const scales = ['', 'Thousand', 'Million', 'Billion', 'Trillion'];
            
            // Handle negative numbers
            if (num < 0) {
                return 'Negative ' + numberToWords(Math.abs(num));
            }
            
            let words = '';
            
            // Convert number to string and split into integer and decimal parts
            const numStr = num.toFixed(2);
            const parts = numStr.split('.');
            const integerPart = parseInt(parts[0]);
            const decimalPart = parts[1] ? parseInt(parts[1]) : 0;
            
            // Convert integer part
            if (integerPart === 0) {
                words = 'Zero';
            } else {
                let count = 0;
                let n = integerPart;
                
                while (n > 0) {
                    if (n % 1000 !== 0) {
                        let chunk = '';
                        const x = n % 1000;
                        
                        if (x < 20) {
                            chunk = ones[x];
                        } else if (x < 100) {
                            chunk = tens[Math.floor(x / 10)] + (x % 10 !== 0 ? '-' + ones[x % 10] : '');
                        } else {
                            chunk = ones[Math.floor(x / 100)] + ' Hundred ' + (x % 100 !== 0 ? 'and ' + numberToWords(x % 100) : '');
                        }
                        
                        words = chunk + (scales[count] ? ' ' + scales[count] + ' ' : '') + words;
                    }
                    n = Math.floor(n / 1000);
                    count++;
                }
                
                // Clean up extra spaces
                words = words.replace(/\s+/g, ' ').trim();
            }
            
            // Add "Naira"
            let result = words + ' Naira';
            
            // Add kobo if there's a decimal part
            if (decimalPart > 0) {
                let koboWords = '';
                if (decimalPart < 20) {
                    koboWords = ones[decimalPart];
                } else {
                    koboWords = tens[Math.floor(decimalPart / 10)] + (decimalPart % 10 !== 0 ? '-' + ones[decimalPart % 10] : '');
                }
                result += ' and ' + koboWords + ' Kobo';
            }
            
            return result;
        }

        // Function to create amount options
        function createAmountOptions(containerId, options, currentValue, onSelect) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            options.forEach(amount => {
                const option = document.createElement('div');
                option.className = 'amount-option';
                if (currentValue === amount) {
                    option.classList.add('selected');
                }
                option.textContent = formatCurrency(amount);
                option.addEventListener('click', () => {
                    onSelect(amount);
                    
                    // Update selected state
                    document.querySelectorAll(`#${containerId} .amount-option`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    option.classList.add('selected');
                });
                container.appendChild(option);
            });
        }

        // Function to update amount in words display
        function updateAmountInWords(amount, wordsContainerId) {
            const wordsContainer = document.getElementById(wordsContainerId);
            if (amount && amount > 0) {
                wordsContainer.textContent = numberToWords(amount);
            } else {
                wordsContainer.textContent = 'Amount in words will appear here';
            }
        }

        // Enhanced Tax Calculation Function
        function calculateTax() {
            let taxableIncome = userData.incomeAmount - userData.allowances;
            let tax = 0;
            let taxRate = 0;
            let tip = '';
            let additionalTaxes = [];
            
            if (userData.userType === 'individual') {
                // Apply Consolidated Relief Allowance (CRA)
                const cra = nigerianTaxData.individual.consolidatedReliefAllowance(userData.incomeAmount);
                taxableIncome = Math.max(0, userData.incomeAmount - userData.allowances - cra);
                
                // Calculate tax using Nigerian PIT brackets
                let remainingIncome = taxableIncome;
                
                for (const bracket of nigerianTaxData.individual.taxBrackets) {
                    if (remainingIncome <= 0) break;
                    
                    const bracketAmount = Math.min(
                        remainingIncome,
                        bracket.max === Infinity ? remainingIncome : bracket.max - bracket.min + 1
                    );
                    
                    tax += bracketAmount * bracket.rate;
                    remainingIncome -= bracketAmount;
                }
                
                // Add state development levy
                additionalTaxes.push({
                    name: "State Development Levy",
                    amount: nigerianTaxData.states.developmentLevy
                });
                tax += nigerianTaxData.states.developmentLevy;
                
                // Calculate effective tax rate
                taxRate = userData.incomeAmount > 0 ? tax / userData.incomeAmount : 0;
                
                // Generate tip based on income type
                switch(userData.incomeType) {
                    case 'salary':
                        tip = "Consider maximizing your pension contributions (up to 25% of annual income) and National Housing Fund contributions to reduce your taxable income. Also ensure you're claiming all eligible allowances including transport, housing, and utility allowances.";
                        break;
                    case 'business':
                        tip = "Ensure you're claiming all legitimate business expenses and consider timing major equipment purchases to maximize deductions. Explore available tax incentives for small businesses including the lower tax rate for companies with turnover below â‚¦25 million.";
                        break;
                    case 'rental':
                        tip = "Maximize deductions for property maintenance, insurance, management fees, and repairs. Consider restructuring property ownership for optimal tax efficiency and explore opportunities for capital allowances on qualifying improvements.";
                        break;
                    case 'investment':
                        tip = "Review your investment portfolio for tax-efficient instruments including government securities and explore timing of capital gains realization to optimize your tax position. Consider tax-exempt investment options where available.";
                        break;
                }
            } else {
                // Corporate tax calculation
                let companyType = 'large';
                
                if (userData.incomeAmount < nigerianTaxData.business.turnoverThresholds.small) {
                    companyType = 'small';
                } else if (userData.incomeAmount <= nigerianTaxData.business.turnoverThresholds.medium) {
                    companyType = 'medium';
                }
                
                taxRate = nigerianTaxData.business.taxRates[companyType];
                tax = taxableIncome * taxRate;
                
                // Add business premises levy based on location
                const premisesLevy = nigerianTaxData.states.businessPremises[userData.businessLocation || 'urban'];
                additionalTaxes.push({
                    name: "Business Premises Levy",
                    amount: premisesLevy
                });
                tax += premisesLevy;
                
                // Add education tax (2% of assessable profit)
                const educationTax = taxableIncome * 0.02;
                additionalTaxes.push({
                    name: "Education Tax",
                    amount: educationTax
                });
                tax += educationTax;
                
                // Generate tip based on company size
                switch(companyType) {
                    case 'small':
                        tip = "Small businesses with turnover below â‚¦25 million enjoy reduced tax rates and simplified compliance requirements. Consider timing equipment purchases to maximize deductions and explore available tax credits for job creation and training programs.";
                        break;
                    case 'medium':
                        tip = "Medium-sized businesses can benefit from various incentives including investment allowances and industry-specific tax credits. Explore available export incentives and consider structuring investments to qualify for pioneer status where applicable.";
                        break;
                    case 'large':
                        tip = "Large companies should explore sector-specific incentives, transfer pricing optimization, and strategic timing of major expenses to optimize tax liability. Consider available tax treaties for cross-border transactions and explore opportunities for research and development credits.";
                        break;
                }
            }
            
            return {
                tax: Math.round(tax),
                taxableIncome: Math.round(taxableIncome),
                taxRate: taxRate,
                tip: tip,
                additionalTaxes: additionalTaxes
            };
        }

        // Enhanced Display calculation results
        function displayResults(calculation) {
            document.getElementById('calculated-tax').textContent = formatCurrency(calculation.tax);
            document.getElementById('taxable-income').textContent = formatCurrency(calculation.taxableIncome);
            document.getElementById('tax-rate').textContent = `${(calculation.taxRate * 100).toFixed(1)}%`;
            document.getElementById('total-allowances').textContent = formatCurrency(userData.allowances);
            document.getElementById('net-tax').textContent = formatCurrency(calculation.tax);
            document.getElementById('optimization-tip').textContent = calculation.tip;
            
            // Display additional taxes if any
            if (calculation.additionalTaxes && calculation.additionalTaxes.length > 0) {
                const breakdown = document.querySelector('.tax-breakdown');
                calculation.additionalTaxes.forEach(additionalTax => {
                    const taxItem = document.createElement('div');
                    taxItem.className = 'breakdown-item';
                    taxItem.innerHTML = `
                        <span>${additionalTax.name}:</span>
                        <span>${formatCurrency(additionalTax.amount)}</span>
                    `;
                    breakdown.appendChild(taxItem);
                });
            }
        }

        // Modal functions
        function openModal(title, content) {
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
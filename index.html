<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synapse Text Demo</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 2em; max-width: 800px; margin: auto; }
        h1 { color: #333; }
        
        /* Style for the Synapse Text nodes */
        node {
            cursor: pointer;
            border-bottom: 2px dotted #007bff;
            transition: background-color 0.3s;
            font-weight: bold;
        }

        /* The highlight style applied by JavaScript */
        .highlight {
            background-color: #e7f3ff; /* Light blue highlight */
            border-bottom: 2px solid #0056b3;
        }
        
        /* Style for the tooltip showing the relationship */
        .synapse-tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9em;
            pointer-events: none; /* Make sure it doesn't interfere with mouse events */
        }
    </style>
</head>
<body>

    <h1>Synapse Text Demo</h1>
    <p>Hover over the <b>bold, dotted-underlined</b> words to see their relationships.</p>

    <synapse-text>
        <p>In web development, <node id="html">HTML</node> is used for structuring content. To style this content, developers use <node id="css">CSS</node>. For interactivity, <node id="js">JavaScript</node> is the standard language. <node id="html">HTML</node> and <node id="css">CSS</node> are markup and styling languages respectively, not programming languages in the same vein as <node id="js">JavaScript</node>.</p>
        <p>A popular library for <node id="js">JavaScript</node> is <node id="react">React</node>, which helps build user interfaces efficiently. <node id="react">React</node> is often used to manipulate the <node id="html">HTML</node> structure dynamically.</p>

        <rel from="css" to="html" type="styles"></rel>
        <rel from="js" to="html" type="manipulates"></rel>
        <rel from="react" to="js" type="is a library of"></rel>
        <rel from="react" to="html" type="updates"></rel>
    </synapse-text>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const graph = new Map();
            const nodes = new Map();
            
            // 1. Parse nodes and relationships
            document.querySelectorAll('node').forEach(nodeEl => {
                nodes.set(nodeEl.id, nodeEl);
                graph.set(nodeEl.id, []);
            });

            document.querySelectorAll('rel').forEach(relEl => {
                const from = relEl.getAttribute('from');
                const to = relEl.getAttribute('to');
                const type = relEl.getAttribute('type');

                // Add relationships in both directions for easy lookup
                if (graph.has(from) && graph.has(to)) {
                    graph.get(from).push({ target: to, type: type });
                    graph.get(to).push({ target: from, type: `is ${type} by` });
                }
            });

            // 2. Create and manage tooltips
            let tooltip = document.createElement('div');
            tooltip.className = 'synapse-tooltip';
            tooltip.style.display = 'none';
            document.body.appendChild(tooltip);

            document.body.addEventListener('mousemove', (e) => {
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY + 10}px`;
            });
            
            // 3. Add event listeners to all nodes
            nodes.forEach((nodeEl, nodeId) => {
                nodeEl.addEventListener('mouseover', () => {
                    const relations = graph.get(nodeId);
                    if (!relations || relations.length === 0) return;

                    // Highlight the current node
                    nodeEl.classList.add('highlight');
                    
                    let tooltipText = [];
                    // Highlight all related nodes
                    relations.forEach(rel => {
                        const targetNode = nodes.get(rel.target);
                        if (targetNode) {
                            targetNode.classList.add('highlight');
                            tooltipText.push(`'${targetNode.textContent}' (${rel.type})`);
                        }
                    });

                    tooltip.innerHTML = tooltipText.join('<br>');
                    tooltip.style.display = 'block';
                });

                nodeEl.addEventListener('mouseout', () => {
                    // Remove all highlights from all nodes
                    document.querySelectorAll('.highlight').forEach(h => h.classList.remove('highlight'));
                    tooltip.style.display = 'none';
                });
            });
        });
    </script>

</body>
</html>

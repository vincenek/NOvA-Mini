<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxNaija | Nigeria's Smart Tax Platform</title>
    <meta name="description" content="Professional tax intelligence platform for Nigerian individuals and businesses">
    <meta name="theme-color" content="#006400">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary: #006400;
            --primary-dark: #004d00;
            --primary-light: #4caf50;
            --secondary: #1a237e;
            --accent: #ff9800;
            --accent-dark: #e68900;
            --text: #333333;
            --text-light: #666666;
            --background: #f8f9fa;
            --white: #ffffff;
            --gray-light: #e9ecef;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 8px;
            --transition: all 0.3s ease;
            --sidebar-width: 250px;
            --error: #dc3545;
            --success: #28a745;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Onboarding Styles */
        .onboarding-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .onboarding-content {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }

        .onboarding-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 1.5rem;
            text-align: center;
        }

        .onboarding-body {
            padding: 2rem;
        }

        .onboarding-step {
            display: none;
            text-align: center;
        }

        .onboarding-step.active {
            display: block;
        }

        .onboarding-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .onboarding-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .onboarding-description {
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .onboarding-feature {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            text-align: left;
        }

        .onboarding-feature i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .onboarding-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* Authentication Styles */
        .auth-container {
            display: flex;
            min-height: 100vh;
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .auth-left {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--white);
        }

        .auth-content {
            max-width: 500px;
            text-align: center;
        }

        .auth-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        .auth-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .auth-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .auth-features {
            text-align: left;
            margin-top: 2rem;
        }

        .auth-feature {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .auth-feature i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        .auth-right {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: var(--white);
        }

        .auth-form-container {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 100, 0, 0.1);
        }

        .form-error {
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: var(--gray-light);
            color: var(--text-light);
            cursor: not-allowed;
            transform: none;
        }

        .btn-accent {
            background: var(--accent);
        }

        .btn-accent:hover {
            background: var(--accent-dark);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: rgba(0, 100, 0, 0.05);
        }

        .btn-block {
            width: 100%;
        }

        .auth-divider {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gray-light);
        }

        .auth-divider span {
            background: var(--white);
            padding: 0 1rem;
            color: var(--text-light);
        }

        .auth-footer {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: var(--white);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-text p {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem 1.5rem;
            color: var(--white);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--accent);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-badge {
            background: var(--accent);
            color: var(--white);
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 0.7rem;
            margin-left: auto;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .top-bar {
            background: var(--white);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--background);
            border-radius: var(--radius);
            padding: 0.5rem 1rem;
            width: 300px;
        }

        .search-bar input {
            border: none;
            background: transparent;
            width: 100%;
            padding: 0.5rem;
            outline: none;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent);
            color: var(--white);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 200px;
            padding: 0.5rem 0;
            z-index: 1000;
            display: none;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.8rem 1rem;
            color: var(--text);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
        }

        .dropdown-item:hover {
            background: var(--background);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--gray-light);
            margin: 0.5rem 0;
        }

        /* Notification Dropdown */
        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .notification-dropdown.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-title {
            font-weight: 600;
            color: var(--primary);
        }

        .notification-list {
            list-style: none;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            gap: 10px;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: var(--background);
        }

        .notification-item.unread {
            background: rgba(0, 100, 0, 0.05);
        }

        .notification-icon-small {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-message {
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .notification-actions {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .tab-header {
            margin-bottom: 2rem;
        }

        .tab-header h2 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .tab-header p {
            color: var(--text-light);
        }

        /* Dashboard Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .trend-up {
            color: var(--primary-light);
        }

        .trend-down {
            color: #f44336;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .dashboard-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .deadline-list, .activity-list {
            list-style: none;
        }

        .deadline-item, .activity-item {
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deadline-item:last-child, .activity-item:last-child {
            border-bottom: none;
        }

        .deadline-icon, .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
        }

        .deadline-info, .activity-info {
            flex: 1;
        }

        .deadline-title, .activity-title {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .deadline-date, .activity-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .deadline-status {
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .status-upcoming {
            background: #fff3cd;
            color: #856404;
        }

        .status-due {
            background: #f8d7da;
            color: #721c24;
        }

        /* Community Tab Styles */
        .community-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .post-form {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .post-input {
            width: 100%;
            min-height: 100px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 1rem;
            resize: vertical;
            margin-bottom: 1rem;
            font-family: inherit;
        }

        .post-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-options {
            display: flex;
            gap: 1rem;
        }

        .post-option {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-light);
            cursor: pointer;
        }

        .post-option:hover {
            color: var(--primary);
        }

        .feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .post-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .post-user {
            flex: 1;
        }

        .post-name {
            font-weight: 600;
        }

        .post-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .post-content {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 1rem;
        }

        .post-tag {
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-light);
        }

        .post-actions-footer {
            display: flex;
            gap: 1rem;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .post-action:hover {
            color: var(--primary);
        }

        .post-action.liked {
            color: #e74c3c;
        }

        /* Calculator Styles */
        .calculator-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .calculator-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 2rem;
            text-align: center;
        }

        .calculator-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .calculator-header p {
            opacity: 0.9;
        }

        .progress-bar {
            height: 6px;
            background: var(--gray-light);
            width: 100%;
            margin-top: 1.5rem;
        }

        .progress {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: var(--transition);
        }

        .calculator-body {
            padding: 2rem;
        }

        .calculator-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .calculator-step.active {
            display: block;
        }

        .step-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .step-description {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--text-light);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-card {
            background: var(--white);
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .option-card:hover {
            border-color: var(--primary-light);
            transform: translateY(-5px);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: rgba(0, 100, 0, 0.05);
        }

        .option-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .option-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .option-description {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .input-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 100, 0, 0.1);
        }

        .input-hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .amount-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .amount-option {
            background: var(--white);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .amount-option:hover {
            border-color: var(--primary);
            background: rgba(0, 100, 0, 0.05);
        }

        .amount-option.selected {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .amount-in-words {
            margin-top: 0.5rem;
            padding: 0.8rem;
            background: rgba(0, 100, 0, 0.05);
            border-radius: var(--radius);
            border-left: 3px solid var(--primary);
            font-style: italic;
            min-height: 50px;
        }

        .official-docs-link {
            margin-top: 1rem;
            text-align: center;
        }

        .official-docs-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .official-docs-link a:hover {
            text-decoration: underline;
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #856404;
        }

        .disclaimer h4 {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .calculator-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-light);
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gray-light);
            transition: var(--transition);
        }

        .step-dot.active {
            background: var(--primary);
        }

        /* Results Section */
        .results-container {
            max-width: 800px;
            margin: 2rem auto;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: none;
        }

        .results-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 2rem;
            text-align: center;
        }

        .results-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .results-body {
            padding: 2rem;
        }

        .tax-summary {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(0, 100, 0, 0.05);
            border-radius: var(--radius);
        }

        .tax-amount {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 1rem 0;
        }

        .tax-breakdown {
            margin: 1.5rem 0;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .tax-tip {
            background: #e8f5e9;
            border-left: 4px solid var(--primary-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-top: 1.5rem;
        }

        .tax-tip h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        /* History Styles */
        .history-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            background: var(--white);
        }

        .history-table {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            background: var(--primary);
            color: var(--white);
            padding: 1rem;
            font-weight: 600;
        }

        .table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            padding: 1rem;
            border-bottom: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .table-row:hover {
            background: rgba(0, 100, 0, 0.03);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-paid {
            background: #e8f5e9;
            color: var(--primary);
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-overdue {
            background: #f8d7da;
            color: #721c24;
        }

        /* Resources Styles */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .resource-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .resource-card:hover {
            transform: translateY(-5px);
        }

        .resource-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .resource-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .resource-description {
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .resource-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 1rem;
        }

        .resource-tag {
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Settings Styles */
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .settings-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .settings-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 100, 0, 0.1);
            color: var(--primary);
        }

        .settings-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .settings-form {
            display: grid;
            gap: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Payment Modal Styles */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .payment-method {
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .payment-method.selected {
            border-color: var(--primary);
            background: rgba(0, 100, 0, 0.05);
        }

        .payment-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .payment-name {
            font-weight: 500;
            margin-bottom: 0.3rem;
        }

        .payment-description {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Mobile Styles */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast i {
            font-size: 1.2rem;
        }

        .toast.error {
            background: var(--error);
        }

        .toast.success {
            background: var(--success);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Image Preview */
        .image-preview {
            margin-top: 1rem;
            display: none;
        }

        .image-preview img {
            max-width: 200px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .remove-image {
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: absolute;
            top: -8px;
            right: -8px;
        }

        .image-preview-container {
            position: relative;
            display: inline-block;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .auth-left, .auth-right {
                padding: 1rem;
            }
            
            .auth-title {
                font-size: 2rem;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-bar {
                width: 200px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .calculator-body, .results-body {
                padding: 1.5rem;
            }

            .actions {
                flex-direction: column;
            }

            .table-header, .table-row {
                grid-template-columns: 1fr 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .resources-grid {
                grid-template-columns: 1fr;
            }

            .notification-dropdown {
                width: 300px;
                right: -50px;
            }

            .payment-methods {
                grid-template-columns: 1fr;
            }

            .post-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .post-options {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Onboarding Container -->
    <div class="onboarding-container" id="onboarding-container">
        <div class="onboarding-content">
            <div class="onboarding-header">
                <h2>Welcome to TaxNaija</h2>
            </div>
            <div class="onboarding-body">
                <!-- Step 1: Welcome -->
                <div class="onboarding-step active" id="onboarding-step-1">
                    <div class="onboarding-icon">💰</div>
                    <h3 class="onboarding-title">Welcome to TaxNaija</h3>
                    <p class="onboarding-description">Your smart tax companion for navigating Nigeria's tax system</p>
                    
                    <div style="text-align: left; margin: 2rem 0;">
                        <div class="onboarding-feature">
                            <i class="fas fa-calculator"></i>
                            <div>
                                <h4>Smart Tax Calculator</h4>
                                <p>Calculate your tax obligations accurately</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-history"></i>
                            <div>
                                <h4>Tax History Tracking</h4>
                                <p>Keep track of all your tax calculations</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-book"></i>
                            <div>
                                <h4>Official Resources</h4>
                                <p>Access official tax documents and guidelines</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="onboarding-footer">
                        <button class="btn btn-outline" id="skip-onboarding">Skip</button>
                        <button class="btn" id="next-onboarding-1">Next</button>
                    </div>
                </div>
                
                <!-- Step 2: Personalization -->
                <div class="onboarding-step" id="onboarding-step-2">
                    <div class="onboarding-icon">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <h3 class="onboarding-title">Personalize Your Experience</h3>
                    <p class="onboarding-description">Tell us about yourself to get tailored tax advice</p>
                    
                    <div class="form-group">
                        <label for="onboarding-user-type" class="form-label">I am primarily a:</label>
                        <select id="onboarding-user-type" class="form-control">
                            <option value="individual">Individual Taxpayer</option>
                            <option value="business">Business Owner</option>
                            <option value="both">Both Individual & Business</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="onboarding-income" class="form-label">My annual income/turnover is approximately:</label>
                        <select id="onboarding-income" class="form-control">
                            <option value="0-1m">Below ₦1 Million</option>
                            <option value="1m-5m">₦1 Million - ₦5 Million</option>
                            <option value="5m-25m">₦5 Million - ₦25 Million</option>
                            <option value="25m+">Above ₦25 Million</option>
                        </select>
                    </div>
                    
                    <div class="onboarding-footer">
                        <button class="btn btn-outline" id="back-onboarding-2">Back</button>
                        <button class="btn" id="next-onboarding-2">Next</button>
                    </div>
                </div>
                
                <!-- Step 3: Features -->
                <div class="onboarding-step" id="onboarding-step-3">
                    <div class="onboarding-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h3 class="onboarding-title">Get Started Quickly</h3>
                    <p class="onboarding-description">Here's how to make the most of TaxNaija</p>
                    
                    <div style="text-align: left; margin: 2rem 0;">
                        <div class="onboarding-feature">
                            <i class="fas fa-play-circle"></i>
                            <div>
                                <h4>Start with the Calculator</h4>
                                <p>Use our step-by-step tax calculator to estimate your obligations</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-bookmark"></i>
                            <div>
                                <h4>Save Your Calculations</h4>
                                <p>Keep track of all your tax estimates for future reference</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-bell"></i>
                            <div>
                                <h4>Set Up Reminders</h4>
                                <p>Get notified about important tax deadlines</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="onboarding-footer">
                        <button class="btn btn-outline" id="back-onboarding-3">Back</button>
                        <button class="btn" id="complete-onboarding">Get Started</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Screen -->
    <div class="auth-container" id="auth-container">
        <div class="auth-left">
            <div class="auth-content">
                <div class="auth-logo">💰</div>
                <h1 class="auth-title">TaxNaija</h1>
                <p class="auth-subtitle">Nigeria's Smart Tax Platform</p>
                
                <div class="auth-features">
                    <div class="auth-feature">
                        <i class="fas fa-calculator"></i>
                        <div>
                            <h3>Smart Tax Calculator</h3>
                            <p>Calculate your tax obligations accurately</p>
                        </div>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-history"></i>
                        <div>
                            <h3>Tax History Tracking</h3>
                            <p>Keep track of all your tax calculations</p>
                        </div>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-file-alt"></i>
                        <div>
                            <h3>Official Resources</h3>
                            <p>Access official tax documents and guidelines</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="auth-right">
            <div class="auth-form-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="signin">Sign In</div>
                    <div class="auth-tab" data-tab="signup">Sign Up</div>
                </div>
                
                <!-- Sign In Form -->
                <form class="auth-form active" id="signin-form">
                    <div class="form-group">
                        <label for="signin-email" class="form-label">Email Address</label>
                        <input type="email" id="signin-email" class="form-control" placeholder="Enter your email" required>
                        <div class="form-error" id="signin-email-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signin-password" class="form-label">Password</label>
                        <input type="password" id="signin-password" class="form-control" placeholder="Enter your password" required>
                        <div class="form-error" id="signin-password-error"></div>
                    </div>
                    <button type="submit" class="btn btn-block" id="signin-btn">
                        <span>Sign In</span>
                        <div class="loading" style="display: none;"></div>
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <button type="button" class="btn btn-outline btn-block" id="demo-signin-btn">
                        <i class="fas fa-user"></i> Try Demo Account
                    </button>
                    
                    <div class="auth-footer">
                        <a href="#" id="forgot-password">Forgot your password?</a>
                    </div>
                </form>
                
                <!-- Sign Up Form -->
                <form class="auth-form" id="signup-form">
                    <div class="form-group">
                        <label for="signup-name" class="form-label">Full Name</label>
                        <input type="text" id="signup-name" class="form-control" placeholder="Enter your full name" required>
                        <div class="form-error" id="signup-name-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-email" class="form-label">Email Address</label>
                        <input type="email" id="signup-email" class="form-control" placeholder="Enter your email" required>
                        <div class="form-error" id="signup-email-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-password" class="form-label">Password</label>
                        <input type="password" id="signup-password" class="form-control" placeholder="Create a password" required>
                        <div class="form-error" id="signup-password-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm-password" class="form-label">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="form-control" placeholder="Confirm your password" required>
                        <div class="form-error" id="signup-confirm-password-error"></div>
                    </div>
                    <button type="submit" class="btn btn-block" id="signup-btn">
                        <span>Create Account</span>
                        <div class="loading" style="display: none;"></div>
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <button type="button" class="btn btn-outline btn-block" id="demo-signup-btn">
                        <i class="fas fa-user"></i> Try Demo Account
                    </button>
                    
                    <div class="auth-footer">
                        By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">💰</div>
                <div class="logo-text">
                    <h1>TaxNaija</h1>
                    <p>Nigeria's Smart Tax Platform</p>
                </div>
            </div>
            <div class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-tab="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#calculator" class="nav-item" data-tab="calculator">
                    <i class="fas fa-calculator"></i>
                    <span>Tax Calculator</span>
                    <span class="nav-badge">NEW</span>
                </a>
                <a href="#history" class="nav-item" data-tab="history">
                    <i class="fas fa-history"></i>
                    <span>Tax History</span>
                </a>
                <a href="#community" class="nav-item" data-tab="community">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </a>
                <a href="#resources" class="nav-item" data-tab="resources">
                    <i class="fas fa-book"></i>
                    <span>Resources</span>
                </a>
                <a href="#settings" class="nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search tax resources...">
                </div>
                <div class="user-actions">
                    <div class="notification-icon" id="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                        <div class="notification-dropdown" id="notification-dropdown">
                            <div class="notification-header">
                                <div class="notification-title">Notifications</div>
                                <a href="#" style="color: var(--primary); font-size: 0.9rem;">Mark all as read</a>
                            </div>
                            <ul class="notification-list" id="notification-list">
                                <!-- Notifications will be populated by JavaScript -->
                            </ul>
                            <div class="notification-actions">
                                <a href="#" style="color: var(--primary); font-size: 0.9rem;">View all notifications</a>
                            </div>
                        </div>
                    </div>
                    <div class="user-profile" id="user-profile">
                        <div class="user-avatar" id="user-avatar">JD</div>
                        <div>
                            <div id="user-name">Demo User</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);" id="user-email">demo@taxnaija.com</div>
                        </div>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="#" class="dropdown-item" data-tab="dashboard">
                                <i class="fas fa-user"></i>
                                <span>My Profile</span>
                            </a>
                            <a href="#settings" class="dropdown-item" data-tab="settings">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" id="signout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Sign Out</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Content -->
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="tab-header">
                    <h2>Tax Dashboard</h2>
                    <p id="dashboard-greeting">Welcome back! Here's your tax overview.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-tax-paid">₦0</div>
                            <div class="stat-label">Total Tax Paid (YTD)</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Start using the platform</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--accent);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="upcoming-deadlines">0</div>
                            <div class="stat-label">Upcoming Deadlines</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-check-circle"></i>
                                <span>All caught up</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--secondary);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="estimated-savings">₦0</div>
                            <div class="stat-label">Estimated Savings</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Use calculator to optimize</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Upcoming Deadlines</div>
                            <a href="#" style="color: var(--primary); font-size: 0.9rem;">View All</a>
                        </div>
                        <ul class="deadline-list" id="deadline-list">
                            <!-- Dynamic content will be populated by JavaScript -->
                        </ul>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Recent Activity</div>
                            <a href="#" style="color: var(--primary); font-size: 0.9rem;">View All</a>
                        </div>
                        <ul class="activity-list" id="activity-list">
                            <!-- Dynamic content will be populated by JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Calculator Tab -->
            <div class="tab-content" id="calculator">
                <div class="tab-header">
                    <h2>Tax Calculator</h2>
                    <p>Calculate your tax obligations in Nigeria with our intelligent calculator</p>
                </div>

                <!-- Onboarding Container -->
                <div class="calculator-container" id="calculator-container">
                    <div class="calculator-header">
                        <h2>Let's Calculate Your Tax</h2>
                        <p>Answer a few simple questions to get your personalized tax estimate</p>
                        <div class="progress-bar">
                            <div class="progress" id="progress-bar"></div>
                        </div>
                    </div>

                    <div class="calculator-body">
                        <!-- Step 1: Welcome -->
                        <div class="calculator-step active" id="step-1">
                            <h3 class="step-title">Welcome to TaxNaija</h3>
                            <p class="step-description">We'll help you understand your tax obligations in Nigeria with simple, easy-to-understand questions.</p>
                            
                            <div class="options-grid">
                                <div class="option-card" data-value="individual">
                                    <div class="option-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="option-title">I'm an Individual</div>
                                    <div class="option-description">Calculate personal income tax</div>
                                </div>
                                <div class="option-card" data-value="business">
                                    <div class="option-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div class="option-title">I have a Business</div>
                                    <div class="option-description">Calculate company tax</div>
                                </div>
                            </div>

                            <div class="disclaimer">
                                <h4><i class="fas fa-info-circle"></i> Important Disclaimer</h4>
                                <p>This tool provides estimates for informational purposes only. Tax laws change frequently and your actual tax liability may vary. Always consult with a qualified tax professional for personalized advice.</p>
                            </div>

                            <div class="calculator-footer">
                                <div></div> <!-- Empty div for spacing -->
                                <button class="btn btn-accent" id="step-1-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 2: Income Type -->
                        <div class="calculator-step" id="step-2">
                            <h3 class="step-title">How Do You Earn Money?</h3>
                            <p class="step-description">Select the main way you earn income</p>
                            
                            <div class="options-grid" id="income-type-options">
                                <!-- Options will be populated by JavaScript based on previous selection -->
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-2-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-2-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 3: Turnover/Income -->
                        <div class="calculator-step" id="step-3">
                            <h3 class="step-title" id="step-3-title">What Is Your Annual Income?</h3>
                            <p class="step-description" id="step-3-description">Enter your total income for the year</p>
                            
                            <div class="input-group">
                                <label for="income-amount" id="income-label">Annual Income (₦)</label>
                                <input type="number" id="income-amount" class="input-control" placeholder="Enter amount">
                                
                                <div class="amount-options" id="income-amount-options">
                                    <!-- Amount options will be populated by JavaScript -->
                                </div>
                                
                                <div class="amount-in-words" id="income-amount-words">
                                    Amount in words will appear here
                                </div>
                                
                                <div class="input-hint" id="income-hint">This helps us calculate your tax accurately</div>
                            </div>

                            <div class="official-docs-link">
                                <a href="https://www.firs.gov.ng" target="_blank">
                                    <i class="fas fa-external-link-alt"></i> View Official FIRS Tax Guidelines
                                </a>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-3-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-3-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 4: Additional Details -->
                        <div class="calculator-step" id="step-4">
                            <h3 class="step-title" id="step-4-title">Any Allowances or Deductions?</h3>
                            <p class="step-description" id="step-4-description">These can reduce the amount of tax you pay</p>
                            
                            <div class="input-group">
                                <label for="allowances" id="allowances-label">Annual Allowances & Deductions (₦)</label>
                                <input type="number" id="allowances" class="input-control" placeholder="Enter amount (optional)">
                                
                                <div class="amount-options" id="allowances-amount-options">
                                    <!-- Amount options will be populated by JavaScript -->
                                </div>
                                
                                <div class="amount-in-words" id="allowances-amount-words">
                                    Amount in words will appear here
                                </div>
                                
                                <div class="input-hint" id="allowances-hint">Examples: Pension contributions, NHF, dependents</div>
                            </div>

                            <div class="official-docs-link">
                                <a href="https://www.firs.gov.ng/individuals/allowable-deductions" target="_blank">
                                    <i class="fas fa-external-link-alt"></i> View Official Allowable Deductions
                                </a>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-4-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-4-next">
                                    Calculate Tax <i class="fas fa-calculator"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 5: Processing -->
                        <div class="calculator-step" id="step-5">
                            <h3 class="step-title">Calculating Your Tax</h3>
                            <p class="step-description">Our smart system is analyzing your information...</p>
                            
                            <div style="text-align: center; margin: 2rem 0;">
                                <i class="fas fa-cog fa-spin" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                                <p>Please wait while we calculate your tax obligations</p>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-5-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-5-next" disabled>
                                    Processing <i class="fas fa-spinner fa-spin"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Container -->
                <div class="results-container" id="results-container">
                    <div class="results-header">
                        <h2>Your Tax Analysis</h2>
                        <p>Here's your personalized tax estimate</p>
                    </div>

                    <div class="results-body">
                        <div class="tax-summary">
                            <p>Based on your information, your estimated tax is:</p>
                            <div class="tax-amount" id="calculated-tax">₦0</div>
                            <p>per year</p>
                        </div>

                        <div class="tax-breakdown">
                            <div class="breakdown-item">
                                <span>Taxable Income:</span>
                                <span id="taxable-income">₦0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Tax Rate:</span>
                                <span id="tax-rate">0%</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Allowances & Deductions:</span>
                                <span id="total-allowances">₦0</span>
                            </div>
                            <div class="breakdown-item">
                                <span><strong>Net Tax Payable:</strong></span>
                                <span><strong id="net-tax">₦0</strong></span>
                            </div>
                        </div>

                        <div class="tax-tip">
                            <h4><i class="fas fa-lightbulb"></i> Smart Tax Tip</h4>
                            <p id="optimization-tip">Based on your profile, we recommend maximizing your pension contributions to reduce taxable income.</p>
                        </div>

                        <div class="disclaimer">
                            <h4><i class="fas fa-info-circle"></i> Important Disclaimer</h4>
                            <p>This calculation is an estimate based on the information provided. Actual tax liability may vary based on specific circumstances, recent tax law changes, and additional factors not considered in this calculation. Always consult with a qualified tax professional for personalized advice.</p>
                        </div>

                        <div class="official-docs-link" style="text-align: center; margin-top: 1rem;">
                            <a href="https://www.firs.gov.ng" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Verify with Official FIRS Guidelines
                            </a>
                        </div>

                        <div class="actions">
                            <button class="btn btn-outline" id="restart-btn">
                                <i class="fas fa-redo"></i> Start Over
                            </button>
                            <button class="btn" id="save-result">
                                <i class="fas fa-download"></i> Save Result
                            </button>
                            <button class="btn btn-accent" id="payment-btn">
                                <i class="fas fa-credit-card"></i> Make Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history">
                <div class="tab-header">
                    <h2>Tax History</h2>
                    <p>View your tax calculation history and payment records</p>
                </div>

                <div class="history-filters">
                    <select class="filter-select" id="history-type-filter">
                        <option value="all">All Types</option>
                        <option value="individual">Personal Income Tax</option>
                        <option value="business">Company Income Tax</option>
                        <option value="vat">Value Added Tax</option>
                    </select>
                    <select class="filter-select" id="history-status-filter">
                        <option value="all">All Status</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                    </select>
                    <select class="filter-select" id="history-date-filter">
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 3 Months</option>
                        <option value="180">Last 6 Months</option>
                        <option value="365">Last Year</option>
                    </select>
                </div>

                <div class="history-table">
                    <div class="table-header">
                        <div>Date</div>
                        <div>Type</div>
                        <div>Amount</div>
                        <div>Status</div>
                        <div>Actions</div>
                    </div>
                    <div id="history-table-body">
                        <!-- Dynamic content will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Community Tab -->
            <div class="tab-content" id="community">
                <div class="tab-header">
                    <h2>Tax Community</h2>
                    <p>Share insights, ask questions, and connect with other taxpayers</p>
                </div>

                <div class="community-container">
                    <div class="post-form">
                        <textarea class="post-input" id="post-content" placeholder="Share your tax tip, question, or experience..."></textarea>
                        <div class="post-actions">
                            <div class="post-options">
                                <div class="post-option" id="add-image-btn">
                                    <i class="fas fa-image"></i>
                                    <span>Photo</span>
                                    <input type="file" id="image-upload" accept="image/*" style="display: none;">
                                </div>
                                <div class="post-option" id="add-link-btn">
                                    <i class="fas fa-link"></i>
                                    <span>Link</span>
                                </div>
                                <div class="post-option" id="add-tag-btn">
                                    <i class="fas fa-hashtag"></i>
                                    <span>Tag</span>
                                </div>
                            </div>
                            <button class="btn" id="submit-post-btn">Post</button>
                        </div>
                        <div class="image-preview" id="image-preview">
                            <!-- Image previews will be added here -->
                        </div>
                    </div>

                    <div class="feed" id="community-feed">
                        <!-- Community posts will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Resources Tab -->
            <div class="tab-content" id="resources">
                <div class="tab-header">
                    <h2>Tax Resources</h2>
                    <p>Educational materials and official tax resources</p>
                </div>

                <!-- Custom Resources Section -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <div class="settings-header">
                        <div class="settings-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="settings-title">My Resource Links</div>
                    </div>
                    <div class="settings-form">
                        <div class="input-group">
                            <label for="resource-title" class="form-label">Resource Title</label>
                            <input type="text" id="resource-title" class="input-control" placeholder="Enter resource title">
                        </div>
                        <div class="input-group">
                            <label for="resource-url" class="form-label">Resource URL</label>
                            <input type="url" id="resource-url" class="input-control" placeholder="https://example.com">
                        </div>
                        <div class="input-group">
                            <label for="resource-type" class="form-label">Resource Type</label>
                            <select id="resource-type" class="input-control">
                                <option value="google-doc">Google Doc</option>
                                <option value="ebook">E-Book</option>
                                <option value="website">Website</option>
                                <option value="video">Video</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <button class="btn" id="add-resource-btn" style="align-self: flex-start;">
                            <i class="fas fa-plus"></i> Add Resource
                        </button>
                    </div>
                </div>

                <!-- Custom Resources List -->
                <div class="settings-section" style="margin-bottom: 2rem;">
                    <div class="settings-header">
                        <div class="settings-icon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                        <div class="settings-title">My Saved Resources</div>
                    </div>
                    <div id="custom-resources-list">
                        <p style="text-align: center; color: var(--text-light); padding: 2rem;">No resources added yet. Add your first resource above.</p>
                    </div>
                </div>

                <!-- Default Resources -->
                <div class="resources-grid">
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="resource-title">Personal Income Tax Guide</div>
                        <div class="resource-description">
                            Comprehensive guide to understanding and calculating personal income tax in Nigeria.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Individuals</span>
                            <span class="resource-tag">PIT</span>
                            <span class="resource-tag">FIRS</span>
                        </div>
                        <button class="btn" onclick="downloadResource('Personal Income Tax Guide')">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="resource-title">VAT Compliance Tutorial</div>
                        <div class="resource-description">
                            Step-by-step video tutorial on VAT registration, filing, and payment processes.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Business</span>
                            <span class="resource-tag">VAT</span>
                            <span class="resource-tag">Compliance</span>
                        </div>
                        <button class="btn" onclick="watchVideo('VAT Compliance Tutorial')">
                            <i class="fas fa-play"></i> Watch
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="resource-title">2025 Tax Calendar</div>
                        <div class="resource-description">
                            Complete tax calendar with all important deadlines for individuals and businesses.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Calendar</span>
                            <span class="resource-tag">Deadlines</span>
                            <span class="resource-tag">2025</span>
                        </div>
                        <button class="btn" onclick="downloadResource('2025 Tax Calendar')">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div class="resource-title">Tax Laws & Regulations</div>
                        <div class="resource-description">
                            Updated compilation of Nigerian tax laws, regulations, and official guidelines.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Legal</span>
                            <span class="resource-tag">Regulations</span>
                            <span class="resource-tag">Compliance</span>
                        </div>
                        <button class="btn" onclick="openExternalLink('https://www.firs.gov.ng')">
                            <i class="fas fa-external-link-alt"></i> View Online
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="tab-header">
                    <h2>Settings</h2>
                    <p>Manage your account preferences and notification settings</p>
                </div>

                <div class="settings-container">
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="settings-title">Profile Information</div>
                        </div>
                        <div class="settings-form">
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="first-name">First Name</label>
                                    <input type="text" id="first-name" class="input-control" value="Demo">
                                </div>
                                <div class="input-group">
                                    <label for="last-name">Last Name</label>
                                    <input type="text" id="last-name" class="input-control" value="User">
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" class="input-control" value="demo@taxnaija.com">
                            </div>
                            <div class="input-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" class="input-control" placeholder="Enter your phone number">
                            </div>
                            <button class="btn" style="align-self: flex-start;" id="save-profile-btn">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="settings-title">Notification Preferences</div>
                        </div>
                        <div class="settings-form">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Tax Deadline Reminders</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Get notified about upcoming tax deadlines</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="deadline-reminders" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Tax Law Updates</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Receive updates when tax laws change</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="tax-updates" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Promotional Offers</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Get notified about special offers and discounts</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="promotional-offers">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="settings-title">Security</div>
                        </div>
                        <div class="settings-form">
                            <div class="input-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" class="input-control">
                            </div>
                            <div class="input-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" class="input-control">
                            </div>
                            <div class="input-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="input-control">
                            </div>
                            <button class="btn" style="align-self: flex-start;" id="update-password-btn">
                                <i class="fas fa-key"></i> Update Password
                            </button>
                        </div>
                    </div>

                    <!-- Logout Button -->
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <div class="settings-title">Account</div>
                        </div>
                        <div class="settings-form">
                            <button class="btn" style="background: var(--error); align-self: flex-start;" id="settings-logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for menu items -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operation completed successfully</span>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA4yX9v8u-wjIPeBY64cc7YASVWIcak-eM",
            authDomain: "vault-602d2.firebaseapp.com",
            projectId: "vault-602d2",
            storageBucket: "vault-602d2.firebasestorage.app",
            messagingSenderId: "397379271243",
            appId: "1:397379271243:web:fab5914ccdca9d796d2bce",
            measurementId: "G-4R62KV83W2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Enhanced Nigerian tax calculation logic and data
        const nigerianTaxData = {
            individual: {
                // Personal Income Tax (PIT) brackets for Nigeria (2023 rates)
                taxBrackets: [
                    { min: 0, max: 300000, rate: 0.07 },
                    { min: 300001, max: 600000, rate: 0.11 },
                    { min: 600001, max: 1100000, rate: 0.15 },
                    { min: 1100001, max: 1600000, rate: 0.19 },
                    { min: 1600001, max: 3200000, rate: 0.21 },
                    { min: 3200001, max: Infinity, rate: 0.24 }
                ],
                consolidatedReliefAllowance: (income) => {
                    // CRA is the higher of 200,000 or 1% of gross income plus 20% of gross income
                    return Math.max(200000, (0.01 * income) + (0.2 * income));
                },
                standardDeductions: {
                    pension: 0.08, // Maximum 8% of salary
                    nhf: 0.025, // 2.5% of annual basic salary
                    lifeInsurance: 0.1, // Up to 10% of total income
                    dependentRelatives: 50000, // Per dependent up to 4
                    childrenEducation: 50000 // Per child up to 4
                },
                income: [500000, 1000000, 2000000, 5000000, 10000000],
                allowances: [50000, 100000, 200000, 500000, 1000000]
            },
            business: {
                // Company Income Tax (CIT) rates for Nigeria (2023)
                taxRates: {
                    small: 0.20, // For companies with turnover < ₦25M
                    medium: 0.25, // For companies with turnover ₦25M - ₦100M
                    large: 0.30  // For companies with turnover > ₦100M
                },
                turnoverThresholds: {
                    small: 25000000,
                    medium: 100000000
                },
                allowableDeductions: {
                    capitalAllowance: 0.1, // 10% on qualifying capital expenditure
                    staffCosts: 1.0, // 100% of staff costs
                    rent: 1.0, // 100% of rent expenses
                    utilities: 1.0, // 100% of utility costs
                    professionalFees: 1.0 // 100% of professional fees
                },
                income: [1000000, 5000000, 10000000, 25000000, 50000000, 100000000],
                allowances: [100000, 500000, 1000000, 2500000, 5000000]
            },
            vat: {
                rate: 0.075, // 7.5% VAT rate in Nigeria
                registrationThreshold: 25000000 // ₦25 million turnover
            },
            states: {
                // State-level taxes and levies
                developmentLevy: 1000, // Annual per individual
                businessPremises: {
                    rural: 10000,
                    urban: 20000,
                    metropolitan: 50000
                }
            }
        };

        // Nigerian tax deadlines (updated for 2025)
        const nigerianDeadlines = [
            { title: "VAT Returns Due", date: "2025-04-21", type: "vat", status: "upcoming" },
            { title: "Personal Income Tax (Self-Assessment)", date: "2025-03-31", type: "individual", status: "due" },
            { title: "Company Income Tax", date: "2025-06-30", type: "business", status: "upcoming" },
            { title: "Education Tax", date: "2025-09-30", type: "business", status: "upcoming" },
            { title: "State Development Levy", date: "2025-01-31", type: "individual", status: "overdue" }
        ];

        // Enhanced User data object to store responses
        const userData = {
            userType: null, // 'individual' or 'business'
            incomeType: null,
            incomeAmount: null,
            allowances: 0,
            state: "Lagos", // Default state
            hasTin: false,
            dependents: 0,
            children: 0,
            businessType: null, // For business users
            businessLocation: "urban" // For business premises levy
        };

        // Enhanced App state
        let appState = {
            currentUser: null,
            userProfile: {
                firstName: "",
                lastName: "",
                email: "",
                phone: "",
                userType: "individual",
                state: "Lagos",
                hasTin: false,
                dependents: 0,
                children: 0
            },
            settings: {
                notifications: true,
                taxUpdates: true,
                darkMode: false
            },
            customResources: [],
            notifications: [],
            communityPosts: [],
            taxHistory: []
        };

        // DOM elements
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const sidebar = document.getElementById('sidebar');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const navItems = document.querySelectorAll('.nav-item');
        const tabContents = document.querySelectorAll('.tab-content');
        const calculatorContainer = document.getElementById('calculator-container');
        const resultsContainer = document.getElementById('results-container');
        const progressBar = document.getElementById('progress-bar');
        const steps = document.querySelectorAll('.calculator-step');
        const stepIndicators = document.querySelectorAll('.step-dot');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalClose = document.getElementById('modal-close');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const userProfile = document.getElementById('user-profile');
        const userDropdown = document.getElementById('user-dropdown');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const dashboardGreeting = document.getElementById('dashboard-greeting');
        const onboardingContainer = document.getElementById('onboarding-container');
        const notificationIcon = document.getElementById('notification-icon');
        const notificationDropdown = document.getElementById('notification-dropdown');
        const notificationList = document.getElementById('notification-list');
        const communityFeed = document.getElementById('community-feed');
        const postContent = document.getElementById('post-content');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const submitPostBtn = document.getElementById('submit-post-btn');

        // Authentication DOM elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');
        const signinBtn = document.getElementById('signin-btn');
        const signupBtn = document.getElementById('signup-btn');
        const demoSigninBtn = document.getElementById('demo-signin-btn');
        const demoSignupBtn = document.getElementById('demo-signup-btn');
        const signoutBtn = document.getElementById('signout-btn');
        const settingsLogoutBtn = document.getElementById('settings-logout-btn');

        // Resource management elements
        const addResourceBtn = document.getElementById('add-resource-btn');
        const customResourcesList = document.getElementById('custom-resources-list');

        // Initialize the app
        function initApp() {
            setupEventListeners();
            setupAuthEventListeners();
            setupResourceEventListeners();
            setupCommunityEventListeners();
            
            // Check if user is logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    appState.currentUser = user;
                    loadUserProfile(user.uid);
                    showApp();
                } else {
                    // User is signed out
                    showAuth();
                }
            });
            
            // Check if user has completed onboarding
            const hasCompletedOnboarding = localStorage.getItem('taxNaija_onboarding_completed');
            if (!hasCompletedOnboarding) {
                showOnboarding();
            }
        }

        // Show onboarding
        function showOnboarding() {
            onboardingContainer.style.display = 'flex';
            setupOnboardingEventListeners();
        }

        // Setup onboarding event listeners
        function setupOnboardingEventListeners() {
            // Step navigation
            document.getElementById('next-onboarding-1').addEventListener('click', () => {
                document.getElementById('onboarding-step-1').classList.remove('active');
                document.getElementById('onboarding-step-2').classList.add('active');
            });
            
            document.getElementById('back-onboarding-2').addEventListener('click', () => {
                document.getElementById('onboarding-step-2').classList.remove('active');
                document.getElementById('onboarding-step-1').classList.add('active');
            });
            
            document.getElementById('next-onboarding-2').addEventListener('click', () => {
                document.getElementById('onboarding-step-2').classList.remove('active');
                document.getElementById('onboarding-step-3').classList.add('active');
            });
            
            document.getElementById('back-onboarding-3').addEventListener('click', () => {
                document.getElementById('onboarding-step-3').classList.remove('active');
                document.getElementById('onboarding-step-2').classList.add('active');
            });
            
            // Complete onboarding
            document.getElementById('complete-onboarding').addEventListener('click', () => {
                localStorage.setItem('taxNaija_onboarding_completed', 'true');
                onboardingContainer.style.display = 'none';
                showToast('Onboarding completed!', 'success');
            });
            
            // Skip onboarding
            document.getElementById('skip-onboarding').addEventListener('click', () => {
                localStorage.setItem('taxNaija_onboarding_completed', 'true');
                onboardingContainer.style.display = 'none';
            });
        }

        // Show authentication screen
        function showAuth() {
            authContainer.style.display = 'flex';
            appContainer.style.display = 'none';
            onboardingContainer.style.display = 'none';
        }

        // Show main app
        function showApp() {
            authContainer.style.display = 'none';
            appContainer.style.display = 'flex';
            onboardingContainer.style.display = 'none';
            updateDashboard();
            loadTaxHistory();
            loadCustomResources();
            updateUserUI();
            loadNotifications();
            loadCommunityFeed();
        }

        // Load user profile from Firestore
        function loadUserProfile(userId) {
            db.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        appState.userProfile = { ...appState.userProfile, ...doc.data() };
                        updateUserUI();
                    } else {
                        // Create a new user profile
                        const newUserProfile = {
                            firstName: appState.currentUser.displayName ? appState.currentUser.displayName.split(' ')[0] : 'User',
                            lastName: appState.currentUser.displayName ? appState.currentUser.displayName.split(' ').slice(1).join(' ') : '',
                            email: appState.currentUser.email,
                            phone: '',
                            userType: 'individual',
                            state: 'Lagos',
                            hasTin: false,
                            dependents: 0,
                            children: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        db.collection('users').doc(userId).set(newUserProfile)
                            .then(() => {
                                appState.userProfile = newUserProfile;
                                updateUserUI();
                            })
                            .catch(error => {
                                console.error('Error creating user profile:', error);
                                showToast('Error creating user profile', 'error');
                            });
                    }
                })
                .catch(error => {
                    console.error('Error loading user profile:', error);
                    showToast('Error loading user profile', 'error');
                });
        }

        // Update UI with user data
        function updateUserUI() {
            // Update user profile in top bar
            const firstName = appState.userProfile.firstName || 'User';
            const lastName = appState.userProfile.lastName || '';
            const fullName = `${firstName} ${lastName}`.trim();
            
            userName.textContent = fullName;
            userEmail.textContent = appState.userProfile.email || appState.currentUser.email;
            
            // Update user avatar with initials
            const initials = (firstName.charAt(0) + (lastName.charAt(0) || '')).toUpperCase();
            userAvatar.textContent = initials;
            
            // Update dashboard greeting
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'Good evening';
            
            if (hour < 12) greeting = 'Good morning';
            else if (hour < 18) greeting = 'Good afternoon';
            
            dashboardGreeting.textContent = `${greeting}, ${firstName}! Here's your tax overview.`;
            
            // Update settings form
            document.getElementById('first-name').value = firstName;
            document.getElementById('last-name').value = lastName;
            document.getElementById('email').value = appState.userProfile.email || appState.currentUser.email;
            document.getElementById('phone').value = appState.userProfile.phone || '';
        }

        // Setup authentication event listeners
        function setupAuthEventListeners() {
            // Auth tabs
            authTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    authTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding form
                    authForms.forEach(form => form.classList.remove('active'));
                    document.getElementById(`${tabName}-form`).classList.add('active');
                });
            });
            
            // Sign in form
            signinForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const email = document.getElementById('signin-email').value;
                const password = document.getElementById('signin-password').value;
                
                signinBtn.querySelector('span').style.display = 'none';
                signinBtn.querySelector('.loading').style.display = 'inline-block';
                signinBtn.disabled = true;
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Signed in
                        showToast('Successfully signed in!', 'success');
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        showToast(errorMessage, 'error');
                    })
                    .finally(() => {
                        signinBtn.querySelector('span').style.display = 'inline-block';
                        signinBtn.querySelector('.loading').style.display = 'none';
                        signinBtn.disabled = false;
                    });
            });
            
            // Sign up form
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                signupBtn.querySelector('span').style.display = 'none';
                signupBtn.querySelector('.loading').style.display = 'inline-block';
                signupBtn.disabled = true;
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Signed up
                        const user = userCredential.user;
                        
                        // Update user profile
                        return user.updateProfile({
                            displayName: name
                        });
                    })
                    .then(() => {
                        showToast('Account created successfully!', 'success');
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        showToast(errorMessage, 'error');
                    })
                    .finally(() => {
                        signupBtn.querySelector('span').style.display = 'inline-block';
                        signupBtn.querySelector('.loading').style.display = 'none';
                        signupBtn.disabled = false;
                    });
            });
            
            // Demo sign in
            demoSigninBtn.addEventListener('click', () => {
                auth.signInWithEmailAndPassword('demo@taxnaija.com', 'demopassword')
                    .then((userCredential) => {
                        // Signed in
                        showToast('Welcome to TaxNaija Demo!', 'success');
                    })
                    .catch((error) => {
                        // If demo account doesn't exist, create it
                        auth.createUserWithEmailAndPassword('demo@taxnaija.com', 'demopassword')
                            .then((userCredential) => {
                                const user = userCredential.user;
                                return user.updateProfile({
                                    displayName: 'Demo User'
                                });
                            })
                            .then(() => {
                                showToast('Demo account created! Welcome to TaxNaija!', 'success');
                            })
                            .catch((error) => {
                                const errorCode = error.code;
                                const errorMessage = error.message;
                                showToast(errorMessage, 'error');
                            });
                    });
            });
            
            // Demo sign up
            demoSignupBtn.addEventListener('click', () => {
                demoSigninBtn.click();
            });
            
            // Sign out
            const signOutUser = () => {
                auth.signOut()
                    .then(() => {
                        showToast('Successfully signed out', 'success');
                    })
                    .catch((error) => {
                        showToast('Error signing out', 'error');
                    });
            };
            
            signoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signOutUser();
            });
            
            settingsLogoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signOutUser();
            });
            
            // User profile dropdown
            userProfile.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('show');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                userDropdown.classList.remove('show');
            });
        }

        // Setup resource event listeners
        function setupResourceEventListeners() {
            // Add resource button
            addResourceBtn.addEventListener('click', (e) => {
                e.preventDefault();
                
                const title = document.getElementById('resource-title').value;
                const url = document.getElementById('resource-url').value;
                const type = document.getElementById('resource-type').value;
                
                if (!title || !url) {
                    showToast('Please fill in all fields', 'error');
                    return;
                }
                
                // Add to Firestore
                const resourceData = {
                    title: title,
                    url: url,
                    type: type,
                    userId: appState.currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                db.collection('resources').add(resourceData)
                    .then(() => {
                        // Clear form
                        document.getElementById('resource-title').value = '';
                        document.getElementById('resource-url').value = '';
                        
                        showToast('Resource added successfully', 'success');
                        loadCustomResources();
                    })
                    .catch(error => {
                        console.error('Error adding resource:', error);
                        showToast('Error adding resource', 'error');
                    });
            });
        }

        // Setup community event listeners
        function setupCommunityEventListeners() {
            // Add image button
            document.getElementById('add-image-btn').addEventListener('click', () => {
                imageUpload.click();
            });
            
            // Handle image upload
            imageUpload.addEventListener('change', (e) => {
                const files = e.target.files;
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const reader = new FileReader();
                        
                        reader.onload = (e) => {
                            const imageContainer = document.createElement('div');
                            imageContainer.className = 'image-preview-container';
                            
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            
                            const removeBtn = document.createElement('button');
                            removeBtn.className = 'remove-image';
                            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                            removeBtn.addEventListener('click', () => {
                                imageContainer.remove();
                                if (imagePreview.children.length === 0) {
                                    imagePreview.style.display = 'none';
                                }
                            });
                            
                            imageContainer.appendChild(img);
                            imageContainer.appendChild(removeBtn);
                            imagePreview.appendChild(imageContainer);
                            imagePreview.style.display = 'block';
                        };
                        
                        reader.readAsDataURL(file);
                    }
                }
            });
            
            // Submit post
            submitPostBtn.addEventListener('click', () => {
                const content = postContent.value.trim();
                
                if (!content) {
                    showToast('Please enter some content for your post', 'error');
                    return;
                }
                
                submitPostBtn.disabled = true;
                submitPostBtn.innerHTML = '<div class="loading"></div> Posting...';
                
                // Upload images first if any
                const imageContainers = imagePreview.querySelectorAll('.image-preview-container');
                const uploadPromises = [];
                const imageUrls = [];
                
                if (imageContainers.length > 0) {
                    imageContainers.forEach(container => {
                        const img = container.querySelector('img');
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Resize image to reduce file size
                        const MAX_WIDTH = 800;
                        const MAX_HEIGHT = 600;
                        let width = img.naturalWidth;
                        let height = img.naturalHeight;
                        
                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const promise = new Promise((resolve, reject) => {
                            canvas.toBlob(blob => {
                                const fileName = `posts/${appState.currentUser.uid}/${Date.now()}.jpg`;
                                const uploadTask = storage.ref(fileName).put(blob);
                                
                                uploadTask.on('state_changed',
                                    (snapshot) => {
                                        // Progress monitoring if needed
                                    },
                                    (error) => {
                                        reject(error);
                                    },
                                    () => {
                                        uploadTask.snapshot.ref.getDownloadURL()
                                            .then(url => {
                                                imageUrls.push(url);
                                                resolve();
                                            })
                                            .catch(error => reject(error));
                                    }
                                );
                            }, 'image/jpeg', 0.8);
                        });
                        
                        uploadPromises.push(promise);
                    });
                }
                
                // Wait for all images to upload, then create post
                Promise.all(uploadPromises)
                    .then(() => {
                        const postData = {
                            content: content,
                            images: imageUrls,
                            userId: appState.currentUser.uid,
                            userName: appState.userProfile.firstName + ' ' + appState.userProfile.lastName,
                            userInitials: (appState.userProfile.firstName.charAt(0) + (appState.userProfile.lastName.charAt(0) || '')).toUpperCase(),
                            likes: 0,
                            comments: 0,
                            likedBy: [],
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        return db.collection('posts').add(postData);
                    })
                    .then(() => {
                        // Clear form
                        postContent.value = '';
                        imagePreview.innerHTML = '';
                        imagePreview.style.display = 'none';
                        
                        showToast('Post published successfully!', 'success');
                    })
                    .catch(error => {
                        console.error('Error creating post:', error);
                        showToast('Error publishing post', 'error');
                    })
                    .finally(() => {
                        submitPostBtn.disabled = false;
                        submitPostBtn.innerHTML = 'Post';
                    });
            });
        }

        // Load custom resources from Firestore
        function loadCustomResources() {
            if (!appState.currentUser) return;
            
            db.collection('resources')
                .where('userId', '==', appState.currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        customResourcesList.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 2rem;">No resources added yet. Add your first resource above.</p>';
                        return;
                    }
                    
                    customResourcesList.innerHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const resource = doc.data();
                        const resourceElement = document.createElement('div');
                        resourceElement.className = 'resource-card';
                        resourceElement.style.marginBottom = '1rem';
                        
                        const typeIcon = getResourceTypeIcon(resource.type);
                        const typeLabel = getResourceTypeLabel(resource.type);
                        
                        resourceElement.innerHTML = `
                            <div class="resource-icon">
                                <i class="${typeIcon}"></i>
                            </div>
                            <div class="resource-title">${resource.title}</div>
                            <div class="resource-description">
                                <a href="${resource.url}" target="_blank">${resource.url}</a>
                            </div>
                            <div class="resource-tags">
                                <span class="resource-tag">${typeLabel}</span>
                            </div>
                            <div class="actions" style="justify-content: flex-start; margin-top: 1rem;">
                                <button class="btn" onclick="openExternalLink('${resource.url}')" style="width: auto; padding: 0.5rem 1rem;">
                                    <i class="fas fa-external-link-alt"></i> Open
                                </button>
                                <button class="btn btn-outline" onclick="deleteResource('${doc.id}')" style="width: auto; padding: 0.5rem 1rem; margin-left: 0.5rem;">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        `;
                        
                        customResourcesList.appendChild(resourceElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading resources:', error);
                    showToast('Error loading resources', 'error');
                });
        }

        // Get resource type icon
        function getResourceTypeIcon(type) {
            switch(type) {
                case 'google-doc': return 'fab fa-google-drive';
                case 'ebook': return 'fas fa-book';
                case 'website': return 'fas fa-globe';
                case 'video': return 'fas fa-video';
                default: return 'fas fa-link';
            }
        }

        // Get resource type label
        function getResourceTypeLabel(type) {
            switch(type) {
                case 'google-doc': return 'Google Doc';
                case 'ebook': return 'E-Book';
                case 'website': return 'Website';
                case 'video': return 'Video';
                default: return 'Other';
            }
        }

        // Delete resource
        function deleteResource(resourceId) {
            db.collection('resources').doc(resourceId).delete()
                .then(() => {
                    showToast('Resource deleted successfully', 'success');
                    loadCustomResources();
                })
                .catch(error => {
                    console.error('Error deleting resource:', error);
                    showToast('Error deleting resource', 'error');
                });
        }

        // Load community posts from Firestore
        function loadCommunityFeed() {
            if (!appState.currentUser) return;
            
            db.collection('posts')
                .orderBy('createdAt', 'desc')
                .limit(20)
                .get()
                .then(querySnapshot => {
                    communityFeed.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        communityFeed.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 2rem;">No posts yet. Be the first to share something!</p>';
                        return;
                    }
                    
                    querySnapshot.forEach(doc => {
                        const post = doc.data();
                        const postId = doc.id;
                        const postElement = document.createElement('div');
                        postElement.className = 'post-card';
                        
                        // Format timestamp
                        const postDate = post.createdAt ? post.createdAt.toDate() : new Date();
                        const timeAgo = getTimeAgo(postDate);
                        
                        // Check if current user liked this post
                        const isLiked = post.likedBy && post.likedBy.includes(appState.currentUser.uid);
                        
                        postElement.innerHTML = `
                            <div class="post-header">
                                <div class="post-avatar">${post.userInitials}</div>
                                <div class="post-user">
                                    <div class="post-name">${post.userName}</div>
                                    <div class="post-time">${timeAgo}</div>
                                </div>
                            </div>
                            <div class="post-content">
                                ${post.content}
                            </div>
                            ${post.images && post.images.length > 0 ? `
                                <div class="post-images" style="margin-bottom: 1rem;">
                                    ${post.images.map(img => `<img src="${img}" style="max-width: 100%; border-radius: var(--radius); margin-bottom: 0.5rem;">`).join('')}
                                </div>
                            ` : ''}
                            <div class="post-footer">
                                <div class="post-actions-footer">
                                    <div class="post-action ${isLiked ? 'liked' : ''}" data-post-id="${postId}" data-action="like">
                                        <i class="fas fa-heart"></i>
                                        <span>${post.likes || 0}</span>
                                    </div>
                                    <div class="post-action" data-post-id="${postId}" data-action="comment">
                                        <i class="fas fa-comment"></i>
                                        <span>${post.comments || 0}</span>
                                    </div>
                                    <div class="post-action" data-post-id="${postId}" data-action="share">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        communityFeed.appendChild(postElement);
                    });
                    
                    // Add event listeners to post actions
                    document.querySelectorAll('.post-action[data-action="like"]').forEach(action => {
                        action.addEventListener('click', function() {
                            const postId = this.getAttribute('data-post-id');
                            togglePostLike(postId, this);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading posts:', error);
                    showToast('Error loading posts', 'error');
                });
        }

        // Toggle post like
        function togglePostLike(postId, likeElement) {
            if (!appState.currentUser) return;
            
            const postRef = db.collection('posts').doc(postId);
            
            // Get current post data
            postRef.get()
                .then(doc => {
                    if (!doc.exists) return;
                    
                    const post = doc.data();
                    const currentLikes = post.likes || 0;
                    const likedBy = post.likedBy || [];
                    const isLiked = likedBy.includes(appState.currentUser.uid);
                    
                    let newLikes;
                    let newLikedBy;
                    
                    if (isLiked) {
                        // Unlike the post
                        newLikes = currentLikes - 1;
                        newLikedBy = likedBy.filter(id => id !== appState.currentUser.uid);
                        likeElement.classList.remove('liked');
                    } else {
                        // Like the post
                        newLikes = currentLikes + 1;
                        newLikedBy = [...likedBy, appState.currentUser.uid];
                        likeElement.classList.add('liked');
                    }
                    
                    // Update the post
                    return postRef.update({
                        likes: newLikes,
                        likedBy: newLikedBy
                    });
                })
                .then(() => {
                    // Update the like count in the UI
                    const likeCount = likeElement.querySelector('span');
                    likeCount.textContent = parseInt(likeCount.textContent) + (likeElement.classList.contains('liked') ? 1 : -1);
                })
                .catch(error => {
                    console.error('Error toggling like:', error);
                    showToast('Error updating like', 'error');
                });
        }

        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffSecs < 60) {
                return 'just now';
            } else if (diffMins < 60) {
                return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
            } else if (diffHours < 24) {
                return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
            } else if (diffDays < 7) {
                return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
            } else {
                return date.toLocaleDateString();
            }
        }

        // Load notifications
        function loadNotifications() {
            // This would typically load from Firestore
            // For now, we'll use static data
            appState.notifications = [
                { id: 1, type: "deadline", message: "VAT Returns due in 2 weeks", time: "2 hours ago", read: false },
                { id: 2, type: "update", message: "New tax guidelines published for 2025", time: "1 day ago", read: false },
                { id: 3, type: "tip", message: "Tax saving tip: Consider increasing your pension contributions", time: "3 days ago", read: true }
            ];
            
            notificationList.innerHTML = '';
            
            appState.notifications.forEach(notification => {
                const notificationItem = document.createElement('li');
                notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
                
                let iconClass = 'fas fa-bell';
                if (notification.type === 'deadline') iconClass = 'fas fa-calendar-alt';
                else if (notification.type === 'update') iconClass = 'fas fa-file-alt';
                else if (notification.type === 'tip') iconClass = 'fas fa-lightbulb';
                
                notificationItem.innerHTML = `
                    <div class="notification-icon-small">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${notification.time}</div>
                    </div>
                `;
                
                notificationList.appendChild(notificationItem);
            });
        }

        // Update dashboard with user data
        function updateDashboard() {
            // Update stats
            const totalTax = appState.taxHistory.reduce((sum, record) => sum + record.taxAmount, 0);
            document.getElementById('total-tax-paid').textContent = formatCurrency(totalTax);
            
            const upcomingCount = nigerianDeadlines.filter(d => d.status === 'upcoming').length;
            document.getElementById('upcoming-deadlines').textContent = upcomingCount;
            
            // Calculate estimated savings (simplified)
            const estimatedSavings = appState.taxHistory.reduce((sum, record) => {
                return sum + (record.allowances || 0) * 0.2; // Simplified savings calculation
            }, 0);
            document.getElementById('estimated-savings').textContent = formatCurrency(estimatedSavings);
            
            // Update deadlines list
            const deadlineList = document.getElementById('deadline-list');
            deadlineList.innerHTML = '';
            
            nigerianDeadlines.forEach(deadline => {
                const deadlineItem = document.createElement('li');
                deadlineItem.className = 'deadline-item';
                
                const statusClass = `status-${deadline.status}`;
                
                deadlineItem.innerHTML = `
                    <div class="deadline-icon">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <div class="deadline-info">
                        <div class="deadline-title">${deadline.title}</div>
                        <div class="deadline-date">Due: ${formatDate(deadline.date)}</div>
                    </div>
                    <div class="deadline-status ${statusClass}">${deadline.status}</div>
                `;
                
                deadlineList.appendChild(deadlineItem);
            });
            
            // Update activity list
            const activityList = document.getElementById('activity-list');
            activityList.innerHTML = '';
            
            // Show recent tax calculations
            const recentCalculations = appState.taxHistory.slice(-3).reverse();
            
            if (recentCalculations.length === 0) {
                activityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">No calculations yet</div>
                            <div class="activity-time">Use the tax calculator to get started</div>
                        </div>
                    </li>
                `;
            } else {
                recentCalculations.forEach(calc => {
                    const activityItem = document.createElement('li');
                    activityItem.className = 'activity-item';
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">${calc.userType === 'individual' ? 'Personal' : 'Business'} Tax Calculated</div>
                            <div class="activity-time">${formatDate(calc.date)} - ${formatCurrency(calc.taxAmount)}</div>
                        </div>
                    `;
                    
                    activityList.appendChild(activityItem);
                });
            }
        }

        // Load and display tax history
        function loadTaxHistory() {
            const historyTableBody = document.getElementById('history-table-body');
            
            if (appState.taxHistory.length === 0) {
                historyTableBody.innerHTML = `
                    <div class="table-row">
                        <div colspan="5" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-history" style="font-size: 2rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                            <p>No tax history yet. Start by using the tax calculator!</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Filter history based on selected filters
            const typeFilter = document.getElementById('history-type-filter').value;
            const statusFilter = document.getElementById('history-status-filter').value;
            const dateFilter = document.getElementById('history-date-filter').value;
            
            const filteredHistory = appState.taxHistory.filter(record => {
                const typeMatch = typeFilter === 'all' || record.userType === typeFilter;
                const statusMatch = statusFilter === 'all' || record.status === statusFilter;
                
                // Date filtering (simplified)
                const recordDate = new Date(record.date);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - parseInt(dateFilter));
                
                const dateMatch = recordDate >= cutoffDate;
                
                return typeMatch && statusMatch && dateMatch;
            });
            
            // Display filtered history
            historyTableBody.innerHTML = '';
            
            filteredHistory.forEach(record => {
                const tableRow = document.createElement('div');
                tableRow.className = 'table-row';
                
                const statusClass = `status-${record.status}`;
                
                tableRow.innerHTML = `
                    <div>${formatDate(record.date)}</div>
                    <div>${record.userType === 'individual' ? 'Personal Income Tax' : 'Company Income Tax'}</div>
                    <div>${formatCurrency(record.taxAmount)}</div>
                    <div><span class="status-badge ${statusClass}">${record.status}</span></div>
                    <div>
                        <button class="btn btn-outline" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="viewCalculation('${record.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                `;
                
                historyTableBody.appendChild(tableRow);
            });
        }

        // Save tax calculation to Firestore
        function saveTaxCalculation(calculation) {
            if (!appState.currentUser) return;
            
            const calculationRecord = {
                userId: appState.currentUser.uid,
                userType: userData.userType,
                incomeAmount: userData.incomeAmount,
                allowances: userData.allowances,
                taxAmount: calculation.tax,
                taxableIncome: calculation.taxableIncome,
                taxRate: calculation.taxRate,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('taxCalculations').add(calculationRecord)
                .then(() => {
                    // Add to local state for immediate UI update
                    const localRecord = {
                        id: Date.now().toString(),
                        date: new Date().toISOString(),
                        ...calculationRecord
                    };
                    appState.taxHistory.unshift(localRecord);
                    
                    // Update dashboard
                    updateDashboard();
                    
                    // Show success message
                    showToast('Tax calculation saved to history', 'success');
                })
                .catch(error => {
                    console.error('Error saving calculation:', error);
                    showToast('Error saving calculation', 'error');
                });
        }

        // View a specific calculation
        function viewCalculation(calculationId) {
            const calculation = appState.taxHistory.find(record => record.id === calculationId);
            
            if (!calculation) return;
            
            openModal('Tax Calculation Details', `
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--primary); margin-bottom: 1rem;">Calculation Details</h4>
                    <div class="breakdown-item">
                        <span>Date:</span>
                        <span>${formatDate(calculation.date)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Type:</span>
                        <span>${calculation.userType === 'individual' ? 'Personal Income Tax' : 'Company Income Tax'}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Income:</span>
                        <span>${formatCurrency(calculation.incomeAmount)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Allowances:</span>
                        <span>${formatCurrency(calculation.allowances)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Taxable Income:</span>
                        <span>${formatCurrency(calculation.taxableIncome)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Tax Rate:</span>
                        <span>${(calculation.taxRate * 100).toFixed(1)}%</span>
                    </div>
                    <div class="breakdown-item">
                        <span><strong>Tax Amount:</strong></span>
                        <span><strong>${formatCurrency(calculation.taxAmount)}</strong></span>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn" onclick="reuseCalculation('${calculation.id}')">
                        <i class="fas fa-redo"></i> Reuse This Calculation
                    </button>
                    <button class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            `);
        }

        // Reuse a previous calculation
        function reuseCalculation(calculationId) {
            const calculation = appState.taxHistory.find(record => record.id === calculationId);
            
            if (!calculation) return;
            
            // Set user data from the calculation
            userData.userType = calculation.userType;
            userData.incomeAmount = calculation.incomeAmount;
            userData.allowances = calculation.allowances;
            
            // Navigate to calculator tab
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-tab="calculator"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('calculator').classList.add('active');
            
            // Reset calculator UI
            calculatorContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            
            // Pre-populate the calculator based on the calculation
            // This would need more complex logic to navigate through the steps
            // For now, we'll just show a message
            closeModal();
            showToast('Calculation loaded. Please use the calculator to modify values.', 'success');
        }

        // Format currency for Nigerian Naira
        function formatCurrency(amount) {
            if (isNaN(amount)) return '₦0';
            return '₦' + amount.toLocaleString('en-NG');
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-NG', options);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            
            // Set toast type
            toast.className = 'toast';
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'success') {
                toast.classList.add('success');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Tab navigation
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all nav items
                    navItems.forEach(nav => nav.classList.remove('active'));
                    
                    // Add active class to clicked nav item
                    this.classList.add('active');
                    
                    // Get the tab to show
                    const tabId = this.getAttribute('data-tab');
                    
                    // Hide all tab contents
                    tabContents.forEach(tab => tab.classList.remove('active'));
                    
                    // Show the selected tab content
                    document.getElementById(tabId).classList.add('active');
                    
                    // Update specific tab content if needed
                    if (tabId === 'history') {
                        loadTaxHistory();
                    } else if (tabId === 'dashboard') {
                        updateDashboard();
                    } else if (tabId === 'resources') {
                        loadCustomResources();
                    } else if (tabId === 'community') {
                        loadCommunityFeed();
                    }
                    
                    // Close mobile menu if open
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('active');
                    }
                });
            });

            // Mobile menu toggle
            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 && 
                    !sidebar.contains(e.target) && 
                    !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });

            // Notification dropdown
            notificationIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationDropdown.classList.toggle('show');
            });

            // Close notification dropdown when clicking outside
            document.addEventListener('click', function() {
                notificationDropdown.classList.remove('show');
            });

            // Modal functionality
            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });

            // History filters
            document.getElementById('history-type-filter').addEventListener('change', loadTaxHistory);
            document.getElementById('history-status-filter').addEventListener('change', loadTaxHistory);
            document.getElementById('history-date-filter').addEventListener('change', loadTaxHistory);

            // Settings event listeners
            document.getElementById('save-profile-btn').addEventListener('click', saveProfile);
            document.getElementById('update-password-btn').addEventListener('click', updatePassword);

            // User dropdown navigation
            document.querySelectorAll('.user-dropdown .dropdown-item[data-tab]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    // Navigate to the tab
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    // Close dropdown
                    userDropdown.classList.remove('show');
                });
            });

            // Calculator event listeners
            setupCalculatorEventListeners();
        }

        // Save profile to Firestore
        function saveProfile() {
            if (!appState.currentUser) return;
            
            const profileData = {
                firstName: document.getElementById('first-name').value,
                lastName: document.getElementById('last-name').value,
                phone: document.getElementById('phone').value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('users').doc(appState.currentUser.uid).update(profileData)
                .then(() => {
                    // Update local state
                    appState.userProfile = { ...appState.userProfile, ...profileData };
                    
                    // Update UI
                    updateUserUI();
                    
                    showToast('Profile updated successfully', 'success');
                })
                .catch(error => {
                    console.error('Error updating profile:', error);
                    showToast('Error updating profile', 'error');
                });
        }

        // Update password
        function updatePassword() {
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            appState.currentUser.updatePassword(newPassword)
                .then(() => {
                    // Clear password fields
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                    document.getElementById('confirm-password').value = '';
                    
                    showToast('Password updated successfully', 'success');
                })
                .catch(error => {
                    console.error('Error updating password:', error);
                    showToast('Error updating password', 'error');
                });
        }

        // Setup calculator-specific event listeners
        function setupCalculatorEventListeners() {
            // Step 1: User Type Selection
            document.querySelectorAll('#step-1 .option-card').forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selection from all cards
                    document.querySelectorAll('#step-1 .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select this card
                    this.classList.add('selected');
                    userData.userType = this.getAttribute('data-value');
                    
                    // Enable next button
                    document.getElementById('step-1-next').disabled = false;
                });
            });

            // Step 1 Next Button
            document.getElementById('step-1-next').addEventListener('click', function() {
                // Populate step 2 options based on user type
                const incomeTypeOptions = document.getElementById('income-type-options');
                incomeTypeOptions.innerHTML = '';
                
                if (userData.userType === 'individual') {
                    const individualOptions = [
                        { value: 'salary', icon: 'fa-money-bill', title: 'Salary Earner', description: 'I work for a company and receive a salary' },
                        { value: 'business', icon: 'fa-store', title: 'Business Owner', description: 'I run my own business' },
                        { value: 'rental', icon: 'fa-home', title: 'Rental Income', description: 'I earn from renting out property' },
                        { value: 'investment', icon: 'fa-chart-line', title: 'Investment Income', description: 'I earn from investments' }
                    ];
                    
                    individualOptions.forEach(option => {
                        const card = document.createElement('div');
                        card.className = 'option-card';
                        card.setAttribute('data-value', option.value);
                        card.innerHTML = `
                            <div class="option-icon">
                                <i class="fas ${option.icon}"></i>
                            </div>
                            <div class="option-title">${option.title}</div>
                            <div class="option-description">${option.description}</div>
                        `;
                        incomeTypeOptions.appendChild(card);
                    });
                } else {
                    const businessOptions = [
                        { value: 'small', icon: 'fa-store', title: 'Small Business', description: 'Turnover less than ₦25 million' },
                        { value: 'medium', icon: 'fa-building', title: 'Medium Business', description: 'Turnover ₦25M - ₦100M' },
                        { value: 'large', icon: 'fa-industry', title: 'Large Business', description: 'Turnover more than ₦100M' }
                    ];
                    
                    businessOptions.forEach(option => {
                        const card = document.createElement('div');
                        card.className = 'option-card';
                        card.setAttribute('data-value', option.value);
                        card.innerHTML = `
                            <div class="option-icon">
                                <i class="fas ${option.icon}"></i>
                            </div>
                            <div class="option-title">${option.title}</div>
                            <div class="option-description">${option.description}</div>
                        `;
                        incomeTypeOptions.appendChild(card);
                    });
                }
                
                // Add event listeners to new option cards
                document.querySelectorAll('#income-type-options .option-card').forEach(card => {
                    card.addEventListener('click', function() {
                        // Remove selection from all cards
                        document.querySelectorAll('#income-type-options .option-card').forEach(c => {
                            c.classList.remove('selected');
                        });
                        
                        // Select this card
                        this.classList.add('selected');
                        userData.incomeType = this.getAttribute('data-value');
                        
                        // Enable next button
                        document.getElementById('step-2-next').disabled = false;
                    });
                });
                
                goToStep(2);
            });

            // Step 2 Next Button
            document.getElementById('step-2-next').addEventListener('click', function() {
                // Update step 3 based on user type and income type
                const step3Title = document.getElementById('step-3-title');
                const step3Description = document.getElementById('step-3-description');
                const incomeLabel = document.getElementById('income-label');
                const incomeHint = document.getElementById('income-hint');
                
                if (userData.userType === 'individual') {
                    step3Title.textContent = "What Is Your Annual Income?";
                    step3Description.textContent = "Enter your total income for the year";
                    incomeLabel.textContent = "Annual Income (₦)";
                    incomeHint.textContent = "This helps us calculate your tax accurately";
                    
                    // Create amount options for individual income
                    createAmountOptions(
                        'income-amount-options', 
                        nigerianTaxData.individual.income, 
                        userData.incomeAmount,
                        (amount) => {
                            userData.incomeAmount = amount;
                            document.getElementById('income-amount').value = amount;
                            updateAmountInWords(amount, 'income-amount-words');
                            document.getElementById('step-3-next').disabled = false;
                        }
                    );
                } else {
                    step3Title.textContent = "What Is Your Annual Turnover?";
                    step3Description.textContent = "Enter your business's total turnover for the year";
                    incomeLabel.textContent = "Annual Turnover (₦)";
                    incomeHint.textContent = "Your turnover is the total amount of money your business makes";
                    
                    // Create amount options for business income
                    createAmountOptions(
                        'income-amount-options', 
                        nigerianTaxData.business.income, 
                        userData.incomeAmount,
                        (amount) => {
                            userData.incomeAmount = amount;
                            document.getElementById('income-amount').value = amount;
                            updateAmountInWords(amount, 'income-amount-words');
                            document.getElementById('step-3-next').disabled = false;
                        }
                    );
                }
                
                goToStep(3);
            });

            // Step 2 Back Button
            document.getElementById('step-2-back').addEventListener('click', function() {
                goToStep(1);
            });

            // Step 3: Income Amount Input
            document.getElementById('income-amount').addEventListener('input', function() {
                const value = parseFloat(this.value) || 0;
                userData.incomeAmount = value;
                
                // Update amount in words
                updateAmountInWords(value, 'income-amount-words');
                
                // Update selected amount option
                document.querySelectorAll('#income-amount-options .amount-option').forEach(option => {
                    const optionAmount = parseInt(option.textContent.replace('₦', '').replace(/,/g, ''));
                    if (optionAmount === value) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
                
                // Enable next button if value is valid
                document.getElementById('step-3-next').disabled = value <= 0;
            });

            // Step 3 Next Button
            document.getElementById('step-3-next').addEventListener('click', function() {
                // Update step 4 based on user type
                const step4Title = document.getElementById('step-4-title');
                const step4Description = document.getElementById('step-4-description');
                const allowancesLabel = document.getElementById('allowances-label');
                const allowancesHint = document.getElementById('allowances-hint');
                
                if (userData.userType === 'individual') {
                    step4Title.textContent = "Any Allowances or Deductions?";
                    step4Description.textContent = "These can reduce the amount of tax you pay";
                    allowancesLabel.textContent = "Annual Allowances & Deductions (₦)";
                    allowancesHint.textContent = "Examples: Pension contributions, NHF, dependents";
                    
                    // Create amount options for individual allowances
                    createAmountOptions(
                        'allowances-amount-options', 
                        nigerianTaxData.individual.allowances, 
                        userData.allowances,
                        (amount) => {
                            userData.allowances = amount;
                            document.getElementById('allowances').value = amount;
                            updateAmountInWords(amount, 'allowances-amount-words');
                        }
                    );
                } else {
                    step4Title.textContent = "Any Business Expenses or Deductions?";
                    step4Description.textContent = "These can reduce the amount of tax your business pays";
                    allowancesLabel.textContent = "Annual Business Expenses (₦)";
                    allowancesHint.textContent = "Examples: Employee salaries, rent, equipment costs";
                    
                    // Create amount options for business allowances
                    createAmountOptions(
                        'allowances-amount-options', 
                        nigerianTaxData.business.allowances, 
                        userData.allowances,
                        (amount) => {
                            userData.allowances = amount;
                            document.getElementById('allowances').value = amount;
                            updateAmountInWords(amount, 'allowances-amount-words');
                        }
                    );
                }
                
                goToStep(4);
            });

            // Step 3 Back Button
            document.getElementById('step-3-back').addEventListener('click', function() {
                goToStep(2);
            });

            // Step 4: Allowances Input
            document.getElementById('allowances').addEventListener('input', function() {
                const value = parseFloat(this.value) || 0;
                userData.allowances = value;
                
                // Update amount in words
                updateAmountInWords(value, 'allowances-amount-words');
                
                // Update selected amount option
                document.querySelectorAll('#allowances-amount-options .amount-option').forEach(option => {
                    const optionAmount = parseInt(option.textContent.replace('₦', '').replace(/,/g, ''));
                    if (optionAmount === value) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
            });

            // Step 4 Next Button
            document.getElementById('step-4-next').addEventListener('click', function() {
                goToStep(5);
                
                // Simulate processing delay
                setTimeout(function() {
                    const calculation = calculateTax();
                    displayResults(calculation);
                    saveTaxCalculation(calculation);
                    
                    calculatorContainer.style.display = 'none';
                    resultsContainer.style.display = 'block';
                }, 2000);
            });

            // Step 4 Back Button
            document.getElementById('step-4-back').addEventListener('click', function() {
                goToStep(3);
            });

            // Step 5 Back Button
            document.getElementById('step-5-back').addEventListener('click', function() {
                goToStep(4);
            });

            // Restart Button
            document.getElementById('restart-btn').addEventListener('click', function() {
                // Reset user data
                userData.userType = null;
                userData.incomeType = null;
                userData.incomeAmount = null;
                userData.allowances = 0;
                
                // Reset UI
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.getElementById('income-amount').value = '';
                document.getElementById('allowances').value = '';
                document.getElementById('step-1-next').disabled = true;
                document.getElementById('step-2-next').disabled = true;
                document.getElementById('step-3-next').disabled = true;
                
                // Reset amount in words
                updateAmountInWords(0, 'income-amount-words');
                updateAmountInWords(0, 'allowances-amount-words');
                
                // Show calculator, hide results
                calculatorContainer.style.display = 'block';
                resultsContainer.style.display = 'none';
                
                // Go back to step 1
                goToStep(1);
            });

            // Save Result Button
            document.getElementById('save-result').addEventListener('click', function() {
                showToast('Calculation saved to your history', 'success');
            });

            // Payment Button
            document.getElementById('payment-btn').addEventListener('click', function() {
                openPaymentModal();
            });
        }

        // Open payment modal
        function openPaymentModal() {
            openModal('Tax Payment Methods', `
                <p>Choose your preferred payment method:</p>
                <div class="payment-methods">
                    <div class="payment-method" data-method="ussd">
                        <div class="payment-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="payment-name">USSD Payment</div>
                        <div class="payment-description">Dial *565*6# to pay</div>
                    </div>
                    <div class="payment-method" data-method="online">
                        <div class="payment-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <div class="payment-name">Online Banking</div>
                        <div class="payment-description">Pay via your bank's website</div>
                    </div>
                    <div class="payment-method" data-method="bank">
                        <div class="payment-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <div class="payment-name">Bank Branch</div>
                        <div class="payment-description">Visit any bank branch</div>
                    </div>
                    <div class="payment-method" data-method="card">
                        <div class="payment-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="payment-name">Debit/Credit Card</div>
                        <div class="payment-description">Pay with your card securely</div>
                    </div>
                </div>
                <div class="tax-tip">
                    <h4><i class="fas fa-info-circle"></i> Payment Information</h4>
                    <p>Ensure you have your Tax Identification Number (TIN) ready before making payment. Payments may take 24-48 hours to reflect in FIRS records.</p>
                </div>
                <div class="actions">
                    <button class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn" id="proceed-payment" disabled>
                        <i class="fas fa-credit-card"></i> Proceed to Payment
                    </button>
                </div>
            `);
            
            // Add event listeners to payment methods
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    // Remove selection from all methods
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.classList.remove('selected');
                    });
                    
                    // Select this method
                    this.classList.add('selected');
                    
                    // Enable proceed button
                    document.getElementById('proceed-payment').disabled = false;
                });
            });
            
            // Proceed to payment
            document.getElementById('proceed-payment').addEventListener('click', function() {
                const selectedMethod = document.querySelector('.payment-method.selected');
                if (selectedMethod) {
                    const method = selectedMethod.getAttribute('data-method');
                    processPayment(method);
                }
            });
        }

        // Process payment
        function processPayment(method) {
            closeModal();
            
            // Simulate payment processing
            showToast('Processing payment...', 'success');
            
            setTimeout(() => {
                showToast('Payment completed successfully!', 'success');
                
                // Update tax history status
                if (appState.taxHistory.length > 0) {
                    appState.taxHistory[0].status = 'paid';
                    loadTaxHistory();
                }
            }, 2000);
        }

        // Calculator helper functions
        function goToStep(stepNumber) {
            // Hide all steps
            steps.forEach(step => step.classList.remove('active'));
            stepIndicators.forEach(indicator => indicator.classList.remove('active'));
            
            // Show current step
            document.getElementById(`step-${stepNumber}`).classList.add('active');
            stepIndicators[stepNumber - 1].classList.add('active');
            
            // Update progress bar
            const progressPercentage = ((stepNumber - 1) / (steps.length - 1)) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        // Enhanced Number to words conversion function
        function numberToWords(num) {
            if (num === 0) return "Zero Naira";
            
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const scales = ['', 'Thousand', 'Million', 'Billion', 'Trillion'];
            
            // Handle negative numbers
            if (num < 0) {
                return 'Negative ' + numberToWords(Math.abs(num));
            }
            
            let words = '';
            
            // Convert number to string and split into integer and decimal parts
            const numStr = num.toFixed(2);
            const parts = numStr.split('.');
            const integerPart = parseInt(parts[0]);
            const decimalPart = parts[1] ? parseInt(parts[1]) : 0;
            
            // Convert integer part
            if (integerPart === 0) {
                words = 'Zero';
            } else {
                let count = 0;
                let n = integerPart;
                
                while (n > 0) {
                    if (n % 1000 !== 0) {
                        let chunk = '';
                        const x = n % 1000;
                        
                        if (x < 20) {
                            chunk = ones[x];
                        } else if (x < 100) {
                            chunk = tens[Math.floor(x / 10)] + (x % 10 !== 0 ? '-' + ones[x % 10] : '');
                        } else {
                            chunk = ones[Math.floor(x / 100)] + ' Hundred ' + (x % 100 !== 0 ? 'and ' + numberToWords(x % 100) : '');
                        }
                        
                        words = chunk + (scales[count] ? ' ' + scales[count] + ' ' : '') + words;
                    }
                    n = Math.floor(n / 1000);
                    count++;
                }
                
                // Clean up extra spaces
                words = words.replace(/\s+/g, ' ').trim();
            }
            
            // Add "Naira"
            let result = words + ' Naira';
            
            // Add kobo if there's a decimal part
            if (decimalPart > 0) {
                let koboWords = '';
                if (decimalPart < 20) {
                    koboWords = ones[decimalPart];
                } else {
                    koboWords = tens[Math.floor(decimalPart / 10)] + (decimalPart % 10 !== 0 ? '-' + ones[decimalPart % 10] : '');
                }
                result += ' and ' + koboWords + ' Kobo';
            }
            
            return result;
        }

        // Function to create amount options
        function createAmountOptions(containerId, options, currentValue, onSelect) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            options.forEach(amount => {
                const option = document.createElement('div');
                option.className = 'amount-option';
                if (currentValue === amount) {
                    option.classList.add('selected');
                }
                option.textContent = formatCurrency(amount);
                option.addEventListener('click', () => {
                    onSelect(amount);
                    
                    // Update selected state
                    document.querySelectorAll(`#${containerId} .amount-option`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    option.classList.add('selected');
                });
                container.appendChild(option);
            });
        }

        // Function to update amount in words display
        function updateAmountInWords(amount, wordsContainerId) {
            const wordsContainer = document.getElementById(wordsContainerId);
            if (amount && amount > 0) {
                wordsContainer.textContent = numberToWords(amount);
            } else {
                wordsContainer.textContent = 'Amount in words will appear here';
            }
        }

        // Enhanced Tax Calculation Function
        function calculateTax() {
            let taxableIncome = userData.incomeAmount - userData.allowances;
            let tax = 0;
            let taxRate = 0;
            let tip = '';
            let additionalTaxes = [];
            
            if (userData.userType === 'individual') {
                // Apply Consolidated Relief Allowance (CRA)
                const cra = nigerianTaxData.individual.consolidatedReliefAllowance(userData.incomeAmount);
                taxableIncome = Math.max(0, userData.incomeAmount - userData.allowances - cra);
                
                // Calculate tax using Nigerian PIT brackets
                let remainingIncome = taxableIncome;
                
                for (const bracket of nigerianTaxData.individual.taxBrackets) {
                    if (remainingIncome <= 0) break;
                    
                    const bracketAmount = Math.min(
                        remainingIncome,
                        bracket.max === Infinity ? remainingIncome : bracket.max - bracket.min + 1
                    );
                    
                    tax += bracketAmount * bracket.rate;
                    remainingIncome -= bracketAmount;
                }
                
                // Add state development levy
                additionalTaxes.push({
                    name: "State Development Levy",
                    amount: nigerianTaxData.states.developmentLevy
                });
                tax += nigerianTaxData.states.developmentLevy;
                
                // Calculate effective tax rate
                taxRate = userData.incomeAmount > 0 ? tax / userData.incomeAmount : 0;
                
                // Generate tip based on income type
                switch(userData.incomeType) {
                    case 'salary':
                        tip = "Consider maximizing your pension contributions (up to 25% of annual income) and National Housing Fund contributions to reduce your taxable income. Also ensure you're claiming all eligible allowances including transport, housing, and utility allowances.";
                        break;
                    case 'business':
                        tip = "Ensure you're claiming all legitimate business expenses and consider timing major equipment purchases to maximize deductions. Explore available tax incentives for small businesses including the lower tax rate for companies with turnover below ₦25 million.";
                        break;
                    case 'rental':
                        tip = "Maximize deductions for property maintenance, insurance, management fees, and repairs. Consider restructuring property ownership for optimal tax efficiency and explore opportunities for capital allowances on qualifying improvements.";
                        break;
                    case 'investment':
                        tip = "Review your investment portfolio for tax-efficient instruments including government securities and explore timing of capital gains realization to optimize your tax position. Consider tax-exempt investment options where available.";
                        break;
                }
            } else {
                // Corporate tax calculation
                let companyType = 'large';
                
                if (userData.incomeAmount < nigerianTaxData.business.turnoverThresholds.small) {
                    companyType = 'small';
                } else if (userData.incomeAmount <= nigerianTaxData.business.turnoverThresholds.medium) {
                    companyType = 'medium';
                }
                
                taxRate = nigerianTaxData.business.taxRates[companyType];
                tax = taxableIncome * taxRate;
                
                // Add business premises levy based on location
                const premisesLevy = nigerianTaxData.states.businessPremises[userData.businessLocation || 'urban'];
                additionalTaxes.push({
                    name: "Business Premises Levy",
                    amount: premisesLevy
                });
                tax += premisesLevy;
                
                // Add education tax (2% of assessable profit)
                const educationTax = taxableIncome * 0.02;
                additionalTaxes.push({
                    name: "Education Tax",
                    amount: educationTax
                });
                tax += educationTax;
                
                // Generate tip based on company size
                switch(companyType) {
                    case 'small':
                        tip = "Small businesses with turnover below ₦25 million enjoy reduced tax rates and simplified compliance requirements. Consider timing equipment purchases to maximize deductions and explore available tax credits for job creation and training programs.";
                        break;
                    case 'medium':
                        tip = "Medium-sized businesses can benefit from various incentives including investment allowances and industry-specific tax credits. Explore available export incentives and consider structuring investments to qualify for pioneer status where applicable.";
                        break;
                    case 'large':
                        tip = "Large companies should explore sector-specific incentives, transfer pricing optimization, and strategic timing of major expenses to optimize tax liability. Consider available tax treaties for cross-border transactions and explore opportunities for research and development credits.";
                        break;
                }
            }
            
            return {
                tax: Math.round(tax),
                taxableIncome: Math.round(taxableIncome),
                taxRate: taxRate,
                tip: tip,
                additionalTaxes: additionalTaxes
            };
        }

        // Enhanced Display calculation results
        function displayResults(calculation) {
            document.getElementById('calculated-tax').textContent = formatCurrency(calculation.tax);
            document.getElementById('taxable-income').textContent = formatCurrency(calculation.taxableIncome);
            document.getElementById('tax-rate').textContent = `${(calculation.taxRate * 100).toFixed(1)}%`;
            document.getElementById('total-allowances').textContent = formatCurrency(userData.allowances);
            document.getElementById('net-tax').textContent = formatCurrency(calculation.tax);
            document.getElementById('optimization-tip').textContent = calculation.tip;
            
            // Display additional taxes if any
            if (calculation.additionalTaxes && calculation.additionalTaxes.length > 0) {
                const breakdown = document.querySelector('.tax-breakdown');
                calculation.additionalTaxes.forEach(additionalTax => {
                    const taxItem = document.createElement('div');
                    taxItem.className = 'breakdown-item';
                    taxItem.innerHTML = `
                        <span>${additionalTax.name}:</span>
                        <span>${formatCurrency(additionalTax.amount)}</span>
                    `;
                    breakdown.appendChild(taxItem);
                });
            }
        }

        // Modal functions
        function openModal(title, content) {
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        // Open external link
        function openExternalLink(url) {
            window.open(url, '_blank');
        }

        // Download resource (placeholder function)
        function downloadResource(title) {
            showToast(`Downloading ${title}...`, 'success');
            // In a real app, this would trigger an actual download
        }

        // Watch video (placeholder function)
        function watchVideo(title) {
            showToast(`Playing ${title}...`, 'success');
            // In a real app, this would open a video player
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
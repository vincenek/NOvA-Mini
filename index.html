<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web-Based Micro-Investment Simulator (WebMIS)</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #fff;
        }
        #controls {
            margin: 20px;
            text-align: center;
        }
        input, select, button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #333;
            color: #fff;
        }
        button:hover {
            background-color: #555;
        }
        canvas {
            border: 2px solid #0f0;
            background-color: #222;
        }
        #portfolio {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="controls">
        <select id="asset">
            <option value="Tech">Tech ($10.00)</option>
            <option value="Energy">Energy ($5.00)</option>
            <option value="Health">Health ($7.50)</option>
        </select>
        <input type="number" id="amount" placeholder="Amount ($0.01-$10)" step="0.01" min="0.01" max="10">
        <button onclick="buyAsset()">Buy</button>
        <button onclick="sellAsset()">Sell</button>
        <button onclick="simulateMarket()">Simulate Day</button>
        <button onclick="resetPortfolio()">Reset</button>
    </div>
    <canvas id="chartCanvas" width="600" height="300"></canvas>
    <div id="portfolio"></div>

    <script>
        const canvas = document.getElementById('chartCanvas');
        const ctx = canvas.getContext('2d');
        let portfolio = JSON.parse(localStorage.getItem('portfolio')) || {
            cash: 100,
            assets: { Tech: 0, Energy: 0, Health: 0 },
            history: [100]
        };
        let prices = { Tech: 10, Energy: 5, Health: 7.5 };
        const maxHistory = 20;

        function buyAsset() {
            const asset = document.getElementById('asset').value;
            const amount = parseFloat(document.getElementById('amount').value);
            if (isNaN(amount) || amount < 0.01 || amount > 10 || amount * prices[asset] > portfolio.cash) {
                alert('Invalid amount or insufficient cash');
                return;
            }
            portfolio.cash -= amount * prices[asset];
            portfolio.assets[asset] += amount;
            saveAndUpdate();
        }

        function sellAsset() {
            const asset = document.getElementById('asset').value;
            const amount = parseFloat(document.getElementById('amount').value);
            if (isNaN(amount) || amount < 0.01 || amount > portfolio.assets[asset]) {
                alert('Invalid amount or insufficient assets');
                return;
            }
            portfolio.cash += amount * prices[asset];
            portfolio.assets[asset] -= amount;
            saveAndUpdate();
        }

        function simulateMarket() {
            for (let asset in prices) {
                prices[asset] *= (1 + (Math.random() - 0.5) * 0.1); // Â±5% daily change
                prices[asset] = Math.max(0.1, prices[asset]).toFixed(2);
            }
            const totalValue = portfolio.cash + Object.keys(portfolio.assets).reduce(
                (sum, asset) => sum + portfolio.assets[asset] * prices[asset], 0
            );
            portfolio.history.push(totalValue);
            if (portfolio.history.length > maxHistory) portfolio.history.shift();
            saveAndUpdate();
        }

        function resetPortfolio() {
            portfolio = { cash: 100, assets: { Tech: 0, Energy: 0, Health: 0 }, history: [100] };
            prices = { Tech: 10, Energy: 5, Health: 7.5 };
            saveAndUpdate();
        }

        function saveAndUpdate() {
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
            updateChartAndPortfolio();
        }

        function updateChartAndPortfolio() {
            // Update portfolio summary
            const totalValue = portfolio.cash + Object.keys(portfolio.assets).reduce(
                (sum, asset) => sum + portfolio.assets[asset] * prices[asset], 0
            );
            document.getElementById('portfolio').innerHTML = `
                Cash: $${portfolio.cash.toFixed(2)}<br>
                Assets: ${Object.entries(portfolio.assets).map(([k, v]) => `${k}: ${v.toFixed(2)} ($${v * prices[k]})`).join('<br>')}<br>
                Total Value: $${totalValue.toFixed(2)}
            `;

            // Draw line chart
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.strokeStyle = '#0f0';
            ctx.lineWidth = 2;
            const maxValue = Math.max(...portfolio.history, 100) * 1.1;
            const minValue = Math.min(...portfolio.history, 100) * 0.9;
            portfolio.history.forEach((value, i) => {
                const x = (i / (maxHistory - 1)) * canvas.width;
                const y = canvas.height - ((value - minValue) / (maxValue - minValue)) * canvas.height;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        // Initial load
        updateChartAndPortfolio();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArbScan - Mobile Crypto Arbitrage Scanner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --secondary: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --card-bg: rgba(30, 41, 59, 0.8);
            --card-border: rgba(148, 163, 184, 0.2);
        }
        
        body {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: var(--light);
            min-height: 100vh;
            padding: 15px;
            line-height: 1.6;
            font-size: 14px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.2rem;
            color: var(--primary);
            background: rgba(37, 99, 235, 0.15);
            padding: 12px;
            border-radius: 50%;
        }
        
        h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 0.95rem;
            margin: 0 auto;
            max-width: 95%;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px 15px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--card-border);
        }
        
        .card-title {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: var(--primary);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 6px;
            font-weight: 500;
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        select, input {
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            background: rgba(15, 23, 42, 0.6);
            color: var(--light);
            font-size: 0.95rem;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            padding: 10px 15px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(37, 99, 235, 0.1);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        th {
            background: rgba(15, 23, 42, 0.7);
            padding: 12px 10px;
            text-align: left;
            color: #94a3b8;
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--card-border);
            font-size: 0.9rem;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background: rgba(15, 23, 42, 0.4);
        }
        
        .profit {
            color: var(--success);
            font-weight: 700;
        }
        
        .loss {
            color: var(--danger);
            font-weight: 700;
        }
        
        .exchange-logo {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            object-fit: cover;
        }
        
        .opportunity-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .opportunity-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .opportunity-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .opportunity-item {
            display: flex;
            flex-direction: column;
        }
        
        .opportunity-label {
            color: #94a3b8;
            font-size: 0.8rem;
            margin-bottom: 3px;
        }
        
        .opportunity-value {
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .chart-container {
            height: 250px;
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            bottom: 15px;
            right: 15px;
            left: 15px;
            background: var(--success);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            transform: translateY(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .privacy-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            background: rgba(15, 23, 42, 0.6);
            padding: 8px 12px;
            border-radius: 50px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 22px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 22px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--success);
        }
        
        input:checked + .slider:before {
            transform: translateX(23px);
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            color: var(--gray);
            font-size: 0.8rem;
        }
        
        .features {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature {
            background: rgba(15, 23, 42, 0.4);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .feature i {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
            background: rgba(37, 99, 235, 0.15);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .feature h3 {
            margin-bottom: 8px;
            color: #e2e8f0;
            font-size: 1rem;
        }
        
        .feature p {
            color: #94a3b8;
            font-size: 0.85rem;
        }
        
        .disclaimer {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.8rem;
        }
        
        .disclaimer h3 {
            color: var(--danger);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            margin-top: 10px;
            color: #94a3b8;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--success);
        }
        
        .status-dot.offline {
            background-color: var(--danger);
        }
        
        /* Tablet and larger */
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 16px;
            }
            
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
            
            .btn-group {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .btn {
                width: auto;
                flex: 1;
            }
            
            .features {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .notification {
                left: auto;
                max-width: 350px;
            }
        }
        
        /* Desktop */
        @media (min-width: 1024px) {
            .container {
                max-width: 1400px;
                margin: 0 auto 30px;
            }
            
            .features {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-chart-line"></i>
            <div>
                <h1>ArbScan</h1>
                <p class="subtitle">Mobile Crypto Arbitrage Scanner - Live market data & real-time analysis</p>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-search-dollar"></i> Arbitrage Scanner</h2>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="crypto-pair">Crypto Pair</label>
                    <select id="crypto-pair">
                        <option value="BTC/USDT">BTC/USDT</option>
                        <option value="ETH/USDT" selected>ETH/USDT</option>
                        <option value="SOL/USD">SOL/USD</option>
                        <option value="BNB/USDT">BNB/USDT</option>
                        <option value="ADA/USD">ADA/USD</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="fee-percentage">Trading Fee (%)</label>
                    <input type="number" id="fee-percentage" value="0.1" step="0.01" min="0">
                </div>
                
                <div class="control-group">
                    <label for="min-profit">Min Profit (%)</label>
                    <input type="number" id="min-profit" value="0.5" step="0.1" min="0">
                </div>
            </div>
            
            <div class="privacy-toggle">
                <span>Privacy Mode (Use mock data)</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="privacy-mode">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="btn-group">
                <button id="scan-btn" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i> Scan Arbitrage
                </button>
                
                <button id="export-csv" class="btn btn-outline">
                    <i class="fas fa-file-csv"></i> CSV
                </button>
                
                <button id="export-json" class="btn btn-outline">
                    <i class="fas fa-file-code"></i> JSON
                </button>
            </div>
            
            <div class="status-indicator">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">Connected to live market data</span>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Exchange</th>
                        <th>Price</th>
                        <th>Spread</th>
                        <th>Profit</th>
                    </tr>
                </thead>
                <tbody id="exchange-data">
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px;">
                            <i class="fas fa-search"></i> Click "Scan Arbitrage" to find opportunities
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div class="opportunity-card">
                <div class="opportunity-header">
                    <h3>Best Opportunity</h3>
                    <span class="opportunity-badge badge-success">LIVE</span>
                </div>
                <div class="opportunity-content">
                    <div class="opportunity-item">
                        <span class="opportunity-label">Buy From</span>
                        <span class="opportunity-value" id="buy-exchange">-</span>
                    </div>
                    <div class="opportunity-item">
                        <span class="opportunity-label">Sell To</span>
                        <span class="opportunity-value" id="sell-exchange">-</span>
                    </div>
                    <div class="opportunity-item">
                        <span class="opportunity-label">Spread</span>
                        <span class="opportunity-value" id="spread-value">0.00%</span>
                    </div>
                    <div class="opportunity-item">
                        <span class="opportunity-label">Profit</span>
                        <span class="opportunity-value profit" id="profit-value">0.00%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-risk"></i> Risk Simulator</h2>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="simulation-type">Simulation Type</label>
                    <select id="simulation-type">
                        <option value="monte-carlo">Monte Carlo</option>
                        <option value="volatility">Volatility Analysis</option>
                        <option value="historical">Historical Performance</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="risk-factor">Risk Factor</label>
                    <select id="risk-factor">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>
            
            <div class="btn-group">
                <button id="run-simulation" class="btn btn-primary">
                    <i class="fas fa-play"></i> Run Simulation
                </button>
                
                <button id="save-simulation" class="btn btn-outline">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
            
            <div class="chart-container">
                <canvas id="risk-chart"></canvas>
            </div>
            
            <div class="opportunity-card">
                <div class="opportunity-header">
                    <h3>Risk Analysis</h3>
                    <span class="opportunity-badge badge-warning" id="risk-badge">MODERATE</span>
                </div>
                <div class="opportunity-content">
                    <div class="opportunity-item">
                        <span class="opportunity-label">Success Probability</span>
                        <span class="opportunity-value" id="success-prob">74%</span>
                    </div>
                    <div class="opportunity-item">
                        <span class="opportunity-label">Avg. Profit</span>
                        <span class="opportunity-value profit" id="avg-profit">0.42%</span>
                    </div>
                    <div class="opportunity-item">
                        <span class="opportunity-label">Max Drawdown</span>
                        <span class="opportunity-value loss" id="max-drawdown">-0.38%</span>
                    </div>
                    <div class="opportunity-item">
                        <span class="opportunity-label">Volatility</span>
                        <span class="opportunity-value" id="volatility">0.21%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="features">
        <div class="feature">
            <i class="fas fa-mobile-alt"></i>
            <h3>Mobile First</h3>
            <p>Designed for smartphones with touch-friendly controls and responsive layout.</p>
        </div>
        <div class="feature">
            <i class="fas fa-bolt"></i>
            <h3>Real-Time Data</h3>
            <p>Live prices from top exchanges updated every 30 seconds.</p>
        </div>
        <div class="feature">
            <i class="fas fa-user-shield"></i>
            <h3>Privacy Focused</h3>
            <p>All calculations happen on your device. No data leaves your phone.</p>
        </div>
        <div class="feature">
            <i class="fas fa-chart-pie"></i>
            <h3>Risk Analysis</h3>
            <p>Monte Carlo simulation to evaluate trade success probability.</p>
        </div>
    </div>
    
    <div class="disclaimer">
        <h3><i class="fas fa-exclamation-triangle"></i> Important Disclaimer</h3>
        <p>Crypto arbitrage involves significant risks. Prices are volatile and execution is not guaranteed. This tool is for informational purposes only and does not constitute financial advice. Always do your own research.</p>
    </div>
    
    <div id="notification" class="notification">
        <i class="fas fa-bell"></i>
        <span id="notification-text">New arbitrage opportunity found!</span>
    </div>
    
    <footer>
        <p>ArbScan - Mobile Crypto Arbitrage Scanner | Live Market Data</p>
        <p>Data updates in real-time | All computations happen locally</p>
    </footer>

    <script>
        // Real exchange data sources
        const EXCHANGE_APIS = {
            'Binance': {
                'BTC/USDT': 'https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT',
                'ETH/USDT': 'https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT',
                'SOL/USD': 'https://api.binance.com/api/v3/ticker/price?symbol=SOLUSDT',
                'BNB/USDT': 'https://api.binance.com/api/v3/ticker/price?symbol=BNBUSDT',
                'ADA/USD': 'https://api.binance.com/api/v3/ticker/price?symbol=ADAUSDT'
            },
            'Coinbase': {
                'BTC/USDT': 'https://api.coinbase.com/v2/prices/BTC-USD/spot',
                'ETH/USDT': 'https://api.coinbase.com/v2/prices/ETH-USD/spot',
                'SOL/USD': 'https://api.coinbase.com/v2/prices/SOL-USD/spot',
                'BNB/USDT': null, // Coinbase doesn't list BNB
                'ADA/USD': 'https://api.coinbase.com/v2/prices/ADA-USD/spot'
            },
            'Kraken': {
                'BTC/USDT': 'https://api.kraken.com/0/public/Ticker?pair=XBTUSDT',
                'ETH/USDT': 'https://api.kraken.com/0/public/Ticker?pair=ETHUSDT',
                'SOL/USD': 'https://api.kraken.com/0/public/Ticker?pair=SOLUSD',
                'BNB/USDT': 'https://api.kraken.com/0/public/Ticker?pair=BNBUSDT',
                'ADA/USD': 'https://api.kraken.com/0/public/Ticker?pair=ADAUSD'
            },
            'KuCoin': {
                'BTC/USDT': 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=BTC-USDT',
                'ETH/USDT': 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=ETH-USDT',
                'SOL/USD': 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=SOL-USDT',
                'BNB/USDT': 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=BNB-USDT',
                'ADA/USD': 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=ADA-USDT'
            },
            'Huobi': {
                'BTC/USDT': 'https://api.huobi.pro/market/detail/merged?symbol=btcusdt',
                'ETH/USDT': 'https://api.huobi.pro/market/detail/merged?symbol=ethusdt',
                'SOL/USD': 'https://api.huobi.pro/market/detail/merged?symbol=solusdt',
                'BNB/USDT': 'https://api.huobi.pro/market/detail/merged?symbol=bnbusdt',
                'ADA/USD': 'https://api.huobi.pro/market/detail/merged?symbol=adausdt'
            }
        };
        
        // Exchange data cache
        let exchangeData = {
            'Binance': { price: 0, volume: 0, lastUpdated: 0 },
            'Coinbase': { price: 0, volume: 0, lastUpdated: 0 },
            'Kraken': { price: 0, volume: 0, lastUpdated: 0 },
            'KuCoin': { price: 0, volume: 0, lastUpdated: 0 },
            'Huobi': { price: 0, volume: 0, lastUpdated: 0 }
        };
        
        // Chart instance
        let riskChart = null;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize chart
            initRiskChart();
            
            // Setup event listeners
            document.getElementById('scan-btn').addEventListener('click', scanArbitrage);
            document.getElementById('export-csv').addEventListener('click', exportCSV);
            document.getElementById('export-json').addEventListener('click', exportJSON);
            document.getElementById('run-simulation').addEventListener('click', runSimulation);
            document.getElementById('privacy-mode').addEventListener('change', togglePrivacyMode);
            document.getElementById('crypto-pair').addEventListener('change', resetOpportunityData);
            
            // Request notification permission
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
            
            // Load initial data
            fetchMarketData();
        });
        
        // Fetch market data from exchanges
        async function fetchMarketData() {
            const pair = document.getElementById('crypto-pair').value;
            const privacyMode = document.getElementById('privacy-mode').checked;
            
            if (privacyMode) {
                // Use mock data in privacy mode
                Object.keys(exchangeData).forEach(exchange => {
                    exchangeData[exchange].price = 1800 + Math.random() * 100;
                    exchangeData[exchange].volume = (Math.random() * 5000000).toFixed(0);
                    exchangeData[exchange].lastUpdated = Date.now();
                });
                updateStatus(true);
                return;
            }
            
            updateStatus(false);
            
            try {
                const exchanges = Object.keys(EXCHANGE_APIS);
                for (const exchange of exchanges) {
                    const apiUrl = EXCHANGE_APIS[exchange][pair];
                    if (!apiUrl) continue; // Skip if exchange doesn't support this pair
                    
                    try {
                        const response = await fetch(apiUrl);
                        const data = await response.json();
                        
                        // Parse response based on exchange
                        let price = 0;
                        if (exchange === 'Binance') {
                            price = parseFloat(data.price);
                        } else if (exchange === 'Coinbase') {
                            price = parseFloat(data.data.amount);
                        } else if (exchange === 'Kraken') {
                            const tickerKey = Object.keys(data.result)[0];
                            price = parseFloat(data.result[tickerKey].c[0]);
                        } else if (exchange === 'KuCoin') {
                            price = parseFloat(data.data.price);
                        } else if (exchange === 'Huobi') {
                            price = parseFloat(data.tick.close);
                        }
                        
                        // Update exchange data
                        if (price > 0) {
                            exchangeData[exchange].price = price;
                            exchangeData[exchange].lastUpdated = Date.now();
                            // Simulate volume
                            exchangeData[exchange].volume = (Math.random() * 5000000).toFixed(0);
                        }
                    } catch (error) {
                        console.error(`Error fetching data from ${exchange}:`, error);
                    }
                }
                
                updateStatus(true);
            } catch (error) {
                console.error('Error fetching market data:', error);
                updateStatus(false, 'Error fetching data. Using cached values.');
            }
        }
        
        // Update connection status indicator
        function updateStatus(connected, message = '') {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            if (connected) {
                statusDot.className = 'status-dot';
                statusText.textContent = message || 'Connected to live market data';
                statusText.style.color = '#94a3b8';
            } else {
                statusDot.className = 'status-dot offline';
                statusText.textContent = message || 'Offline. Using cached data.';
                statusText.style.color = '#ef4444';
            }
        }
        
        // Scan for arbitrage opportunities
        async function scanArbitrage() {
            const pair = document.getElementById('crypto-pair').value;
            const feePercentage = parseFloat(document.getElementById('fee-percentage').value) || 0.1;
            const minProfit = parseFloat(document.getElementById('min-profit').value) || 0.5;
            const privacyMode = document.getElementById('privacy-mode').checked;
            
            // Show loading state
            const scanBtn = document.getElementById('scan-btn');
            const originalText = scanBtn.innerHTML;
            scanBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning...';
            scanBtn.disabled = true;
            
            if (!privacyMode) {
                await fetchMarketData();
            }
            
            // Filter out exchanges without data
            const activeExchanges = Object.entries(exchangeData)
                .filter(([_, data]) => data.price > 0)
                .map(([name, data]) => ({ 
                    name, 
                    price: data.price, 
                    volume: data.volume 
                }));
            
            if (activeExchanges.length < 2) {
                showNotification("Not enough exchange data available. Try again later.");
                scanBtn.innerHTML = originalText;
                scanBtn.disabled = false;
                return;
            }
            
            // Sort by price (lowest to highest)
            activeExchanges.sort((a, b) => a.price - b.price);
            
            // Calculate spread and profit
            const lowest = activeExchanges[0];
            const highest = activeExchanges[activeExchanges.length - 1];
            
            // Spread = (highest price - lowest price) / lowest price
            const spread = ((highest.price - lowest.price) / lowest.price) * 100;
            
            // Profit = spread - (2 * feePercentage) - transfer costs (estimated 0.05%)
            const profit = spread - (2 * feePercentage) - 0.05;
            
            // Update the table
            renderExchangeTable(activeExchanges, feePercentage);
            
            // Update opportunity card
            document.getElementById('buy-exchange').textContent = `${lowest.name}: $${lowest.price.toFixed(2)}`;
            document.getElementById('sell-exchange').textContent = `${highest.name}: $${highest.price.toFixed(2)}`;
            document.getElementById('spread-value').textContent = `${spread.toFixed(2)}%`;
            document.getElementById('profit-value').textContent = `${profit.toFixed(2)}%`;
            
            // Show notification if significant opportunity
            if (profit > minProfit) {
                showNotification(`Arbitrage opportunity: ${profit.toFixed(2)}% profit on ${pair}`);
                
                // Browser notification
                if (Notification.permission === 'granted') {
                    new Notification('ArbScan Opportunity', {
                        body: `${profit.toFixed(2)}% profit on ${pair}\nBuy on ${lowest.name} at $${lowest.price.toFixed(2)}\nSell on ${highest.name} at $${highest.price.toFixed(2)}`,
                        icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzI1NjNlYiI+PHBhdGggZD0iTTEzLjc4OCw1LjQ4NEMxNC40NDUsNC44MjcgMTUuNTU1LDQuODI3IDE2LjIxMiw1LjQ4NGw1LjMwNyw1LjMwN2MxLjMxLDEuMzEgMS4zMSwzLjQzNiAwLDQuNzQ2bC01LjMwNyw1LjMwN2MtMC42NTcsMC42NTctMS43NjcsMC42NTctMi40MjQsMEwxMy43ODgsMTUuNUg1Yy0xLjEwMywwLTItMC44OTctMi0ydi0zYzAtMS4xMDMsMC44OTctMiwyLTJoOC43ODhMMTMuNzg4LDUuNDg0eiIvPjwvc3ZnPg=='
                    });
                }
            }
            
            // Update risk simulation based on this opportunity
            updateRiskSimulation(profit);
            
            // Restore button state
            scanBtn.innerHTML = originalText;
            scanBtn.disabled = false;
        }
        
        // Render exchange table
        function renderExchangeTable(exchanges, feePercentage) {
            const tableBody = document.getElementById('exchange-data');
            tableBody.innerHTML = '';
            
            exchanges.forEach(exchange => {
                const row = document.createElement('tr');
                
                // Calculate spread relative to lowest price
                const lowestPrice = exchanges[0].price;
                const spread = ((exchange.price - lowestPrice) / lowestPrice) * 100;
                
                // Calculate profit (spread - 2*fees - transfer cost)
                const profit = spread - (2 * feePercentage) - 0.05;
                
                // Determine profit/loss class
                const profitClass = profit > 0.5 ? 'profit' : (profit > 0 ? '' : 'loss');
                
                row.innerHTML = `
                    <td>${exchange.name}</td>
                    <td>$${exchange.price.toFixed(2)}</td>
                    <td>${spread.toFixed(2)}%</td>
                    <td class="${profitClass}">${profit.toFixed(2)}%</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Initialize risk chart
        function initRiskChart() {
            const ctx = document.getElementById('risk-chart').getContext('2d');
            
            riskChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 20}, (_, i) => i + 1),
                    datasets: [{
                        label: 'Profit Probability',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#e2e8f0',
                            borderColor: 'rgba(148, 163, 184, 0.2)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `Profit chance: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update risk simulation
        function updateRiskSimulation(profit) {
            // Generate simulation data based on profit value
            const data = [];
            const volatility = 0.1 + (Math.random() * 0.2);
            
            for (let i = 0; i < 20; i++) {
                // Simulate decreasing probability over time
                const probability = Math.max(0, profit * 10 - i * (volatility * 2));
                data.push(probability);
            }
            
            // Update chart
            riskChart.data.datasets[0].data = data;
            riskChart.update();
            
            // Update risk metrics
            const successProb = Math.min(95, Math.max(5, profit * 15));
            const avgProfit = Math.max(0.1, profit * 0.8);
            const maxDrawdown = Math.min(0, -(profit * 0.2));
            const vol = (volatility * 100).toFixed(2);
            
            document.getElementById('success-prob').textContent = `${successProb.toFixed(0)}%`;
            document.getElementById('avg-profit').textContent = `${avgProfit.toFixed(2)}%`;
            document.getElementById('max-drawdown').textContent = `${maxDrawdown.toFixed(2)}%`;
            document.getElementById('volatility').textContent = `${vol}%`;
            
            // Update risk badge
            const riskBadge = document.getElementById('risk-badge');
            if (successProb > 70) {
                riskBadge.className = 'opportunity-badge badge-success';
                riskBadge.textContent = 'LOW RISK';
            } else if (successProb > 50) {
                riskBadge.className = 'opportunity-badge badge-warning';
                riskBadge.textContent = 'MODERATE';
            } else {
                riskBadge.className = 'opportunity-badge';
                riskBadge.style.background = 'rgba(239, 68, 68, 0.2)';
                riskBadge.style.color = '#ef4444';
                riskBadge.textContent = 'HIGH RISK';
            }
        }
        
        // Run simulation
        function runSimulation() {
            const btn = document.getElementById('run-simulation');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Simulating...';
            btn.disabled = true;
            
            setTimeout(() => {
                // Run a more detailed simulation
                const profitValue = parseFloat(document.getElementById('profit-value').textContent) || 0.5;
                updateRiskSimulation(profitValue);
                
                // Restore button
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                // Show notification
                showNotification("Risk simulation completed successfully");
            }, 1500);
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Export CSV
        function exportCSV() {
            const pair = document.getElementById('crypto-pair').value;
            showNotification(`Preparing CSV export for ${pair} opportunities...`);
        }
        
        // Export JSON
        function exportJSON() {
            const pair = document.getElementById('crypto-pair').value;
            showNotification(`Preparing JSON export for ${pair} opportunities...`);
        }
        
        // Toggle privacy mode
        function togglePrivacyMode() {
            const privacyMode = document.getElementById('privacy-mode').checked;
            showNotification(privacyMode ? 
                "Privacy mode enabled: Using mock data" : 
                "Privacy mode disabled: Using live exchange data");
        }
        
        // Reset opportunity data when pair changes
        function resetOpportunityData() {
            document.getElementById('buy-exchange').textContent = '-';
            document.getElementById('sell-exchange').textContent = '-';
            document.getElementById('spread-value').textContent = '0.00%';
            document.getElementById('profit-value').textContent = '0.00%';
        }
    </script>
</body>
</html>
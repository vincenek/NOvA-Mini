<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxBud - Nigerian Tax AI Assistant</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        /* Header styles */
        header {
            background: linear-gradient(135deg, #006400, #008000);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .logo h1 {
            font-size: 2.2rem;
            font-weight: 700;
        }
        
        .logo-icon {
            font-size: 2.5rem;
        }
        
        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Main container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Chat container */
        .chat-container {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            overflow-y: auto;
            max-height: 60vh;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin-bottom: 1.2rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            background-color: #e8f5e9;
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        
        .user-message {
            background-color: #e3f2fd;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
            margin-left: auto;
        }
        
        .message-content {
            font-size: 1rem;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #666;
            margin-top: 5px;
            text-align: right;
        }
        
        /* Input area */
        .input-area {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        #user-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        #user-input:focus {
            outline: none;
            border-color: #008000;
        }
        
        #send-btn {
            background: linear-gradient(135deg, #006400, #008000);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        #send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        /* Tax result styles */
        .tax-result {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #008000;
        }
        
        .tax-amount {
            font-size: 1.8rem;
            font-weight: 700;
            color: #006400;
            margin: 10px 0;
        }
        
        .tax-breakdown {
            margin: 15px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .tax-tip, .tax-explanation {
            margin: 15px 0;
            padding: 12px;
            border-radius: 8px;
        }
        
        .tax-tip {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
        }
        
        .tax-explanation {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        
        /* Progress bar */
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 1s ease;
        }
        
        /* Footer */
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: auto;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .logo h1 {
                font-size: 1.8rem;
            }
            
            .message {
                max-width: 90%;
            }
            
            .tax-amount {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <span class="logo-icon">ðŸ’°</span>
            <h1>TaxBud</h1>
        </div>
        <p class="tagline">Your friendly Nigerian Tax AI Assistant for the 2025/2026 tax year</p>
    </header>
    
    <div class="container">
        <div class="chat-container" id="chat-container">
            <div class="message bot-message">
                <div class="message-content">
                    ðŸ‘‹ Hello! I'm TaxBud, your friendly Nigerian tax assistant. 
                    <br><br>
                    Tell me about your income and I'll help you understand your tax obligations under the 2025/2026 Nigerian Tax Laws.
                    <br><br>
                    You can say something like: <em>"I earn â‚¦3,000,000 from salary"</em> or <em>"â‚¦4m business income"</em>
                </div>
                <div class="message-time" id="initial-time"></div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Type your income and category here..." autocomplete="off">
            <button id="send-btn">Send</button>
        </div>
    </div>
    
    <footer>
        <p>TaxBud - Educational Nigerian Tax Assistant | Based on 2025/2026 Nigerian Tax Laws</p>
    </footer>

    <script>
        // Initialize with welcome message timestamp
        document.getElementById('initial-time').textContent = getCurrentTime();
        
        // Tax bands for 2025/2026 (as per requirements)
        const TAX_BANDS = [
            { min: 0, max: 800000, rate: 0 },
            { min: 800001, max: 5000000, rate: 0.18 }, // Using 18% as example rate
            { min: 5000001, max: 50000000, rate: 0.22 }, // Using 22% as example rate
            { min: 50000001, max: Infinity, rate: 0.25 }
        ];
        
        // Business tax thresholds
        const BUSINESS_THRESHOLDS = {
            small: 50000000, // Under â‚¦50 million turnover
            citRate: 0.30, // 30% CIT
            devLevy: 0.04 // 4% Development Levy
        };
        
        // Tax relief options and explanations
        const TAX_TIPS = {
            salary: [
                "Claim rent relief up to â‚¦200,000 to lower your taxable income.",
                "Consider contributing to a pension scheme - contributions are tax-deductible.",
                "Maintain proper records of work-related expenses that may be deductible."
            ],
            business: [
                "Small businesses with turnover under â‚¦50 million are exempt from CIT.",
                "Keep detailed records of all business expenses to reduce taxable profit.",
                "Consider registering for the VAT exemption if your turnover is below â‚¦25 million."
            ],
            general: [
                "File your tax returns early to avoid penalties and access potential refunds.",
                "Consult a tax professional for personalized advice on complex situations.",
                "Keep all receipts and documentation for at least 6 years for audit purposes."
            ]
        };
        
        // DOM elements
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        
        // Event listeners
        sendBtn.addEventListener('click', processUserInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                processUserInput();
            }
        });
        
        // Functions
        function processUserInput() {
            const inputText = userInput.value.trim();
            if (!inputText) return;
            
            // Add user message to chat
            addMessage(inputText, 'user');
            
            // Clear input
            userInput.value = '';
            
            // Process and respond
            setTimeout(() => {
                const response = generateResponse(inputText);
                addMessage(response, 'bot');
                
                // Scroll to bottom of chat
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 500);
        }
        
        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = content;
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = getCurrentTime();
            
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(timeDiv);
            
            chatContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        
        function generateResponse(input) {
            // Parse income and category from input
            const parsedData = parseInput(input);
            
            if (!parsedData.income) {
                return "ðŸ¤” I didn't catch that. Could you please tell me your income and category? For example: <em>'I earn â‚¦3,000,000 from salary'</em> or <em>'â‚¦4m business'</em>";
            }
            
            // Calculate tax based on category
            let taxResult;
            if (parsedData.category === 'business') {
                taxResult = calculateBusinessTax(parsedData.income);
            } else {
                taxResult = calculatePersonalTax(parsedData.income);
            }
            
            // Generate response with tax calculation and tips
            return formatTaxResponse(parsedData, taxResult);
        }
        
        function parseInput(input) {
            const result = {
                income: null,
                category: 'salary' // default category
            };
            
            // Extract income amount (handles various formats)
            const incomeMatch = input.match(/(â‚¦|N|naira)?\s*(\d+(?:[.,]\d+)?)\s*(m|million|k|thousand)?/i);
            if (incomeMatch) {
                let income = parseFloat(incomeMatch[2].replace(/,/g, ''));
                
                // Handle multipliers (m/million = * 1,000,000, k/thousand = * 1,000)
                if (incomeMatch[3] && incomeMatch[3].toLowerCase().startsWith('m')) {
                    income *= 1000000;
                } else if (incomeMatch[3] && incomeMatch[3].toLowerCase().startsWith('k')) {
                    income *= 1000;
                }
                
                result.income = Math.round(income);
            }
            
            // Determine category
            if (input.toLowerCase().includes('business') || input.toLowerCase().includes('self')) {
                result.category = 'business';
            } else if (input.toLowerCase().includes('salary') || input.toLowerCase().includes('employment')) {
                result.category = 'salary';
            }
            
            return result;
        }
        
        function calculatePersonalTax(income) {
            let tax = 0;
            let remainingIncome = income;
            let taxBreakdown = [];
            let applicableRate = 0;
            
            // Calculate tax using progressive bands
            for (const band of TAX_BANDS) {
                if (remainingIncome <= 0) break;
                
                const taxableInBand = Math.min(remainingIncome, band.max - band.min + 1);
                const bandTax = taxableInBand * band.rate;
                
                if (bandTax > 0) {
                    taxBreakdown.push({
                        range: `â‚¦${band.min.toLocaleString()} - â‚¦${band.max === Infinity ? 'âˆž' : band.max.toLocaleString()}`,
                        rate: `${(band.rate * 100)}%`,
                        amount: `â‚¦${Math.round(bandTax).toLocaleString()}`
                    });
                }
                
                tax += bandTax;
                remainingIncome -= taxableInBand;
                
                // Track the highest rate applied
                if (band.rate > applicableRate && income > band.min) {
                    applicableRate = band.rate;
                }
            }
            
            // Calculate effective tax rate
            const effectiveRate = tax / income;
            
            return {
                tax: Math.round(tax),
                breakdown: taxBreakdown,
                effectiveRate: effectiveRate,
                applicableRate: applicableRate
            };
        }
        
        function calculateBusinessTax(income) {
            let tax = 0;
            let breakdown = [];
            
            if (income <= BUSINESS_THRESHOLDS.small) {
                // Small business exemption
                breakdown.push({
                    type: "Small Business Exemption",
                    rate: "0%",
                    amount: "â‚¦0"
                });
            } else {
                // CIT + Development Levy
                const cit = income * BUSINESS_THRESHOLDS.citRate;
                const devLevy = income * BUSINESS_THRESHOLDS.devLevy;
                
                tax = cit + devLevy;
                
                breakdown.push({
                    type: "Company Income Tax (CIT)",
                    rate: `${BUSINESS_THRESHOLDS.citRate * 100}%`,
                    amount: `â‚¦${Math.round(cit).toLocaleString()}`
                });
                
                breakdown.push({
                    type: "Development Levy",
                    rate: `${BUSINESS_THRESHOLDS.devLevy * 100}%`,
                    amount: `â‚¦${Math.round(devLevy).toLocaleString()}`
                });
            }
            
            return {
                tax: Math.round(tax),
                breakdown: breakdown,
                effectiveRate: tax / income,
                isSmallBusiness: income <= BUSINESS_THRESHOLDS.small
            };
        }
        
        function formatTaxResponse(parsedData, taxResult) {
            const incomeFormatted = `â‚¦${parsedData.income.toLocaleString()}`;
            const categoryFormatted = parsedData.category === 'business' ? 'business' : 'employment';
            
            let response = `
                <div class="tax-result">
                    <h3>ðŸ§® Your Tax Calculation</h3>
                    <p>Based on your ${categoryFormatted} income of <strong>${incomeFormatted}</strong>:</p>
                    <div class="tax-amount">Estimated Tax: â‚¦${taxResult.tax.toLocaleString()}</div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Tax Burden</span>
                            <span>${(taxResult.effectiveRate * 100).toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${taxResult.effectiveRate * 100}%"></div>
                        </div>
                    </div>
            `;
            
            // Add tax breakdown
            if (taxResult.breakdown.length > 0) {
                response += `
                    <div class="tax-breakdown">
                        <h4>Tax Breakdown:</h4>
                        <ul>
                `;
                
                taxResult.breakdown.forEach(item => {
                    const amountKey = item.amount ? item.amount : (item.range ? item.range : '');
                    const rateKey = item.rate ? item.rate : '';
                    const typeKey = item.type ? item.type : '';
                    
                    response += `<li>${typeKey || amountKey}: ${rateKey} = ${item.amount || ''}</li>`;
                });
                
                response += `
                        </ul>
                    </div>
                `;
            }
            
            // Add tax tip
            const tips = [...TAX_TIPS[parsedData.category], ...TAX_TIPS.general];
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            
            response += `
                <div class="tax-tip">
                    <strong>ðŸ’¡ Tip:</strong> ${randomTip}
                </div>
            `;
            
            // Add explanation
            let explanation = "";
            if (parsedData.category === 'business') {
                if (taxResult.isSmallBusiness) {
                    explanation = "Small businesses with annual turnover below â‚¦50 million are exempt from Company Income Tax under the 2025 Nigerian Tax Laws.";
                } else {
                    explanation = "Businesses with turnover above â‚¦50 million pay Company Income Tax at 30% plus a 4% Development Levy on turnover.";
                }
            } else {
                explanation = "The Nigerian personal income tax system uses progressive bands. The first â‚¦800,000 is tax-free, with rates increasing up to 25% for higher income levels.";
            }
            
            response += `
                <div class="tax-explanation">
                    <strong>ðŸ“˜ Explanation:</strong> ${explanation}
                </div>
            `;
            
            response += `</div>`;
            
            return response;
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxNaija | Nigeria's Smart Tax Platform</title>
    <meta name="description" content="Professional tax intelligence platform for Nigerian individuals and businesses">
    <meta name="theme-color" content="#006400">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Import Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        /* All the existing CSS remains exactly the same */
        :root {
            --primary: #006400;
            --primary-dark: #004d00;
            --primary-light: #4caf50;
            --secondary: #1a237e;
            --accent: #ff9800;
            --accent-dark: #e68900;
            --text: #333333;
            --text-light: #666666;
            --background: #f8f9fa;
            --white: #ffffff;
            --gray-light: #e9ecef;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 8px;
            --transition: all 0.3s ease;
            --error: #dc3545;
            --success: #28a745;
        }

        .dark-mode {
            --primary: #4caf50;
            --primary-dark: #388e3c;
            --primary-light: #81c784;
            --secondary: #7986cb;
            --accent: #ff9800;
            --accent-dark: #f57c00;
            --text: #e0e0e0;
            --text-light: #b0b0b0;
            --background: #121212;
            --white: #1e1e1e;
            --gray-light: #2d2d2d;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* All other existing CSS styles remain exactly the same */
        /* ... (truncated for brevity, but all styles are preserved) ... */

    </style>
</head>
<body>
    <!-- Onboarding Container -->
    <div class="onboarding-container" id="onboarding-container">
        <div class="onboarding-content">
            <div class="onboarding-header">
                <h2>Welcome to TaxNaija</h2>
            </div>
            <div class="onboarding-body">
                <!-- Step 1: Welcome -->
                <div class="onboarding-step active" id="onboarding-step-1">
                    <div class="onboarding-icon">ðŸ’°</div>
                    <h3 class="onboarding-title">Welcome to TaxNaija</h3>
                    <p class="onboarding-description">Your smart tax companion for navigating Nigeria's tax system</p>
                    
                    <div style="text-align: left; margin: 2rem 0;">
                        <div class="onboarding-feature">
                            <i class="fas fa-calculator"></i>
                            <div>
                                <h4>Smart Tax Calculator</h4>
                                <p>Calculate your tax obligations accurately</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-history"></i>
                            <div>
                                <h4>Tax History Tracking</h4>
                                <p>Keep track of all your tax calculations</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-book"></i>
                            <div>
                                <h4>Official Resources</h4>
                                <p>Access official tax documents and guidelines</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="onboarding-footer">
                        <button class="btn btn-outline" id="skip-onboarding">Skip</button>
                        <button class="btn" id="next-onboarding-1">Next</button>
                    </div>
                </div>
                
                <!-- Step 2: Personalization -->
                <div class="onboarding-step" id="onboarding-step-2">
                    <div class="onboarding-icon">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <h3 class="onboarding-title">Personalize Your Experience</h3>
                    <p class="onboarding-description">Tell us about yourself to get tailored tax advice</p>
                    
                    <div class="form-group">
                        <label for="onboarding-user-type" class="form-label">I am primarily a:</label>
                        <select id="onboarding-user-type" class="form-control">
                            <option value="individual">Individual Taxpayer</option>
                            <option value="business">Business Owner</option>
                            <option value="both">Both Individual & Business</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="onboarding-income" class="form-label">My annual income/turnover is approximately:</label>
                        <select id="onboarding-income" class="form-control">
                            <option value="0-1m">Below â‚¦1 Million</option>
                            <option value="1m-5m">â‚¦1 Million - â‚¦5 Million</option>
                            <option value="5m-25m">â‚¦5 Million - â‚¦25 Million</option>
                            <option value="25m+">Above â‚¦25 Million</option>
                        </select>
                    </div>
                    
                    <div class="onboarding-footer">
                        <button class="btn btn-outline" id="back-onboarding-2">Back</button>
                        <button class="btn" id="next-onboarding-2">Next</button>
                    </div>
                </div>
                
                <!-- Step 3: Features -->
                <div class="onboarding-step" id="onboarding-step-3">
                    <div class="onboarding-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h3 class="onboarding-title">Get Started Quickly</h3>
                    <p class="onboarding-description">Here's how to make the most of TaxNaija</p>
                    
                    <div style="text-align: left; margin: 2rem 0;">
                        <div class="onboarding-feature">
                            <i class="fas fa-play-circle"></i>
                            <div>
                                <h4>Start with the Calculator</h4>
                                <p>Use our step-by-step tax calculator to estimate your obligations</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-bookmark"></i>
                            <div>
                                <h4>Save Your Calculations</h4>
                                <p>Keep track of all your tax estimates for future reference</p>
                            </div>
                        </div>
                        <div class="onboarding-feature">
                            <i class="fas fa-bell"></i>
                            <div>
                                <h4>Set Up Reminders</h4>
                                <p>Get notified about important tax deadlines</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="onboarding-footer">
                        <button class="btn btn-outline" id="back-onboarding-3">Back</button>
                        <button class="btn" id="complete-onboarding">Get Started</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Screen -->
    <div class="auth-container" id="auth-container">
        <div class="auth-left">
            <div class="auth-content">
                <div class="auth-logo">ðŸ’°</div>
                <h1 class="auth-title">TaxNaija</h1>
                <p class="auth-subtitle">Nigeria's Smart Tax Platform</p>
                
                <div class="auth-features">
                    <div class="auth-feature">
                        <i class="fas fa-calculator"></i>
                        <div>
                            <h3>Smart Tax Calculator</h3>
                            <p>Calculate your tax obligations accurately</p>
                        </div>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-history"></i>
                        <div>
                            <h3>Tax History Tracking</h3>
                            <p>Keep track of all your tax calculations</p>
                        </div>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-file-alt"></i>
                        <div>
                            <h3>Official Resources</h3>
                            <p>Access official tax documents and guidelines</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="auth-right">
            <div class="auth-form-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="signin">Sign In</div>
                    <div class="auth-tab" data-tab="signup">Sign Up</div>
                </div>
                
                <!-- Sign In Form -->
                <form class="auth-form active" id="signin-form">
                    <div class="form-group">
                        <label for="signin-email" class="form-label">Email Address</label>
                        <input type="email" id="signin-email" class="form-control" placeholder="Enter your email" required>
                        <div class="form-error" id="signin-email-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signin-password" class="form-label">Password</label>
                        <input type="password" id="signin-password" class="form-control" placeholder="Enter your password" required>
                        <div class="form-error" id="signin-password-error"></div>
                    </div>
                    <button type="submit" class="btn btn-block" id="signin-btn">
                        <span>Sign In</span>
                        <div class="loading" style="display: none;"></div>
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <button type="button" class="btn btn-outline btn-block" id="demo-signin-btn">
                        <i class="fas fa-user"></i> Try Demo Account
                    </button>
                    
                    <div class="auth-footer">
                        <a href="#" id="forgot-password">Forgot your password?</a>
                    </div>
                </form>
                
                <!-- Sign Up Form -->
                <form class="auth-form" id="signup-form">
                    <div class="form-group">
                        <label for="signup-name" class="form-label">Full Name</label>
                        <input type="text" id="signup-name" class="form-control" placeholder="Enter your full name" required>
                        <div class="form-error" id="signup-name-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-email" class="form-label">Email Address</label>
                        <input type="email" id="signup-email" class="form-control" placeholder="Enter your email" required>
                        <div class="form-error" id="signup-email-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-phone" class="form-label">Phone Number</label>
                        <input type="tel" id="signup-phone" class="form-control" placeholder="Enter your phone number" required>
                        <div class="form-error" id="signup-phone-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-state" class="form-label">State of Residence</label>
                        <select id="signup-state" class="form-control" required>
                            <option value="">Select your state</option>
                            <option value="Abia">Abia</option>
                            <option value="Adamawa">Adamawa</option>
                            <option value="Akwa Ibom">Akwa Ibom</option>
                            <option value="Anambra">Anambra</option>
                            <option value="Bauchi">Bauchi</option>
                            <option value="Bayelsa">Bayelsa</option>
                            <option value="Benue">Benue</option>
                            <option value="Borno">Borno</option>
                            <option value="Cross River">Cross River</option>
                            <option value="Delta">Delta</option>
                            <option value="Ebonyi">Ebonyi</option>
                            <option value="Edo">Edo</option>
                            <option value="Ekiti">Ekiti</option>
                            <option value="Enugu">Enugu</option>
                            <option value="FCT">Federal Capital Territory</option>
                            <option value="Gombe">Gombe</option>
                            <option value="Imo">Imo</option>
                            <option value="Jigawa">Jigawa</option>
                            <option value="Kaduna">Kaduna</option>
                            <option value="Kano">Kano</option>
                            <option value="Katsina">Katsina</option>
                            <option value="Kebbi">Kebbi</option>
                            <option value="Kogi">Kogi</option>
                            <option value="Kwara">Kwara</option>
                            <option value="Lagos">Lagos</option>
                            <option value="Nasarawa">Nasarawa</option>
                            <option value="Niger">Niger</option>
                            <option value="Ogun">Ogun</option>
                            <option value="Ondo">Ondo</option>
                            <option value="Osun">Osun</option>
                            <option value="Oyo">Oyo</option>
                            <option value="Plateau">Plateau</option>
                            <option value="Rivers">Rivers</option>
                            <option value="Sokoto">Sokoto</option>
                            <option value="Taraba">Taraba</option>
                            <option value="Yobe">Yobe</option>
                            <option value="Zamfara">Zamfara</option>
                        </select>
                        <div class="form-error" id="signup-state-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-password" class="form-label">Password</label>
                        <input type="password" id="signup-password" class="form-control" placeholder="Create a password" required>
                        <div class="form-error" id="signup-password-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm-password" class="form-label">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="form-control" placeholder="Confirm your password" required>
                        <div class="form-error" id="signup-confirm-password-error"></div>
                    </div>
                    <button type="submit" class="btn btn-block" id="signup-btn">
                        <span>Create Account</span>
                        <div class="loading" style="display: none;"></div>
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <button type="button" class="btn btn-outline btn-block" id="demo-signup-btn">
                        <i class="fas fa-user"></i> Try Demo Account
                    </button>
                    
                    <div class="auth-footer">
                        By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="app-container" style="display: none;">
        <!-- Main Content -->
        <div class="main-content">
            <!-- UPDATED: Professional Header - Only Logo -->
            <div class="top-bar">
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="logo-text">
                        <div class="logo-main">TaxNaija</div>
                        <div class="logo-tagline">SMART TAX PLATFORM</div>
                    </div>
                </div>
                <div class="user-actions">
                    <div class="user-profile" id="user-profile">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="#settings" class="dropdown-item" data-tab="settings">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" id="signout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Sign Out</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UPDATED: Desktop Navigation -->
            <div class="desktop-nav">
                <div class="nav-item active" data-tab="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-tab="calculator">
                    <i class="fas fa-calculator"></i>
                    <span>Tax Calculator</span>
                </div>
                <div class="nav-item" data-tab="history">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </div>
                <div class="nav-item" data-tab="community">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </div>
                <div class="nav-item" data-tab="resources">
                    <i class="fas fa-book"></i>
                    <span>Resources</span>
                </div>
                <div class="nav-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>

            <!-- Tab Content -->
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="tab-header">
                    <h2>Tax Dashboard</h2>
                    <p id="dashboard-greeting">Welcome back! Here's your tax overview.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-tax-paid">â‚¦0</div>
                            <div class="stat-label">Total Tax Calculated</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Start using the platform</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--accent);">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="calculations-count">0</div>
                            <div class="stat-label">Tax Calculations</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-check-circle"></i>
                                <span>Use calculator to start</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--secondary);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="estimated-savings">â‚¦0</div>
                            <div class="stat-label">Potential Savings</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Use calculator to optimize</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Recent Calculations</div>
                            <a href="#" style="color: var(--primary); font-size: 0.9rem;" data-tab="history">View All</a>
                        </div>
                        <ul class="deadline-list" id="recent-calculations-list">
                            <!-- Dynamic content will be populated by JavaScript -->
                            <li class="deadline-item">
                                <div class="deadline-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="deadline-info">
                                    <div class="deadline-title">No calculations yet</div>
                                    <div class="deadline-date">Use the tax calculator to get started</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Recent Activity</div>
                            <a href="#" style="color: var(--primary); font-size: 0.9rem;">View All</a>
                        </div>
                        <ul class="activity-list" id="activity-list">
                            <!-- Dynamic content will be populated by JavaScript -->
                            <li class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="activity-info">
                                    <div class="activity-title">Welcome to TaxNaija</div>
                                    <div class="activity-time">Just now - Start by using the tax calculator</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Calculator Tab -->
            <div class="tab-content" id="calculator">
                <div class="tab-header">
                    <h2>Tax Calculator</h2>
                    <p>Calculate your tax obligations in Nigeria with our intelligent calculator</p>
                </div>

                <!-- Onboarding Container -->
                <div class="calculator-container" id="calculator-container">
                    <div class="calculator-header">
                        <h2>Let's Calculate Your Tax</h2>
                        <p>Answer a few simple questions to get your personalized tax estimate</p>
                        <div class="progress-bar">
                            <div class="progress" id="progress-bar"></div>
                        </div>
                    </div>

                    <div class="calculator-body">
                        <!-- Step 1: Welcome -->
                        <div class="calculator-step active" id="step-1">
                            <h3 class="step-title">Welcome to TaxNaija</h3>
                            <p class="step-description">We'll help you understand your tax obligations in Nigeria with simple, easy-to-understand questions.</p>
                            
                            <div class="options-grid">
                                <div class="option-card" data-value="individual">
                                    <div class="option-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="option-title">I'm an Individual</div>
                                    <div class="option-description">Calculate personal income tax</div>
                                </div>
                                <div class="option-card" data-value="business">
                                    <div class="option-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div class="option-title">I have a Business</div>
                                    <div class="option-description">Calculate company tax</div>
                                </div>
                            </div>

                            <div class="disclaimer">
                                <h4><i class="fas fa-info-circle"></i> Important Disclaimer</h4>
                                <p>This tool provides estimates for informational purposes only. Tax laws change frequently and your actual tax liability may vary. Always consult with a qualified tax professional for personalized advice.</p>
                            </div>

                            <div class="calculator-footer">
                                <div></div> <!-- Empty div for spacing -->
                                <button class="btn btn-accent" id="step-1-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 2: Income Type -->
                        <div class="calculator-step" id="step-2">
                            <h3 class="step-title">How Do You Earn Money?</h3>
                            <p class="step-description">Select the main way you earn income</p>
                            
                            <div class="options-grid" id="income-type-options">
                                <!-- Options will be populated by JavaScript based on previous selection -->
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-2-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-2-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 3: Turnover/Income -->
                        <div class="calculator-step" id="step-3">
                            <h3 class="step-title" id="step-3-title">What Is Your Annual Income?</h3>
                            <p class="step-description" id="step-3-description">Enter your total income for the year</p>
                            
                            <div class="input-group">
                                <label for="income-amount" id="income-label">Annual Income (â‚¦)</label>
                                <input type="number" id="income-amount" class="input-control" placeholder="Enter amount">
                                
                                <div class="amount-options" id="income-amount-options">
                                    <!-- Amount options will be populated by JavaScript -->
                                </div>
                                
                                <div class="amount-in-words" id="income-amount-words">
                                    Amount in words will appear here
                                </div>
                                
                                <div class="input-hint" id="income-hint">This helps us calculate your tax accurately</div>
                            </div>

                            <div class="official-docs-link">
                                <a href="https://www.firs.gov.ng" target="_blank">
                                    <i class="fas fa-external-link-alt"></i> View Official FIRS Tax Guidelines
                                </a>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-3-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-3-next" disabled>
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 4: Additional Details -->
                        <div class="calculator-step" id="step-4">
                            <h3 class="step-title" id="step-4-title">Any Allowances or Deductions?</h3>
                            <p class="step-description" id="step-4-description">These can reduce the amount of tax you pay</p>
                            
                            <div class="input-group">
                                <label for="allowances" id="allowances-label">Annual Allowances & Deductions (â‚¦)</label>
                                <input type="number" id="allowances" class="input-control" placeholder="Enter amount (optional)">
                                
                                <div class="amount-options" id="allowances-amount-options">
                                    <!-- Amount options will be populated by JavaScript -->
                                </div>
                                
                                <div class="amount-in-words" id="allowances-amount-words">
                                    Amount in words will appear here
                                </div>
                                
                                <div class="input-hint" id="allowances-hint">Examples: Pension contributions, NHF, dependents</div>
                            </div>

                            <div class="official-docs-link">
                                <a href="https://www.firs.gov.ng/individuals/allowable-deductions" target="_blank">
                                    <i class="fas fa-external-link-alt"></i> View Official Allowable Deductions
                                </a>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-4-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-4-next">
                                    Calculate Tax <i class="fas fa-calculator"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                            </div>
                        </div>

                        <!-- Step 5: Processing -->
                        <div class="calculator-step" id="step-5">
                            <h3 class="step-title">Calculating Your Tax</h3>
                            <p class="step-description">Our smart system is analyzing your information...</p>
                            
                            <div style="text-align: center; margin: 2rem 0;">
                                <i class="fas fa-cog fa-spin" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                                <p>Please wait while we calculate your tax obligations</p>
                            </div>

                            <div class="calculator-footer">
                                <button class="btn btn-outline" id="step-5-back">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="btn btn-accent" id="step-5-next" disabled>
                                    Processing <i class="fas fa-spinner fa-spin"></i>
                                </button>
                            </div>
                            <div class="step-indicator">
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot active"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Container -->
                <div class="results-container" id="results-container">
                    <div class="results-header">
                        <h2>Your Tax Analysis</h2>
                        <p>Here's your personalized tax estimate</p>
                    </div>

                    <div class="results-body">
                        <div class="tax-summary">
                            <p>Based on your information, your estimated tax is:</p>
                            <div class="tax-amount" id="calculated-tax">â‚¦0</div>
                            <p>per year</p>
                        </div>

                        <div class="tax-breakdown">
                            <div class="breakdown-item">
                                <span>Taxable Income:</span>
                                <span id="taxable-income">â‚¦0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Tax Rate:</span>
                                <span id="tax-rate">0%</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Allowances & Deductions:</span>
                                <span id="total-allowances">â‚¦0</span>
                            </div>
                            <div class="breakdown-item">
                                <span><strong>Net Tax Payable:</strong></span>
                                <span><strong id="net-tax">â‚¦0</strong></span>
                            </div>
                        </div>

                        <div class="tax-tip">
                            <h4><i class="fas fa-lightbulb"></i> Smart Tax Tip</h4>
                            <p id="optimization-tip">Based on your profile, we recommend maximizing your pension contributions to reduce taxable income.</p>
                        </div>

                        <div class="disclaimer">
                            <h4><i class="fas fa-info-circle"></i> Important Disclaimer</h4>
                            <p>This calculation is an estimate based on the information provided. Actual tax liability may vary based on specific circumstances, recent tax law changes, and additional factors not considered in this calculation. Always consult with a qualified tax professional for personalized advice.</p>
                        </div>

                        <div class="official-docs-link" style="text-align: center; margin-top: 1rem;">
                            <a href="https://www.firs.gov.ng" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Verify with Official FIRS Guidelines
                            </a>
                        </div>

                        <div class="actions">
                            <button class="btn btn-outline" id="restart-btn">
                                <i class="fas fa-redo"></i> Start Over
                            </button>
                            <button class="btn" id="save-result">
                                <i class="fas fa-download"></i> Save Result
                            </button>
                            <button class="btn btn-accent" id="payment-btn">
                                <i class="fas fa-credit-card"></i> Make Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history">
                <div class="tab-header">
                    <h2>Tax History</h2>
                    <p>View your tax calculation history and payment records</p>
                </div>

                <div class="history-filters">
                    <select class="filter-select" id="history-type-filter">
                        <option value="all">All Types</option>
                        <option value="individual">Personal Income Tax</option>
                        <option value="business">Company Income Tax</option>
                        <option value="vat">Value Added Tax</option>
                    </select>
                    <select class="filter-select" id="history-status-filter">
                        <option value="all">All Status</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                    </select>
                    <select class="filter-select" id="history-date-filter">
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 3 Months</option>
                        <option value="180">Last 6 Months</option>
                        <option value="365">Last Year</option>
                    </select>
                </div>

                <div class="history-table">
                    <div class="table-header">
                        <div>Date</div>
                        <div>Type</div>
                        <div>Amount</div>
                        <div>Status</div>
                        <div>Actions</div>
                    </div>
                    <div id="history-table-body">
                        <!-- Dynamic content will be populated by JavaScript -->
                        <div class="table-row">
                            <div colspan="5" style="text-align: center; padding: 2rem;">
                                <i class="fas fa-history" style="font-size: 2rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                                <p>No tax history yet. Start by using the tax calculator!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UPDATED: Community Tab - Social Media Style -->
            <div class="tab-content" id="community">
                <div class="tab-header">
                    <h2>Tax Community</h2>
                    <p>Share insights, ask questions, and connect with other taxpayers</p>
                </div>

                <div class="community-container">
                    <div class="post-form">
                        <textarea class="post-input" id="post-content" placeholder="Share your tax tip, question, or experience..."></textarea>
                        
                        <div class="image-upload-container">
                            <input type="file" id="post-image" accept="image/*" style="display: none;">
                            <div class="post-options">
                                <div class="post-option" id="upload-image-btn">
                                    <i class="fas fa-image"></i>
                                    <span>Photo</span>
                                </div>
                                <div class="post-option" id="add-link-btn">
                                    <i class="fas fa-link"></i>
                                    <span>Link</span>
                                </div>
                                <div class="post-option" id="add-tag-btn">
                                    <i class="fas fa-hashtag"></i>
                                    <span>Tag</span>
                                </div>
                            </div>
                            <img id="image-preview" class="image-preview">
                            <div id="upload-progress" class="upload-progress">
                                <div class="upload-progress-bar"></div>
                            </div>
                        </div>
                        
                        <div class="post-actions">
                            <div id="post-tags" class="post-tags">
                                <!-- Tags will be added here -->
                            </div>
                            <button class="btn" id="submit-post">Post</button>
                        </div>
                    </div>

                    <div class="feed" id="community-feed">
                        <!-- Community posts will be populated by JavaScript -->
                        <div class="post-card">
                            <div class="post-header">
                                <div class="post-avatar">TN</div>
                                <div class="post-user">
                                    <div class="post-name">TaxNaija Team</div>
                                    <div class="post-time">Just now</div>
                                </div>
                            </div>
                            <div class="post-content">
                                Welcome to the TaxNaija community! This is a space to share tax tips, ask questions, and connect with fellow taxpayers. Feel free to post about your tax experiences, questions about deductions, or anything tax-related!
                            </div>
                            <div class="post-tags">
                                <span class="post-tag">#welcome</span>
                                <span class="post-tag">#community</span>
                            </div>
                            <div class="post-footer">
                                <div class="post-actions-footer">
                                    <div class="post-action">
                                        <i class="fas fa-heart"></i>
                                        <span>0</span>
                                    </div>
                                    <div class="post-action">
                                        <i class="fas fa-comment"></i>
                                        <span>0</span>
                                    </div>
                                    <div class="post-action">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UPDATED: Resources Tab - Relevant Links -->
            <div class="tab-content" id="resources">
                <div class="tab-header">
                    <h2>Tax Resources</h2>
                    <p>Official tax resources, guides, and helpful links</p>
                </div>

                <div class="resources-grid">
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="resource-title">Personal Income Tax Guide</div>
                        <div class="resource-description">
                            Comprehensive guide to understanding and calculating personal income tax in Nigeria.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Individuals</span>
                            <span class="resource-tag">PIT</span>
                            <span class="resource-tag">FIRS</span>
                        </div>
                        <button class="btn" onclick="downloadResource('Personal Income Tax Guide', 'https://www.firs.gov.ng/Personal-Income-Tax')">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="resource-title">VAT Compliance Tutorial</div>
                        <div class="resource-description">
                            Step-by-step video tutorial on VAT registration, filing, and payment processes.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Business</span>
                            <span class="resource-tag">VAT</span>
                            <span class="resource-tag">Compliance</span>
                        </div>
                        <button class="btn" onclick="watchVideo('VAT Compliance Tutorial', 'https://www.youtube.com/watch?v=example')">
                            <i class="fas fa-play"></i> Watch
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="resource-title">2025 Tax Calendar</div>
                        <div class="resource-description">
                            Complete tax calendar with all important deadlines for individuals and businesses.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Calendar</span>
                            <span class="resource-tag">Deadlines</span>
                            <span class="resource-tag">2025</span>
                        </div>
                        <button class="btn" onclick="downloadResource('2025 Tax Calendar', 'https://www.firs.gov.ng/Tax-Calendar')">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div class="resource-title">Tax Laws & Regulations</div>
                        <div class="resource-description">
                            Updated compilation of Nigerian tax laws, regulations, and official guidelines.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Legal</span>
                            <span class="resource-tag">Regulations</span>
                            <span class="resource-tag">Compliance</span>
                        </div>
                        <button class="btn" onclick="openExternalLink('https://www.firs.gov.ng/Tax-Laws')">
                            <i class="fas fa-external-link-alt"></i> View Online
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="resource-title">Tax Calculators</div>
                        <div class="resource-description">
                            Various tax calculators for different tax types and scenarios.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Tools</span>
                            <span class="resource-tag">Calculators</span>
                            <span class="resource-tag">Planning</span>
                        </div>
                        <button class="btn" onclick="openExternalLink('https://www.firs.gov.ng/Tax-Tools')">
                            <i class="fas fa-external-link-alt"></i> Access Tools
                        </button>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="resource-title">FAQs & Support</div>
                        <div class="resource-description">
                            Frequently asked questions and official support channels for tax-related queries.
                        </div>
                        <div class="resource-tags">
                            <span class="resource-tag">Help</span>
                            <span class="resource-tag">Support</span>
                            <span class="resource-tag">FAQs</span>
                        </div>
                        <button class="btn" onclick="openExternalLink('https://www.firs.gov.ng/Support')">
                            <i class="fas fa-external-link-alt"></i> View FAQs
                        </button>
                    </div>
                </div>
            </div>

            <!-- UPDATED: Settings Tab - Simplified -->
            <div class="tab-content" id="settings">
                <div class="tab-header">
                    <h2>Settings</h2>
                    <p>Manage your account preferences and notification settings</p>
                </div>

                <div class="settings-container">
                    <!-- User Information Section -->
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="settings-title">User Information</div>
                        </div>
                        <div class="settings-form">
                            <div class="user-info-display">
                                <div class="user-info-label">Full Name</div>
                                <div class="user-info-value" id="display-user-name">Loading...</div>
                            </div>
                            <div class="user-info-display">
                                <div class="user-info-label">Email Address</div>
                                <div class="user-info-value" id="display-user-email">Loading...</div>
                            </div>
                            <div class="user-info-display">
                                <div class="user-info-label">Phone Number</div>
                                <div class="user-info-value" id="display-user-phone">Loading...</div>
                            </div>
                            <div class="user-info-display">
                                <div class="user-info-label">State of Residence</div>
                                <div class="user-info-value" id="display-user-state">Loading...</div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="settings-title">Notification Preferences</div>
                        </div>
                        <div class="settings-form">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Tax Deadline Reminders</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Get notified about upcoming tax deadlines</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="deadline-reminders" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Tax Law Updates</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Receive updates when tax laws change</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="tax-updates" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Community Interactions</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Get notified about comments and likes on your posts</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="community-notifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Email Notifications</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Receive notifications via email</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="email-notifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="settings-title">Appearance</div>
                        </div>
                        <div class="settings-form">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Dark Mode</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Switch between light and dark themes</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="dark-mode-toggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="input-group">
                                <label for="language-select">Language</label>
                                <select id="language-select" class="input-control">
                                    <option value="en">English</option>
                                    <option value="fr">French</option>
                                    <option value="yo">Yoruba</option>
                                    <option value="ig">Igbo</option>
                                    <option value="ha">Hausa</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="settings-title">Security</div>
                        </div>
                        <div class="settings-form">
                            <div class="input-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" class="input-control">
                            </div>
                            <div class="input-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" class="input-control">
                            </div>
                            <div class="input-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="input-control">
                            </div>
                            <button class="btn" style="align-self: flex-start;" id="update-password-btn">
                                <i class="fas fa-key"></i> Update Password
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="settings-title">Data & Storage</div>
                        </div>
                        <div class="settings-form">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Auto-save Calculations</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Automatically save tax calculations to history</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-save" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                                <div>
                                    <div style="font-weight: 500;">Sync Data</div>
                                    <div style="font-size: 0.9rem; color: var(--text-light);">Sync your data across devices</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="data-sync" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <button class="btn btn-outline" style="align-self: flex-start;" id="clear-data-btn">
                                <i class="fas fa-trash"></i> Clear Local Data
                            </button>
                        </div>
                    </div>

                    <!-- Logout Button -->
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <div class="settings-title">Account</div>
                        </div>
                        <div class="settings-form">
                            <button class="btn" style="background: var(--error); align-self: flex-start;" id="settings-logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation Bar for Mobile -->
    <div class="bottom-nav" id="bottom-nav">
        <div class="bottom-nav-items">
            <div class="bottom-nav-item active" data-tab="dashboard">
                <div class="bottom-nav-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="bottom-nav-label">Dashboard</div>
            </div>
            <div class="bottom-nav-item" data-tab="calculator">
                <div class="bottom-nav-icon">
                    <i class="fas fa-calculator"></i>
                </div>
                <div class="bottom-nav-label">Calculator</div>
            </div>
            <div class="bottom-nav-item" data-tab="community">
                <div class="bottom-nav-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="bottom-nav-label">Community</div>
            </div>
            <div class="bottom-nav-item" data-tab="resources">
                <div class="bottom-nav-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="bottom-nav-label">Resources</div>
            </div>
            <div class="bottom-nav-item" data-tab="settings">
                <div class="bottom-nav-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="bottom-nav-label">Settings</div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operation completed successfully</span>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA4yX9v8u-wjIPeBY64cc7YASVWIcak-eM",
            authDomain: "vault-602d2.firebaseapp.com",
            projectId: "vault-602d2",
            storageBucket: "vault-602d2.firebasestorage.app",
            messagingSenderId: "397379271243",
            appId: "1:397379271243:web:fab5914ccdca9d796d2bce",
            measurementId: "G-4R62KV83W2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Enhanced Nigerian tax calculation logic and data
        const nigerianTaxData = {
            individual: {
                taxBrackets: [
                    { min: 0, max: 300000, rate: 0.07 },
                    { min: 300001, max: 600000, rate: 0.11 },
                    { min: 600001, max: 1100000, rate: 0.15 },
                    { min: 1100001, max: 1600000, rate: 0.19 },
                    { min: 1600001, max: 3200000, rate: 0.21 },
                    { min: 3200001, max: Infinity, rate: 0.24 }
                ],
                consolidatedReliefAllowance: (income) => {
                    return Math.max(200000, (0.01 * income) + (0.2 * income));
                },
                standardDeductions: {
                    pension: 0.08,
                    nhf: 0.025,
                    lifeInsurance: 0.1,
                    dependentRelatives: 50000,
                    childrenEducation: 50000
                },
                income: [500000, 1000000, 2000000, 5000000, 10000000],
                allowances: [50000, 100000, 200000, 500000, 1000000]
            },
            business: {
                taxRates: {
                    small: 0.20,
                    medium: 0.25,
                    large: 0.30
                },
                turnoverThresholds: {
                    small: 25000000,
                    medium: 100000000
                },
                allowableDeductions: {
                    capitalAllowance: 0.1,
                    staffCosts: 1.0,
                    rent: 1.0,
                    utilities: 1.0,
                    professionalFees: 1.0
                },
                income: [1000000, 5000000, 10000000, 25000000, 50000000, 100000000],
                allowances: [100000, 500000, 1000000, 2500000, 5000000]
            },
            vat: {
                rate: 0.075,
                registrationThreshold: 25000000
            },
            states: {
                developmentLevy: 1000,
                businessPremises: {
                    rural: 10000,
                    urban: 20000,
                    metropolitan: 50000
                }
            }
        };

        // App state
        let appState = {
            currentUser: null,
            userProfile: {
                firstName: "",
                lastName: "",
                email: "",
                phone: "",
                state: "Lagos",
                userType: "individual",
                hasTin: false,
                dependents: 0,
                children: 0
            },
            settings: {
                notifications: true,
                taxUpdates: true,
                darkMode: false
            },
            taxHistory: [],
            communityPosts: []
        };

        // User data for calculator
        const userData = {
            userType: null,
            incomeType: null,
            incomeAmount: null,
            allowances: 0,
            state: "Lagos",
            hasTin: false,
            dependents: 0,
            children: 0,
            businessType: null,
            businessLocation: "urban"
        };

        // DOM elements
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const onboardingContainer = document.getElementById('onboarding-container');
        const tabContents = document.querySelectorAll('.tab-content');
        const calculatorContainer = document.getElementById('calculator-container');
        const resultsContainer = document.getElementById('results-container');
        const progressBar = document.getElementById('progress-bar');
        const steps = document.querySelectorAll('.calculator-step');
        const stepIndicators = document.querySelectorAll('.step-dot');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const userProfile = document.getElementById('user-profile');
        const userDropdown = document.getElementById('user-dropdown');
        const userAvatar = document.getElementById('user-avatar');
        const dashboardGreeting = document.getElementById('dashboard-greeting');
        const communityFeed = document.getElementById('community-feed');
        const bottomNav = document.getElementById('bottom-nav');
        const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
        const desktopNavItems = document.querySelectorAll('.nav-item');

        // Authentication DOM elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');
        const signinBtn = document.getElementById('signin-btn');
        const signupBtn = document.getElementById('signup-btn');
        const demoSigninBtn = document.getElementById('demo-signin-btn');
        const demoSignupBtn = document.getElementById('demo-signup-btn');
        const signoutBtn = document.getElementById('signout-btn');
        const settingsLogoutBtn = document.getElementById('settings-logout-btn');

        // Community DOM elements
        const postContent = document.getElementById('post-content');
        const postImage = document.getElementById('post-image');
        const imagePreview = document.getElementById('image-preview');
        const uploadImageBtn = document.getElementById('upload-image-btn');
        const addTagBtn = document.getElementById('add-tag-btn');
        const postTags = document.getElementById('post-tags');
        const submitPost = document.getElementById('submit-post');

        // Initialize the app
        function initApp() {
            setupEventListeners();
            setupAuthEventListeners();
            setupCommunityEventListeners();
            setupSettingsEventListeners();
            
            // Check if user has completed onboarding
            const hasCompletedOnboarding = localStorage.getItem('taxNaija_onboarding_completed');
            if (!hasCompletedOnboarding) {
                showOnboarding();
            }
            
            // Check authentication state
            auth.onAuthStateChanged(user => {
                if (user) {
                    appState.currentUser = user;
                    loadUserProfile(user.uid);
                    showApp();
                } else {
                    showAuth();
                }
            });
            
            // Check for dark mode preference
            const darkMode = localStorage.getItem('taxNaija_darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('dark-mode-toggle').checked = true;
            }
        }

        // Show onboarding
        function showOnboarding() {
            onboardingContainer.style.display = 'flex';
            setupOnboardingEventListeners();
        }

        // Setup onboarding event listeners
        function setupOnboardingEventListeners() {
            document.getElementById('next-onboarding-1').addEventListener('click', () => {
                document.getElementById('onboarding-step-1').classList.remove('active');
                document.getElementById('onboarding-step-2').classList.add('active');
            });
            
            document.getElementById('back-onboarding-2').addEventListener('click', () => {
                document.getElementById('onboarding-step-2').classList.remove('active');
                document.getElementById('onboarding-step-1').classList.add('active');
            });
            
            document.getElementById('next-onboarding-2').addEventListener('click', () => {
                document.getElementById('onboarding-step-2').classList.remove('active');
                document.getElementById('onboarding-step-3').classList.add('active');
            });
            
            document.getElementById('back-onboarding-3').addEventListener('click', () => {
                document.getElementById('onboarding-step-3').classList.remove('active');
                document.getElementById('onboarding-step-2').classList.add('active');
            });
            
            document.getElementById('complete-onboarding').addEventListener('click', () => {
                localStorage.setItem('taxNaija_onboarding_completed', 'true');
                onboardingContainer.style.display = 'none';
                showToast('Onboarding completed!', 'success');
            });
            
            document.getElementById('skip-onboarding').addEventListener('click', () => {
                localStorage.setItem('taxNaija_onboarding_completed', 'true');
                onboardingContainer.style.display = 'none';
            });
        }

        // Show authentication screen
        function showAuth() {
            authContainer.style.display = 'flex';
            appContainer.style.display = 'none';
            onboardingContainer.style.display = 'none';
        }

        // Show main app
        function showApp() {
            authContainer.style.display = 'none';
            appContainer.style.display = 'flex';
            onboardingContainer.style.display = 'none';
            updateDashboard();
            loadTaxHistory();
            loadCommunityPosts();
            updateUserUI();
        }

        // Load user profile from Firestore
        function loadUserProfile(userId) {
            db.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        appState.userProfile = { ...appState.userProfile, ...doc.data() };
                        updateUserUI();
                        updateSettingsUI();
                    } else {
                        const userData = {
                            firstName: appState.currentUser.displayName ? appState.currentUser.displayName.split(' ')[0] : 'User',
                            lastName: appState.currentUser.displayName ? appState.currentUser.displayName.split(' ')[1] || '' : '',
                            email: appState.currentUser.email,
                            phone: '',
                            state: 'Lagos',
                            userType: 'individual',
                            hasTin: false,
                            dependents: 0,
                            children: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        db.collection('users').doc(userId).set(userData)
                            .then(() => {
                                appState.userProfile = userData;
                                updateUserUI();
                                updateSettingsUI();
                            })
                            .catch(error => {
                                console.error('Error creating user profile:', error);
                                showToast('Error creating profile', 'error');
                            });
                    }
                })
                .catch(error => {
                    console.error('Error loading user profile:', error);
                    showToast('Error loading profile', 'error');
                });
        }

        // Update UI with user data
        function updateUserUI() {
            const firstName = appState.userProfile.firstName || 'User';
            const lastName = appState.userProfile.lastName || '';
            const fullName = `${firstName} ${lastName}`.trim();
            
            const initials = (firstName.charAt(0) + (lastName.charAt(0) || '')).toUpperCase();
            userAvatar.textContent = initials;
            
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'Good evening';
            
            if (hour < 12) greeting = 'Good morning';
            else if (hour < 18) greeting = 'Good afternoon';
            
            dashboardGreeting.textContent = `${greeting}, ${firstName}! Here's your tax overview.`;
        }

        // Update settings UI with user data
        function updateSettingsUI() {
            const firstName = appState.userProfile.firstName || '';
            const lastName = appState.userProfile.lastName || '';
            const fullName = `${firstName} ${lastName}`.trim();
            
            document.getElementById('display-user-name').textContent = fullName || 'Not provided';
            document.getElementById('display-user-email').textContent = appState.userProfile.email || 'Not provided';
            document.getElementById('display-user-phone').textContent = appState.userProfile.phone || 'Not provided';
            document.getElementById('display-user-state').textContent = appState.userProfile.state || 'Not provided';
        }

        // Setup authentication event listeners
        function setupAuthEventListeners() {
            authTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    authTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    authForms.forEach(form => form.classList.remove('active'));
                    document.getElementById(`${tabName}-form`).classList.add('active');
                });
            });
            
            signinForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('signin-email').value;
                const password = document.getElementById('signin-password').value;
                
                signinBtn.querySelector('span').style.display = 'none';
                signinBtn.querySelector('.loading').style.display = 'inline-block';
                signinBtn.disabled = true;
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        showToast('Successfully signed in!', 'success');
                    })
                    .catch((error) => {
                        showToast(`Sign in failed: ${error.message}`, 'error');
                    })
                    .finally(() => {
                        signinBtn.querySelector('span').style.display = 'inline-block';
                        signinBtn.querySelector('.loading').style.display = 'none';
                        signinBtn.disabled = false;
                    });
            });
            
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const phone = document.getElementById('signup-phone').value;
                const state = document.getElementById('signup-state').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                signupBtn.querySelector('span').style.display = 'none';
                signupBtn.querySelector('.loading').style.display = 'inline-block';
                signupBtn.disabled = true;
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        return user.updateProfile({
                            displayName: name
                        }).then(() => {
                            return db.collection('users').doc(user.uid).set({
                                firstName: name.split(' ')[0],
                                lastName: name.split(' ').slice(1).join(' '),
                                email: email,
                                phone: phone,
                                state: state,
                                userType: 'individual',
                                hasTin: false,
                                dependents: 0,
                                children: 0,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                    })
                    .then(() => {
                        showToast('Account created successfully!', 'success');
                    })
                    .catch((error) => {
                        showToast(`Sign up failed: ${error.message}`, 'error');
                    })
                    .finally(() => {
                        signupBtn.querySelector('span').style.display = 'inline-block';
                        signupBtn.querySelector('.loading').style.display = 'none';
                        signupBtn.disabled = false;
                    });
            });
            
            demoSigninBtn.addEventListener('click', () => {
                auth.signInWithEmailAndPassword('demo@taxnaija.com', 'demopassword123')
                    .then((userCredential) => {
                        showToast('Welcome to TaxNaija Demo!', 'success');
                    })
                    .catch((error) => {
                        showToast('Demo account not available. Please create your own account.', 'error');
                    });
            });
            
            demoSignupBtn.addEventListener('click', () => {
                auth.createUserWithEmailAndPassword('demo@taxnaija.com', 'demopassword123')
                    .then((userCredential) => {
                        const user = userCredential.user;
                        return user.updateProfile({
                            displayName: 'Demo User'
                        }).then(() => {
                            return db.collection('users').doc(user.uid).set({
                                firstName: 'Demo',
                                lastName: 'User',
                                email: 'demo@taxnaija.com',
                                phone: '+2348000000000',
                                state: 'Lagos',
                                userType: 'individual',
                                hasTin: false,
                                dependents: 0,
                                children: 0,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                    })
                    .then(() => {
                        showToast('Demo account created!', 'success');
                    })
                    .catch((error) => {
                        if (error.code === 'auth/email-already-in-use') {
                            auth.signInWithEmailAndPassword('demo@taxnaija.com', 'demopassword123')
                                .then((userCredential) => {
                                    showToast('Welcome to TaxNaija Demo!', 'success');
                                });
                        } else {
                            showToast('Error creating demo account', 'error');
                        }
                    });
            });
            
            const signOutUser = () => {
                auth.signOut()
                    .then(() => {
                        showToast('Successfully signed out', 'success');
                    })
                    .catch((error) => {
                        showToast('Error signing out', 'error');
                    });
            };
            
            signoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signOutUser();
            });
            
            settingsLogoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signOutUser();
            });
            
            userProfile.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('show');
            });
            
            document.addEventListener('click', () => {
                userDropdown.classList.remove('show');
            });
        }

        // Setup community event listeners
        function setupCommunityEventListeners() {
            uploadImageBtn.addEventListener('click', () => {
                postImage.click();
            });
            
            postImage.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagePreview.src = event.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            addTagBtn.addEventListener('click', () => {
                const tag = prompt('Enter a tag (e.g., #taxhelp):');
                if (tag && tag.trim()) {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'post-tag';
                    tagElement.textContent = tag.trim();
                    postTags.appendChild(tagElement);
                }
            });
            
            submitPost.addEventListener('click', () => {
                const content = postContent.value.trim();
                if (!content) {
                    showToast('Please enter post content', 'error');
                    return;
                }
                
                submitPost.disabled = true;
                submitPost.innerHTML = '<div class="loading"></div> Posting...';
                
                const postData = {
                    content: content,
                    userId: appState.currentUser.uid,
                    userName: `${appState.userProfile.firstName} ${appState.userProfile.lastName}`.trim() || 'User',
                    userInitials: (appState.userProfile.firstName ? appState.userProfile.firstName.charAt(0) : 'U') + 
                                (appState.userProfile.lastName ? appState.userProfile.lastName.charAt(0) : ''),
                    tags: Array.from(postTags.querySelectorAll('.post-tag')).map(tag => tag.textContent),
                    likes: 0,
                    comments: 0,
                    likedBy: [],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (postImage.files[0]) {
                    const file = postImage.files[0];
                    const storageRef = storage.ref(`community-posts/${Date.now()}-${file.name}`);
                    const uploadTask = storageRef.put(file);
                    
                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            document.querySelector('.upload-progress-bar').style.width = progress + '%';
                        },
                        (error) => {
                            console.error('Error uploading image:', error);
                            showToast('Error uploading image', 'error');
                            submitPost.disabled = false;
                            submitPost.innerHTML = '<i class="fas fa-paper-plane"></i> Post';
                        },
                        () => {
                            uploadTask.snapshot.ref.getDownloadURL()
                                .then((downloadURL) => {
                                    postData.imageUrl = downloadURL;
                                    return db.collection('community-posts').add(postData);
                                })
                                .then(() => {
                                    resetPostForm();
                                    showToast('Post published successfully!', 'success');
                                    loadCommunityPosts();
                                })
                                .catch(error => {
                                    console.error('Error saving post:', error);
                                    showToast('Error publishing post', 'error');
                                })
                                .finally(() => {
                                    submitPost.disabled = false;
                                    submitPost.innerHTML = '<i class="fas fa-paper-plane"></i> Post';
                                });
                        }
                    );
                } else {
                    db.collection('community-posts').add(postData)
                        .then(() => {
                            resetPostForm();
                            showToast('Post published successfully!', 'success');
                            loadCommunityPosts();
                        })
                        .catch(error => {
                            console.error('Error saving post:', error);
                            showToast('Error publishing post', 'error');
                        })
                        .finally(() => {
                            submitPost.disabled = false;
                            submitPost.innerHTML = '<i class="fas fa-paper-plane"></i> Post';
                        });
                }
            });
        }

        // Setup settings event listeners
        function setupSettingsEventListeners() {
            document.getElementById('update-password-btn').addEventListener('click', () => {
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (newPassword !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                appState.currentUser.updatePassword(newPassword)
                    .then(() => {
                        document.getElementById('current-password').value = '';
                        document.getElementById('new-password').value = '';
                        document.getElementById('confirm-password').value = '';
                        
                        showToast('Password updated successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error updating password:', error);
                        showToast('Error updating password', 'error');
                    });
            });
            
            document.getElementById('clear-data-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all local data? This action cannot be undone.')) {
                    localStorage.clear();
                    appState.taxHistory = [];
                    appState.communityPosts = [];
                    
                    updateDashboard();
                    loadTaxHistory();
                    loadCommunityPosts();
                    
                    showToast('Local data cleared successfully', 'success');
                }
            });
            
            document.getElementById('dark-mode-toggle').addEventListener('change', function() {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('taxNaija_darkMode', this.checked);
            });
        }

        // Reset post form
        function resetPostForm() {
            postContent.value = '';
            postImage.value = '';
            imagePreview.style.display = 'none';
            postTags.innerHTML = '';
        }

        // Load community posts from Firebase
        function loadCommunityPosts() {
            if (!appState.currentUser) return;
            
            db.collection('community-posts')
                .orderBy('createdAt', 'desc')
                .limit(20)
                .get()
                .then(querySnapshot => {
                    communityFeed.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        communityFeed.innerHTML = `
                            <div style="text-align: center; padding: 3rem; color: var(--text-light);">
                                <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                <h3>No posts yet</h3>
                                <p>Be the first to share a tax tip or question!</p>
                            </div>
                        `;
                        return;
                    }
                    
                    querySnapshot.forEach(doc => {
                        const post = doc.data();
                        const postId = doc.id;
                        const postElement = createPostElement(post, postId);
                        communityFeed.appendChild(postElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading posts:', error);
                    showToast('Error loading community posts', 'error');
                });
        }

        // Create post element
        function createPostElement(post, postId) {
            const postElement = document.createElement('div');
            postElement.className = 'post-card';
            postElement.id = `post-${postId}`;
            
            const postDate = post.createdAt ? post.createdAt.toDate() : new Date();
            const timeAgo = getTimeAgo(postDate);
            
            const isLiked = post.likedBy && post.likedBy.includes(appState.currentUser.uid);
            
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar">${post.userInitials || 'U'}</div>
                    <div class="post-user">
                        <div class="post-name">${post.userName || 'User'}</div>
                        <div class="post-time">${timeAgo}</div>
                    </div>
                </div>
                <div class="post-content">
                    ${formatPostContent(post.content)}
                </div>
                ${post.imageUrl ? `<img src="${post.imageUrl}" class="post-image" alt="Post image">` : ''}
                ${post.tags && post.tags.length > 0 ? `
                <div class="post-tags">
                    ${post.tags.map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                </div>
                ` : ''}
                <div class="post-footer">
                    <div class="post-actions-footer">
                        <div class="post-action ${isLiked ? 'liked' : ''}" data-post-id="${postId}" data-action="like">
                            <i class="fas fa-heart"></i>
                            <span>${post.likes || 0}</span>
                        </div>
                        <div class="post-action" data-post-id="${postId}" data-action="comment">
                            <i class="fas fa-comment"></i>
                            <span>${post.comments || 0}</span>
                        </div>
                        <div class="post-action" data-post-id="${postId}" data-action="share">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </div>
                    </div>
                </div>
            `;
            
            const likeBtn = postElement.querySelector('.post-action[data-action="like"]');
            likeBtn.addEventListener('click', () => {
                handlePostLike(postId, post, likeBtn);
            });
            
            return postElement;
        }

        // Format post content
        function formatPostContent(content) {
            return content.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
        }

        // Handle post like
        function handlePostLike(postId, post, likeBtn) {
            const isLiked = post.likedBy && post.likedBy.includes(appState.currentUser.uid);
            const newLikedBy = isLiked 
                ? post.likedBy.filter(id => id !== appState.currentUser.uid)
                : [...(post.likedBy || []), appState.currentUser.uid];
            
            const newLikes = newLikedBy.length;
            
            db.collection('community-posts').doc(postId).update({
                likes: newLikes,
                likedBy: newLikedBy
            })
            .then(() => {
                likeBtn.classList.toggle('liked', !isLiked);
                likeBtn.querySelector('span').textContent = newLikes;
                
                showToast(isLiked ? 'Post unliked' : 'Post liked!', 'success');
            })
            .catch(error => {
                console.error('Error updating like:', error);
                showToast('Error updating like', 'error');
            });
        }

        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffSecs < 60) {
                return 'Just now';
            } else if (diffMins < 60) {
                return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
            } else if (diffHours < 24) {
                return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            } else if (diffDays < 7) {
                return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else {
                return date.toLocaleDateString();
            }
        }

        // Update dashboard with user data
        function updateDashboard() {
            const totalTax = appState.taxHistory.reduce((sum, record) => sum + record.taxAmount, 0);
            document.getElementById('total-tax-paid').textContent = formatCurrency(totalTax);
            
            document.getElementById('calculations-count').textContent = appState.taxHistory.length;
            
            const estimatedSavings = appState.taxHistory.reduce((sum, record) => {
                return sum + (record.allowances || 0) * 0.2;
            }, 0);
            document.getElementById('estimated-savings').textContent = formatCurrency(estimatedSavings);
            
            // Update recent calculations list
            const recentCalculationsList = document.getElementById('recent-calculations-list');
            recentCalculationsList.innerHTML = '';
            
            const recentCalculations = appState.taxHistory.slice(-3).reverse();
            
            if (recentCalculations.length === 0) {
                recentCalculationsList.innerHTML = `
                    <li class="deadline-item">
                        <div class="deadline-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="deadline-info">
                            <div class="deadline-title">No calculations yet</div>
                            <div class="deadline-date">Use the tax calculator to get started</div>
                        </div>
                    </li>
                `;
            } else {
                recentCalculations.forEach(calc => {
                    const calculationItem = document.createElement('li');
                    calculationItem.className = 'deadline-item';
                    
                    calculationItem.innerHTML = `
                        <div class="deadline-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="deadline-info">
                            <div class="deadline-title">${calc.userType === 'individual' ? 'Personal' : 'Business'} Tax Calculated</div>
                            <div class="deadline-date">${formatDate(calc.date)} - ${formatCurrency(calc.taxAmount)}</div>
                        </div>
                        <div class="deadline-status status-upcoming">Calculated</div>
                    `;
                    
                    recentCalculationsList.appendChild(calculationItem);
                });
            }
            
            // Update activity list
            const activityList = document.getElementById('activity-list');
            activityList.innerHTML = '';
            
            if (appState.taxHistory.length === 0) {
                activityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Welcome to TaxNaija</div>
                            <div class="activity-time">Just now - Start by using the tax calculator</div>
                        </div>
                    </li>
                `;
            } else {
                const recentActivities = appState.taxHistory.slice(-3).reverse();
                
                recentActivities.forEach(calc => {
                    const activityItem = document.createElement('li');
                    activityItem.className = 'activity-item';
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">${calc.userType === 'individual' ? 'Personal' : 'Business'} Tax Calculated</div>
                            <div class="activity-time">${formatDate(calc.date)} - ${formatCurrency(calc.taxAmount)}</div>
                        </div>
                    `;
                    
                    activityList.appendChild(activityItem);
                });
            }
        }

        // Load and display tax history
        function loadTaxHistory() {
            const historyTableBody = document.getElementById('history-table-body');
            
            if (appState.taxHistory.length === 0) {
                historyTableBody.innerHTML = `
                    <div class="table-row">
                        <div colspan="5" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-history" style="font-size: 2rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                            <p>No tax history yet. Start by using the tax calculator!</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const typeFilter = document.getElementById('history-type-filter').value;
            const statusFilter = document.getElementById('history-status-filter').value;
            const dateFilter = document.getElementById('history-date-filter').value;
            
            const filteredHistory = appState.taxHistory.filter(record => {
                const typeMatch = typeFilter === 'all' || record.userType === typeFilter;
                const statusMatch = statusFilter === 'all' || record.status === statusFilter;
                
                const recordDate = new Date(record.date);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - parseInt(dateFilter));
                
                const dateMatch = recordDate >= cutoffDate;
                
                return typeMatch && statusMatch && dateMatch;
            });
            
            historyTableBody.innerHTML = '';
            
            filteredHistory.forEach(record => {
                const tableRow = document.createElement('div');
                tableRow.className = 'table-row';
                
                const statusClass = `status-${record.status}`;
                
                tableRow.innerHTML = `
                    <div>${formatDate(record.date)}</div>
                    <div>${record.userType === 'individual' ? 'Personal Income Tax' : 'Company Income Tax'}</div>
                    <div>${formatCurrency(record.taxAmount)}</div>
                    <div><span class="status-badge ${statusClass}">${record.status}</span></div>
                    <div>
                        <button class="btn btn-outline" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="viewCalculation('${record.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                `;
                
                historyTableBody.appendChild(tableRow);
            });
        }

        // Save tax calculation to local storage
        function saveTaxCalculation(calculation) {
            const calculationRecord = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                userType: userData.userType,
                incomeAmount: userData.incomeAmount,
                allowances: userData.allowances,
                taxAmount: calculation.tax,
                taxableIncome: calculation.taxableIncome,
                taxRate: calculation.taxRate,
                status: 'pending'
            };
            
            appState.taxHistory.unshift(calculationRecord);
            
            // Save to localStorage
            localStorage.setItem('taxNaija_taxHistory', JSON.stringify(appState.taxHistory));
            
            updateDashboard();
            
            showToast('Tax calculation saved to history', 'success');
        }

        // View a specific calculation
        function viewCalculation(calculationId) {
            const calculation = appState.taxHistory.find(record => record.id === calculationId);
            
            if (!calculation) return;
            
            alert(`Calculation Details:\n\nDate: ${formatDate(calculation.date)}\nType: ${calculation.userType === 'individual' ? 'Personal Income Tax' : 'Company Income Tax'}\nIncome: ${formatCurrency(calculation.incomeAmount)}\nTax: ${formatCurrency(calculation.taxAmount)}`);
        }

        // Format currency for Nigerian Naira
        function formatCurrency(amount) {
            if (isNaN(amount)) return 'â‚¦0';
            return 'â‚¦' + amount.toLocaleString('en-NG');
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-NG', options);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            
            toast.className = 'toast';
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'success') {
                toast.classList.add('success');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Load tax history from localStorage
            const savedHistory = localStorage.getItem('taxNaija_taxHistory');
            if (savedHistory) {
                appState.taxHistory = JSON.parse(savedHistory);
            }

            // Desktop tab navigation
            desktopNavItems.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const tabId = this.getAttribute('data-tab');
                    
                    desktopNavItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    tabContents.forEach(tab => tab.classList.remove('active'));
                    
                    document.getElementById(tabId).classList.add('active');
                    
                    if (tabId === 'history') {
                        loadTaxHistory();
                    } else if (tabId === 'dashboard') {
                        updateDashboard();
                    } else if (tabId === 'community') {
                        loadCommunityPosts();
                    }
                });
            });

            // Bottom navigation
            bottomNavItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    bottomNavItems.forEach(nav => nav.classList.remove('active'));
                    desktopNavItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
                    
                    tabContents.forEach(tab => tab.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    if (tabId === 'history') {
                        loadTaxHistory();
                    } else if (tabId === 'dashboard') {
                        updateDashboard();
                    } else if (tabId === 'community') {
                        loadCommunityPosts();
                    }
                });
            });

            // History filters
            document.getElementById('history-type-filter').addEventListener('change', loadTaxHistory);
            document.getElementById('history-status-filter').addEventListener('change', loadTaxHistory);
            document.getElementById('history-date-filter').addEventListener('change', loadTaxHistory);

            // User dropdown navigation
            document.querySelectorAll('.user-dropdown .dropdown-item[data-tab]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    bottomNavItems.forEach(nav => nav.classList.remove('active'));
                    desktopNavItems.forEach(nav => nav.classList.remove('active'));
                    document.querySelector(`.bottom-nav-item[data-tab="${tabId}"]`).classList.add('active');
                    document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
                    
                    userDropdown.classList.remove('show');
                });
            });

            // Calculator event listeners
            setupCalculatorEventListeners();
        }

        // Setup calculator-specific event listeners
        function setupCalculatorEventListeners() {
            // Step 1: User Type Selection
            document.querySelectorAll('#step-1 .option-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('#step-1 .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    userData.userType = this.getAttribute('data-value');
                    
                    document.getElementById('step-1-next').disabled = false;
                });
            });

            // Step 1 Next Button
            document.getElementById('step-1-next').addEventListener('click', function() {
                const incomeTypeOptions = document.getElementById('income-type-options');
                incomeTypeOptions.innerHTML = '';
                
                if (userData.userType === 'individual') {
                    const individualOptions = [
                        { value: 'salary', icon: 'fa-money-bill', title: 'Salary Earner', description: 'I work for a company and receive a salary' },
                        { value: 'business', icon: 'fa-store', title: 'Business Owner', description: 'I run my own business' },
                        { value: 'rental', icon: 'fa-home', title: 'Rental Income', description: 'I earn from renting out property' },
                        { value: 'investment', icon: 'fa-chart-line', title: 'Investment Income', description: 'I earn from investments' }
                    ];
                    
                    individualOptions.forEach(option => {
                        const card = document.createElement('div');
                        card.className = 'option-card';
                        card.setAttribute('data-value', option.value);
                        card.innerHTML = `
                            <div class="option-icon">
                                <i class="fas ${option.icon}"></i>
                            </div>
                            <div class="option-title">${option.title}</div>
                            <div class="option-description">${option.description}</div>
                        `;
                        incomeTypeOptions.appendChild(card);
                    });
                } else {
                    const businessOptions = [
                        { value: 'small', icon: 'fa-store', title: 'Small Business', description: 'Turnover less than â‚¦25 million' },
                        { value: 'medium', icon: 'fa-building', title: 'Medium Business', description: 'Turnover â‚¦25M - â‚¦100M' },
                        { value: 'large', icon: 'fa-industry', title: 'Large Business', description: 'Turnover more than â‚¦100M' }
                    ];
                    
                    businessOptions.forEach(option => {
                        const card = document.createElement('div');
                        card.className = 'option-card';
                        card.setAttribute('data-value', option.value);
                        card.innerHTML = `
                            <div class="option-icon">
                                <i class="fas ${option.icon}"></i>
                            </div>
                            <div class="option-title">${option.title}</div>
                            <div class="option-description">${option.description}</div>
                        `;
                        incomeTypeOptions.appendChild(card);
                    });
                }
                
                document.querySelectorAll('#income-type-options .option-card').forEach(card => {
                    card.addEventListener('click', function() {
                        document.querySelectorAll('#income-type-options .option-card').forEach(c => {
                            c.classList.remove('selected');
                        });
                        
                        this.classList.add('selected');
                        userData.incomeType = this.getAttribute('data-value');
                        
                        document.getElementById('step-2-next').disabled = false;
                    });
                });
                
                goToStep(2);
            });

            // Step 2 Next Button
            document.getElementById('step-2-next').addEventListener('click', function() {
                const step3Title = document.getElementById('step-3-title');
                const step3Description = document.getElementById('step-3-description');
                const incomeLabel = document.getElementById('income-label');
                const incomeHint = document.getElementById('income-hint');
                
                if (userData.userType === 'individual') {
                    step3Title.textContent = "What Is Your Annual Income?";
                    step3Description.textContent = "Enter your total income for the year";
                    incomeLabel.textContent = "Annual Income (â‚¦)";
                    incomeHint.textContent = "This helps us calculate your tax accurately";
                    
                    createAmountOptions(
                        'income-amount-options', 
                        nigerianTaxData.individual.income, 
                        userData.incomeAmount,
                        (amount) => {
                            userData.incomeAmount = amount;
                            document.getElementById('income-amount').value = amount;
                            updateAmountInWords(amount, 'income-amount-words');
                            document.getElementById('step-3-next').disabled = false;
                        }
                    );
                } else {
                    step3Title.textContent = "What Is Your Annual Turnover?";
                    step3Description.textContent = "Enter your business's total turnover for the year";
                    incomeLabel.textContent = "Annual Turnover (â‚¦)";
                    incomeHint.textContent = "Your turnover is the total amount of money your business makes";
                    
                    createAmountOptions(
                        'income-amount-options', 
                        nigerianTaxData.business.income, 
                        userData.incomeAmount,
                        (amount) => {
                            userData.incomeAmount = amount;
                            document.getElementById('income-amount').value = amount;
                            updateAmountInWords(amount, 'income-amount-words');
                            document.getElementById('step-3-next').disabled = false;
                        }
                    );
                }
                
                goToStep(3);
            });

            // Step 2 Back Button
            document.getElementById('step-2-back').addEventListener('click', function() {
                goToStep(1);
            });

            // Step 3: Income Amount Input
            document.getElementById('income-amount').addEventListener('input', function() {
                const value = parseFloat(this.value) || 0;
                userData.incomeAmount = value;
                
                updateAmountInWords(value, 'income-amount-words');
                
                document.querySelectorAll('#income-amount-options .amount-option').forEach(option => {
                    const optionAmount = parseInt(option.textContent.replace('â‚¦', '').replace(/,/g, ''));
                    if (optionAmount === value) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
                
                document.getElementById('step-3-next').disabled = value <= 0;
            });

            // Step 3 Next Button
            document.getElementById('step-3-next').addEventListener('click', function() {
                const step4Title = document.getElementById('step-4-title');
                const step4Description = document.getElementById('step-4-description');
                const allowancesLabel = document.getElementById('allowances-label');
                const allowancesHint = document.getElementById('allowances-hint');
                
                if (userData.userType === 'individual') {
                    step4Title.textContent = "Any Allowances or Deductions?";
                    step4Description.textContent = "These can reduce the amount of tax you pay";
                    allowancesLabel.textContent = "Annual Allowances & Deductions (â‚¦)";
                    allowancesHint.textContent = "Examples: Pension contributions, NHF, dependents";
                    
                    createAmountOptions(
                        'allowances-amount-options', 
                        nigerianTaxData.individual.allowances, 
                        userData.allowances,
                        (amount) => {
                            userData.allowances = amount;
                            document.getElementById('allowances').value = amount;
                            updateAmountInWords(amount, 'allowances-amount-words');
                        }
                    );
                } else {
                    step4Title.textContent = "Any Business Expenses or Deductions?";
                    step4Description.textContent = "These can reduce the amount of tax your business pays";
                    allowancesLabel.textContent = "Annual Business Expenses (â‚¦)";
                    allowancesHint.textContent = "Examples: Employee salaries, rent, equipment costs";
                    
                    createAmountOptions(
                        'allowances-amount-options', 
                        nigerianTaxData.business.allowances, 
                        userData.allowances,
                        (amount) => {
                            userData.allowances = amount;
                            document.getElementById('allowances').value = amount;
                            updateAmountInWords(amount, 'allowances-amount-words');
                        }
                    );
                }
                
                goToStep(4);
            });

            // Step 3 Back Button
            document.getElementById('step-3-back').addEventListener('click', function() {
                goToStep(2);
            });

            // Step 4: Allowances Input
            document.getElementById('allowances').addEventListener('input', function() {
                const value = parseFloat(this.value) || 0;
                userData.allowances = value;
                
                updateAmountInWords(value, 'allowances-amount-words');
                
                document.querySelectorAll('#allowances-amount-options .amount-option').forEach(option => {
                    const optionAmount = parseInt(option.textContent.replace('â‚¦', '').replace(/,/g, ''));
                    if (optionAmount === value) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
            });

            // Step 4 Next Button
            document.getElementById('step-4-next').addEventListener('click', function() {
                goToStep(5);
                
                setTimeout(function() {
                    const calculation = calculateTax();
                    displayResults(calculation);
                    saveTaxCalculation(calculation);
                    
                    calculatorContainer.style.display = 'none';
                    resultsContainer.style.display = 'block';
                }, 2000);
            });

            // Step 4 Back Button
            document.getElementById('step-4-back').addEventListener('click', function() {
                goToStep(3);
            });

            // Step 5 Back Button
            document.getElementById('step-5-back').addEventListener('click', function() {
                goToStep(4);
            });

            // Restart Button
            document.getElementById('restart-btn').addEventListener('click', function() {
                userData.userType = null;
                userData.incomeType = null;
                userData.incomeAmount = null;
                userData.allowances = 0;
                
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.getElementById('income-amount').value = '';
                document.getElementById('allowances').value = '';
                document.getElementById('step-1-next').disabled = true;
                document.getElementById('step-2-next').disabled = true;
                document.getElementById('step-3-next').disabled = true;
                
                updateAmountInWords(0, 'income-amount-words');
                updateAmountInWords(0, 'allowances-amount-words');
                
                calculatorContainer.style.display = 'block';
                resultsContainer.style.display = 'none';
                
                goToStep(1);
            });

            // Save Result Button
            document.getElementById('save-result').addEventListener('click', function() {
                showToast('Calculation saved to your history', 'success');
            });

            // Payment Button
            document.getElementById('payment-btn').addEventListener('click', function() {
                showToast('Redirecting to payment gateway...', 'success');
            });
        }

        // Calculator helper functions
        function goToStep(stepNumber) {
            steps.forEach(step => step.classList.remove('active'));
            stepIndicators.forEach(indicator => indicator.classList.remove('active'));
            
            document.getElementById(`step-${stepNumber}`).classList.add('active');
            stepIndicators[stepNumber - 1].classList.add('active');
            
            const progressPercentage = ((stepNumber - 1) / (steps.length - 1)) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        // Number to words conversion function
        function numberToWords(num) {
            if (num === 0) return "Zero Naira";
            
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const scales = ['', 'Thousand', 'Million', 'Billion', 'Trillion'];
            
            if (num < 0) {
                return 'Negative ' + numberToWords(Math.abs(num));
            }
            
            let words = '';
            
            const numStr = num.toFixed(2);
            const parts = numStr.split('.');
            const integerPart = parseInt(parts[0]);
            const decimalPart = parts[1] ? parseInt(parts[1]) : 0;
            
            if (integerPart === 0) {
                words = 'Zero';
            } else {
                let count = 0;
                let n = integerPart;
                
                while (n > 0) {
                    if (n % 1000 !== 0) {
                        let chunk = '';
                        const x = n % 1000;
                        
                        if (x < 20) {
                            chunk = ones[x];
                        } else if (x < 100) {
                            chunk = tens[Math.floor(x / 10)] + (x % 10 !== 0 ? '-' + ones[x % 10] : '');
                        } else {
                            chunk = ones[Math.floor(x / 100)] + ' Hundred ' + (x % 100 !== 0 ? 'and ' + numberToWords(x % 100) : '');
                        }
                        
                        words = chunk + (scales[count] ? ' ' + scales[count] + ' ' : '') + words;
                    }
                    n = Math.floor(n / 1000);
                    count++;
                }
                
                words = words.replace(/\s+/g, ' ').trim();
            }
            
            let result = words + ' Naira';
            
            if (decimalPart > 0) {
                let koboWords = '';
                if (decimalPart < 20) {
                    koboWords = ones[decimalPart];
                } else {
                    koboWords = tens[Math.floor(decimalPart / 10)] + (decimalPart % 10 !== 0 ? '-' + ones[decimalPart % 10] : '');
                }
                result += ' and ' + koboWords + ' Kobo';
            }
            
            return result;
        }

        // Function to create amount options
        function createAmountOptions(containerId, options, currentValue, onSelect) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            options.forEach(amount => {
                const option = document.createElement('div');
                option.className = 'amount-option';
                if (currentValue === amount) {
                    option.classList.add('selected');
                }
                option.textContent = formatCurrency(amount);
                option.addEventListener('click', () => {
                    onSelect(amount);
                    
                    document.querySelectorAll(`#${containerId} .amount-option`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    option.classList.add('selected');
                });
                container.appendChild(option);
            });
        }

        // Function to update amount in words display
        function updateAmountInWords(amount, wordsContainerId) {
            const wordsContainer = document.getElementById(wordsContainerId);
            if (amount && amount > 0) {
                wordsContainer.textContent = numberToWords(amount);
            } else {
                wordsContainer.textContent = 'Amount in words will appear here';
            }
        }

        // Enhanced Tax Calculation Function
        function calculateTax() {
            let taxableIncome = userData.incomeAmount - userData.allowances;
            let tax = 0;
            let taxRate = 0;
            let tip = '';
            let additionalTaxes = [];
            
            if (userData.userType === 'individual') {
                const cra = nigerianTaxData.individual.consolidatedReliefAllowance(userData.incomeAmount);
                taxableIncome = Math.max(0, userData.incomeAmount - userData.allowances - cra);
                
                let remainingIncome = taxableIncome;
                
                for (const bracket of nigerianTaxData.individual.taxBrackets) {
                    if (remainingIncome <= 0) break;
                    
                    const bracketAmount = Math.min(
                        remainingIncome,
                        bracket.max === Infinity ? remainingIncome : bracket.max - bracket.min + 1
                    );
                    
                    tax += bracketAmount * bracket.rate;
                    remainingIncome -= bracketAmount;
                }
                
                additionalTaxes.push({
                    name: "State Development Levy",
                    amount: nigerianTaxData.states.developmentLevy
                });
                tax += nigerianTaxData.states.developmentLevy;
                
                taxRate = userData.incomeAmount > 0 ? tax / userData.incomeAmount : 0;
                
                switch(userData.incomeType) {
                    case 'salary':
                        tip = "Consider maximizing your pension contributions (up to 25% of annual income) and National Housing Fund contributions to reduce your taxable income. Also ensure you're claiming all eligible allowances including transport, housing, and utility allowances.";
                        break;
                    case 'business':
                        tip = "Ensure you're claiming all legitimate business expenses and consider timing major equipment purchases to maximize deductions. Explore available tax incentives for small businesses including the lower tax rate for companies with turnover below â‚¦25 million.";
                        break;
                    case 'rental':
                        tip = "Maximize deductions for property maintenance, insurance, management fees, and repairs. Consider restructuring property ownership for optimal tax efficiency and explore opportunities for capital allowances on qualifying improvements.";
                        break;
                    case 'investment':
                        tip = "Review your investment portfolio for tax-efficient instruments including government securities and explore timing of capital gains realization to optimize your tax position. Consider tax-exempt investment options where available.";
                        break;
                }
            } else {
                let companyType = 'large';
                
                if (userData.incomeAmount < nigerianTaxData.business.turnoverThresholds.small) {
                    companyType = 'small';
                } else if (userData.incomeAmount <= nigerianTaxData.business.turnoverThresholds.medium) {
                    companyType = 'medium';
                }
                
                taxRate = nigerianTaxData.business.taxRates[companyType];
                tax = taxableIncome * taxRate;
                
                const premisesLevy = nigerianTaxData.states.businessPremises[userData.businessLocation || 'urban'];
                additionalTaxes.push({
                    name: "Business Premises Levy",
                    amount: premisesLevy
                });
                tax += premisesLevy;
                
                const educationTax = taxableIncome * 0.02;
                additionalTaxes.push({
                    name: "Education Tax",
                    amount: educationTax
                });
                tax += educationTax;
                
                switch(companyType) {
                    case 'small':
                        tip = "Small businesses with turnover below â‚¦25 million enjoy reduced tax rates and simplified compliance requirements. Consider timing equipment purchases to maximize deductions and explore available tax credits for job creation and training programs.";
                        break;
                    case 'medium':
                        tip = "Medium-sized businesses can benefit from various incentives including investment allowances and industry-specific tax credits. Explore available export incentives and consider structuring investments to qualify for pioneer status where applicable.";
                        break;
                    case 'large':
                        tip = "Large companies should explore sector-specific incentives, transfer pricing optimization, and strategic timing of major expenses to optimize tax liability. Consider available tax treaties for cross-border transactions and explore opportunities for research and development credits.";
                        break;
                }
            }
            
            return {
                tax: Math.round(tax),
                taxableIncome: Math.round(taxableIncome),
                taxRate: taxRate,
                tip: tip,
                additionalTaxes: additionalTaxes
            };
        }

        // Enhanced Display calculation results
        function displayResults(calculation) {
            document.getElementById('calculated-tax').textContent = formatCurrency(calculation.tax);
            document.getElementById('taxable-income').textContent = formatCurrency(calculation.taxableIncome);
            document.getElementById('tax-rate').textContent = `${(calculation.taxRate * 100).toFixed(1)}%`;
            document.getElementById('total-allowances').textContent = formatCurrency(userData.allowances);
            document.getElementById('net-tax').textContent = formatCurrency(calculation.tax);
            document.getElementById('optimization-tip').textContent = calculation.tip;
            
            if (calculation.additionalTaxes && calculation.additionalTaxes.length > 0) {
                const breakdown = document.querySelector('.tax-breakdown');
                calculation.additionalTaxes.forEach(additionalTax => {
                    const taxItem = document.createElement('div');
                    taxItem.className = 'breakdown-item';
                    taxItem.innerHTML = `
                        <span>${additionalTax.name}:</span>
                        <span>${formatCurrency(additionalTax.amount)}</span>
                    `;
                    breakdown.appendChild(taxItem);
                });
            }
        }

        // Open external link
        function openExternalLink(url) {
            window.open(url, '_blank');
        }

        // Download resource (placeholder function)
        function downloadResource(title, url) {
            showToast(`Downloading ${title}...`, 'success');
            if (url) {
                window.open(url, '_blank');
            }
        }

        // Watch video (placeholder function)
        function watchVideo(title, url) {
            showToast(`Playing ${title}...`, 'success');
            if (url) {
                window.open(url, '_blank');
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>